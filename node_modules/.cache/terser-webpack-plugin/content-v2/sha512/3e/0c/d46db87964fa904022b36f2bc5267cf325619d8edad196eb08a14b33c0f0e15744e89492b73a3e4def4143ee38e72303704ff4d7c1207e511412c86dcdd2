{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{411:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var a=b(n(178)),o=b(n(209)),i=b(n(210)),s=b(n(25)),l=b(n(34)),r=b(n(76)),u=b(n(176)),m=function(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e};function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n(177),n(212),n(213),n(24),n(33),n(75),n(175);var c=n(57),p=n(26),f=n(23),h=n(21),g=b(n(31));function b(e){return e&&e.__esModule?e:{default:e}}function I(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function y(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function v(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var R=u.default.TreeNode,k=u.default.DirectoryTree,x=r.default.Search,L=l.default.confirm,D=\"61ee45a7490d460ab8d63e9ecffe5fde\",w=(v(M,e.Component),m(M,[{key:\"componentDidMount\",value:function(){this.setState({formOptions:this.getFormOptions()})}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"handleRmItemParentList\",value:function(e,t){t&&(e.readonly=!0),this.setState({formOptions:this.getFormOptions(e,t),nodeData:e,btnOptions:t?null:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:this.submit},{text:\"取消\",options:\"reload\",event:this.cancel}]}});var n={name:e.name,code:e.code,parentCode:e.parentCode,parentName:e.parentName,useDefault:[e.useDefault],defaultValue:e.defaultValue,probability:e.probability,proportion:e.proportion};\"Y\"==e.isLeaf&&(n.isShow=[e.isShow],n.warnFlg=[e.warnFlg],n.warningValue=e.warningValue),this.form.setFieldsValue(n)}},{key:\"getRmItemParentList\",value:function(e,t){(0,h.post)({url:\"rmItem/showRmItemById/rmItemParentList\",data:{id:e},success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"getFormOptions\",value:function(e,t){var n,a=t,o=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,i=\"最多保留2位小数 如：1、1.0、0.88\",s=\"最多保留2位小数\";return n=\"Y\"==(0<arguments.length&&void 0!==e?e:{}).isLeaf?[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:4,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"告警上限\",name:\"warningValue\",span:6,length:4,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Checkbox\",name:\"warnFlg\",span:6,length:4,list:[{label:\"是否告警\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:4,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:5,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Checkbox\",name:\"isShow\",span:12,length:2,list:[{label:\"不显示在风险明细中\",value:\"Y\"}],options:{initialValue:[]}}]:[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:2,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:2,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:3,placeholder:s,options:{initialValue:\"\",rules:[{pattern:o,message:i}]}}],a&&n.forEach(function(e){return e.disabled=!0,e}),n}},{key:\"render\",value:function(){var t=this;return e.createElement(o.default,{gutter:16,className:\"risk-target\"},e.createElement(i.default,{span:5},e.createElement(f.CardCommon,{title:\"航班风险因素节点\"},e.createElement(O,{getSelectedNodeData:this.nodeData}))),e.createElement(i.default,{span:19},e.createElement(f.CardCommon,{title:\"风险因素配置\"},e.createElement(\"div\",{className:\"risk-target-content\"},e.createElement(\"div\",{className:\"risk-target-form\"},e.createElement(f.CommonForm,{options:this.state.formOptions,btnOptions:this.state.btnOptions,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}})),\"N\"==this.state.nodeData.isLeaf&&e.createElement(E,{options:this.state.nodeData}),\"Y\"==this.state.nodeData.isLeaf&&e.createElement(S,{options:this.state.nodeData})))))}}]),M);function M(){I(this,M);var e=y(this,(M.__proto__||Object.getPrototypeOf(M)).call(this));return e.submit=function(){event.preventDefault(),e.form.validateFields(function(t,n){t||(n.id=e.state.nodeData.id,n.useDefault=n.useDefault[0],n.isShow&&(n.isShow=n.isShow[0]),n.warnFlg&&(n.warnFlg=n.warnFlg[0]),(0,h.post)({url:\"rmItem/updateRmItemAndRmItemFunPoints\",data:n,success:function(e){s.default.success(\"保存成功\")}}))})},e.cancel=function(){e.form.resetFields()},e.nodeData=function(t){var n=t.id;n!=D?e.getRmItemParentList(n,function(t){var n=Object.assign({},t.rmItem,{parentName:t.parentrmItem.name,parentCode:t.parentrmItem.code});e.handleRmItemParentList(n)}):e.getRmItemParentList(n,function(t){e.getRmItemParentList(\"ff1a0425002a4817bb3075a1d9cc347c\",function(n){var a=Object.assign({},n.rmItem,{parentName:t.parentrmItem.name,parentCode:t.parentrmItem.code});e.handleRmItemParentList(a,!0)})})},e.state={nodeData:{},formOptions:[],btnOptions:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:e.submit},{text:\"取消\",options:\"reload\",event:e.cancel}]}},e.form,e}var S=(v(C,e.Component),m(C,[{key:\"componentDidMount\",value:function(){this.getList({params:{rmItemId:this.props.options.id}})}},{key:\"componentWillReceiveProps\",value:function(e){e.options.id==this.state.options.id&&e.options.readonly==this.state.options.readonly||(this.setState({options:e.options}),this.getList({params:{rmItemId:e.options.id},pageNum:1}))}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getRmItemRuleDataAndRuleItem\",value:function(e,t){(0,h.post)({url:\"rmItemRuleData/queryRmItemRuleDataAndRuleItemByRmItemRuleId\",data:e,success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"handleData\",value:function(e){var t=[];for(var n in e)\"ruleItem\"!=n&&\"symbol\"!=n&&\"setValue\"!=n||t.push(n+\"=\"+e[n]);return t}},{key:\"getResult\",value:function(e){var t=this;return e.map(function(e){return t.handleData(e)})}},{key:\"getParams\",value:function(e){e.rmItemId=this.state.options.id,\"edit\"==this.state.currentAction&&(e.id=this.state.selectedRows[0].id),e.customKey&&(e.customKey=e.customKey.value);var t=[],n=[];for(var a in e)if(e[a])if(\"customKey\"==a){var o=this.getResult(e[a]);0==o.length?(this.setState({modalOkBtnLoading:!1}),s.default.warning(\"请至少添加一条风险节点规则条件\")):n=o.reduce(function(e,t){return e.concat(t)})}else t.push(a+\"=\"+e[a]);return t.concat(n)}},{key:\"getFormOptions\",value:function(){var e=this.state,t=e.currentAction,n=e.table,a=e.selectedRows,o=e.rmItemRuleData,i={};if(\"edit\"==t&&0<a.length){var s=n.dataList.filter(function(e){return e.id==a[0].id})[0];i={name:s.name,riskValue:s.riskValue,informationDescription:s.informationDescription,mitigatingMeasures:s.mitigatingMeasures,memo:s.memo,customKey:o.rmItemRuleDataList}}return[{type:\"Input\",label:\"风险节点名称\",name:\"name\",span:24,placeholder:\"请输入风险节点名称\",options:{initialValue:i.name,rules:[{required:!0,message:\"风险节点名称不能为空\"}]}},{type:\"Input\",label:\"分值\",name:\"riskValue\",span:24,placeholder:\"请输入数字，最多保留2位小数\",options:{initialValue:i.riskValue,rules:[{required:!0,message:\"分值不能为空\"},{pattern:/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,message:\"最多保留2位小数 如：1、1.0、0.88\"}]}},{type:\"TextArea\",label:\"信息描述\",name:\"informationDescription\",span:24,options:{initialValue:i.informationDescription}},{type:\"TextArea\",label:\"建议措施\",name:\"mitigatingMeasures\",span:24,options:{initialValue:i.mitigatingMeasures}},{type:\"TextArea\",label:\"备注\",name:\"memo\",span:24,options:{initialValue:i.memo}},{type:\"DynamicFieldSetCustom\",name:\"customKey\",span:24,data:o,options:{initialValue:i.customKey}}]}},{key:\"render\",value:function(){var t=this,n=this.state,a=n.options,o=n.table,i=n.modalOkBtnLoading,s=n.btns,l=n.selectedRowKeys,r={notCheck:!!a.readonly,table:o,columns:this.columns,scroll:{x:\"max-content\"},rowSelection:{selectedRowKeys:l,onChange:function(e,n){t.onChecked(e,n)}},onChange:this.getList},u={options:{title:\"编辑\",width:\"600px\",bodyStyle:{height:\"443px\",overflow:\"auto\"},okButtonProps:{loading:i}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)},m=this.getFormOptions();return e.createElement(\"div\",{className:\"mb20\"},e.createElement(\"div\",{className:\"risk-target-tit\"},e.createElement(\"div\",null,\"风险因素节点规则\"),!a.readonly&&e.createElement(\"div\",{className:\"buttons\"},e.createElement(f.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:s}))),e.createElement(f.CommonTable,{options:r,onChecked:this.onChecked}),e.createElement(f.CommonModal,u,e.createElement(\"div\",{className:\"form-grid-7\",style:{paddingLeft:\"20px\",paddingRight:\"30px\"}},e.createElement(f.CommonForm,{options:m,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),C);function C(e){I(this,C);var t=y(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,e));return t.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.state.table;n.setPage(e);var a=n.getParmaData();(0,h.post)({url:\"rmItemRule/queryRmItemRuleByItemId\",data:a,success:function(e){if(e&&e.rows){var o=e.rows.map(function(e,t){return e.index=(a.pageNum-1)*a.pageSize+t+1,e});n.setPage({dataList:o,total:e.total,pageNum:a.pageNum,pageSize:a.pageSize}),t.setState({table:n,selectedRowKeys:[],selectedRows:[],currentAction:\"\"})}}})},t.onChecked=function(e,n){t.setState({selectedRowKeys:e,selectedRows:n})},t.add=function(e){e();var n=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.options.id},function(e){n.setState({rmItemRuleData:e,currentAction:\"add\"}),n.modal.show()})},t.edit=function(e){if(0==t.state.selectedRows.length)s.default.warning(\"必须选择一个选项才能编辑！\"),e();else if(1<t.state.selectedRows.length)s.default.warning(\"只能选择一个选项！\"),e();else{e();var n=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.options.id,rmItemRuleId:t.state.selectedRows[0].id},function(e){n.setState({rmItemRuleData:e,currentAction:\"edit\"}),n.modal.show()})}},t.submit=function(){t.setState({modalOkBtnLoading:!0}),t.form.validateFields(function(e,n){if(e)t.setState({modalOkBtnLoading:!1});else{var a,o,i=t.getParams(n);\"add\"==t.state.currentAction?(a=\"rmItemRule/insertRmtemRuleAndItemRuleDataAtRmtem\",o=\"添加成功\"):\"edit\"==t.state.currentAction&&(a=\"rmItemRule/updateRmtemRuleAndItemRuleDataAtRmtem\",o=\"修改成功\"),(0,h.post)({url:a,data:i.join(\"&\"),btn:function(){return t.setState({modalOkBtnLoading:!1})},success:function(e){s.default.success(o),t.modal.hide(),t.getList(t.props.options)}})}})},t.del=function(e){if(0==t.state.selectedRows.length)s.default.warning(\"未选中选项！\"),e();else{var n=t;L({title:\"确认删除选项吗？\",onOk:function(){var t=n.state.selectedRows.map(function(e){return e.id});(0,h.post)({url:\"rmItemRule/deleteRmItemRuleAndRmItemRuleData\",data:{ids:t},btn:e,success:function(e){s.default.success(\"删除成功\"),n.getList(n.props.options)}})},onCancel:e})}},t.state={options:e.options,table:new g.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",icon:\"plus-circle\",onClick:t.add},{name:\"修改\",icon:\"edit\",onClick:t.edit},{name:\"删除\",icon:\"minus-circle\",onClick:t.del}],currentAction:\"\",rmItemRuleData:{},modalOkBtnLoading:!1},t.columns=[{title:\"序号\",dataIndex:\"index\",width:50},{title:\"风险节点规则名称\",dataIndex:\"name\",className:\"text-left\",width:300,isTooltip:!0},{title:\"分值\",dataIndex:\"riskValue\",width:50},{title:\"信息描述\",dataIndex:\"informationDescription\",className:\"text-left\",width:400,isTooltip:!0},{title:\"建议措施\",dataIndex:\"mitigatingMeasures\",className:\"text-left\",width:300,isTooltip:!0},{title:\"备注\",dataIndex:\"memo\",className:\"text-left\",width:300,isTooltip:!0}],t.modal,t.form,t}var E=(v(V,e.Component),m(V,[{key:\"componentDidMount\",value:function(){this.getRuleItem(this.props.options)}},{key:\"componentWillReceiveProps\",value:function(e){e.options.id!=this.state.options.id&&(this.setState({options:e.options}),this.getRuleItem(e.options))}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getDom\",value:function(t){return e.createElement(r.default,{name:t,value:this.state.rmItemRuleMatrix[t],onChange:this.onChange,autoComplete:\"off\"})}},{key:\"getRuleItem\",value:function(e){var t=this;(0,h.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e.id},success:function(n){(0,h.post)({url:\"rmItemRuleMatrix/queryRmItemRuleMatrixListByRmItemId\",data:{rmItemId:e.id},success:function(e){var a={};switch(e.forEach(function(e){a[e.rowIndentifier]=e.matrixRowValue}),t.setState({length:n.length,rmItemRuleMatrix:a}),n.length){case 0:case 1:break;case 2:var o=[{title:\"\",dataIndex:\"label\"},{title:n[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],i=[{label:n[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:n[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:n[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}];t.setState({columns1:o,dataSource1:i});break;case 3:o=[{title:n[2].name+\"(低)\",dataIndex:\"label\"},{title:n[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}];var s=[{title:n[2].name+\"(中)\",dataIndex:\"label\"},{title:n[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],l=[{title:n[2].name+\"(高)\",dataIndex:\"label\"},{title:n[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:n[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],r=(i=[{label:n[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:n[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:n[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}],[{label:n[1].name+\"(低)\",l:\"MLL\",m:\"MLM\",h:\"MLH\"},{label:n[1].name+\"(中)\",l:\"MML\",m:\"MMM\",h:\"MMH\"},{label:n[1].name+\"(高)\",l:\"MHL\",m:\"MHM\",h:\"MHH\"}]),u=[{label:n[1].name+\"(低)\",l:\"HLL\",m:\"HLM\",h:\"HLH\"},{label:n[1].name+\"(中)\",l:\"HML\",m:\"HMM\",h:\"HMH\"},{label:n[1].name+\"(高)\",l:\"HHL\",m:\"HHM\",h:\"HHH\"}];t.setState({columns1:o,columns2:s,columns3:l,dataSource1:i,dataSource2:r,dataSource3:u})}}})}})}},{key:\"render\",value:function(){var t={notCheck:!0,table:{dataList:this.state.dataSource1,loading:!1},columns:this.state.columns1,needPage:!1},n={notCheck:!0,table:{dataList:this.state.dataSource2,loading:!1},columns:this.state.columns2,needPage:!1},a={notCheck:!0,table:{dataList:this.state.dataSource3,loading:!1},columns:this.state.columns3,needPage:!1};return e.createElement(e.Fragment,null,2<=this.state.length&&this.state.length<=3&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"buttons\"},e.createElement(f.CommonBtns,{btns:this.state.btns})),e.createElement(\"form\",null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(f.CommonTable,{options:t})),3==this.state.length&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(f.CommonTable,{options:n})),e.createElement(\"div\",{className:\"mt15 mb30\"},e.createElement(f.CommonTable,{options:a}))))))}}]),V);function V(e){I(this,V);var t=y(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,e));return t.submit=function(e){var n=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,a=t.state.rmItemRuleMatrix;for(var o in a)if(a[o]&&!n.test(a[o]))return void s.default.warning(\"请输入数字，最多保留2位小数 如：1、1.0、0.88\");(0,h.post)({url:\"rmItemRuleMatrix/updateRmItemRuleMatrix\",data:{rmItemId:t.state.options.id,matrixValue:JSON.stringify(t.state.rmItemRuleMatrix)},btn:e,success:function(e){e.success?s.default.success(\"保存成功\"):s.default.errpr(\"保存失败\")}})},t.cancel=function(e){t.setState({rmItemRuleMatrix:{}}),e()},t.onChange=function(e){var n=t.state.rmItemRuleMatrix;n[e.target.name]=e.target.value,t.setState({rmItemRuleMatrix:n})},t.state={options:e.options,length:0,btns:[{name:\"保存\",icon:\"save\",onClick:t.submit},{name:\"取消\",icon:\"reload\",onClick:t.cancel}],rmItemRuleMatrix:[],columns1:[],columns2:[],columns3:[],dataSource1:[],dataSource2:[],dataSource3:[]},t}var O=(v(N,e.Component),m(N,[{key:\"componentDidMount\",value:function(){this.init()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"init\",value:function(){var e=this;this.getRiskValue(\"root\",function(t){return e.setState({treeData:t})})}},{key:\"getRiskValue\",value:function(e,t){(0,h.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e},success:function(e){var n=e.map(function(e){return{title:e.name,key:e.id,isLeaf:\"N\"!=e.isLeaf,datas:e}});t&&\"function\"==typeof t&&t(n)}})}},{key:\"treeReplace\",value:function(e,t,n){var a=this;return e&&e.forEach(function(e){e.key==n?e.children=t:e.children&&(e.children=a.treeReplace(e.children,t,n))}),e}},{key:\"onSearch\",value:function(e){var t=this;if(e){var n=this;(0,h.post)({url:\"rmItem/searchRmImte\",data:{name:e},success:function(a){if(a){var o=t.state.treeData,i=0;!function t(){var s=a[i].id;n.getRiskValue(s,function(l){o=n.treeReplace(o,l,s),++i<a.length?t():n.setState({treeData:o,expandedKeys:a.map(function(e){return e.id}),searchValue:e})})}()}}})}else s.default.warning(this.state.tip)}},{key:\"getFormOptions\",value:function(){var e=\"edit\"==this.state.currentAction?this.state.nodeData:{};return[{type:\"Input\",label:\"节点名称\",name:\"name\",span:24,options:{initialValue:e.name,rules:[{required:!0,message:\"节点名称不能为空\"}]}},{type:\"Input\",label:\"节点编号\",name:\"code\",span:24,options:{initialValue:e.code,rules:[{required:!0,message:\"节点编号不能为空\"}]}},{type:\"InputExplain\",label:\"序号\",name:\"ordIdx\",span:24,explain:\"序号从1开始\",explainClassName:\"form-explain\",options:{initialValue:e.ordIdx,rules:[{required:!0,message:\"序号不能为空\"},{validator:function(e,t,n){/^$|^0$|^[1-9]+\\d*$/.test(t.value)||n(\"请输入正整数！\"),n()}}]}},{type:\"Select\",label:\"状态\",name:\"status\",span:24,list:[{key:\"E\",text:\"启用\"},{key:\"D\",text:\"禁用\"}],options:{initialValue:e.status,rules:[{required:!0,message:\"请选择状态\"}]},isHasAllSelect:!1},{type:\"Select\",label:\"是否叶子\",name:\"isLeaf\",span:24,list:[{key:\"Y\",text:\"是\"},{key:\"N\",text:\"否\"}],options:{initialValue:e.isLeaf,rules:[{required:!0,message:\"请选择叶子\"}]},isHasAllSelect:!1}]}},{key:\"render\",value:function(){var t=this,n={options:{title:\"添加节点\",okButtonProps:{loading:this.state.modalOkBtnLoading}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)},a=this.getFormOptions(),o={options:this.state.contextMenuOptions,list:this.state.contextMenuList,onRef:function(e){t.contextMenu=e}};return e.createElement(e.Fragment,null,e.createElement(x,{placeholder:this.state.tip,onSearch:function(e){return t.onSearch(e)}}),e.createElement(\"div\",{className:\"search-tree\"},e.createElement(k,{loadData:this.onLoadData,onExpand:this.onExpand,onRightClick:this.onRightClick,expandedKeys:this.state.expandedKeys,autoExpandParent:this.state.autoExpandParent,onSelect:function(e,n){return t.props.getSelectedNodeData(n.node.props.dataRef.datas)}},this.renderTreeNodes(this.state.treeData))),e.createElement(f.ContextMenu,o),e.createElement(f.CommonModal,n,e.createElement(\"div\",{className:\"form-grid-5\"},e.createElement(f.CommonForm,{options:a,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),N);function N(t){I(this,N);var n=y(this,(N.__proto__||Object.getPrototypeOf(N)).call(this,t));return n.onLoadData=function(e){return new Promise(function(t){e.props.children?t():n.getRiskValue(e.props.dataRef.key,function(a){e.props.dataRef.children=a,n.setState({treeData:[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.state.treeData))}),t()})})},n.onExpand=function(e,t){t.expanded,t.node,n.setState({expandedKeys:e})},n.renderTreeNodes=function(t){return t.map(function(t){var a=n.state.searchValue,o=t.title.indexOf(a),i=t.title.substr(0,o),s=t.title.substr(o+a.length),l=-1==o?t.title:e.createElement(e.Fragment,null,i,\" \",e.createElement(\"span\",{className:\"text-danger\"},a),\" \",s);return t.children?e.createElement(R,{title:l,key:t.key,isLeaf:t.isLeaf,dataRef:t},n.renderTreeNodes(t.children)):e.createElement(R,{title:l,key:t.key,isLeaf:t.isLeaf,dataRef:t})})},n.onRightClick=function(e){e.node.props.dataRef.datas.id!=D&&(n.setState({contextMenuOptions:{pageX:e.event.pageX,pageY:e.event.pageY,datas:e.node.props.dataRef.datas}}),n.contextMenu.show())},n.onAddTreeNode=function(e){n.setState({nodeData:e,currentAction:\"add\"}),n.modal.show()},n.onEditTreeNode=function(e){n.setState({nodeData:e,currentAction:\"edit\"}),n.modal.show()},n.onDelTreeNode=function(e){n.setState({nodeData:e,currentAction:\"del\"});var t=n;L({title:\"确认删除选项吗？\",onOk:function(){(0,h.post)({url:\"rmItem/deleteRmItemRreeCode\",data:{id:e.id},success:function(e){s.default.success(\"节点删除成功\"),t.init()}})}})},n.submit=function(){n.setState({modalOkBtnLoading:!0}),n.form.validateFields(function(e,t){if(e)n.setState({modalOkBtnLoading:!1});else{for(var a in t)\"ordIdx\"==a&&(t[a]=t[a].value);var o,i;t=(0,p.handleInParams)(t),\"add\"==n.state.currentAction?(t.id=n.state.nodeData.id,o=\"rmItem/addRmItemTreeCode\",i=\"添加成功\"):\"edit\"==n.state.currentAction&&(t.parentId=n.state.nodeData.parentId,t.id=n.state.nodeData.id,o=\"rmItem/updateRmItemTreeCode\",i=\"修改成功\"),(0,h.post)({url:o,data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){s.default.success(i),n.modal.hide(),n.init()}})}})},n.state={treeData:[],tip:\"请输入节点名称\",expandedKeys:[],searchValue:\"\",autoExpandParent:!1,contextMenuOptions:{pageX:\"\",pageY:\"\",datas:null},contextMenuList:[{name:\"添加\",click:n.onAddTreeNode},{name:\"修改\",click:n.onEditTreeNode},{name:\"删除\",click:n.onDelTreeNode}],nodeData:{},currentAction:\"\",modalOkBtnLoading:!1},n.modal,n.contextMenu,n.form,n}t.default=a.default.create({name:\"TreeForm\"})((0,c.withRouter)(w))}).call(this,n(1))}}]);","extractedComments":[]}