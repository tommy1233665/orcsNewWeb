{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{412:function(e,t,a){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=b(a(178)),i=b(a(209)),o=b(a(210)),r=b(a(28)),s=b(a(36)),l=b(a(77)),u=b(a(176)),d=function(e,t,a){return t&&m(e.prototype,t),a&&m(e,a),e};function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a(177),a(212),a(213),a(27),a(35),a(76),a(175);var c=a(20),p=a(25),f=a(23),h=a(26),g=a(22),y=b(a(33)),I=a(310);function b(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function R(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function k(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var x=u.default.TreeNode,L=u.default.DirectoryTree,w=l.default.Search,D=s.default.confirm,E=I.riskTargetMap.originalId,M=I.riskTargetMap.modifyId,S=\"riskTarget.addTree\",C=\"riskTarget.editTree\",N=\"riskTarget.delTree\",V=\"riskTarget.editMatrix\",O=\"riskTarget.addRule\",T=\"riskTarget.editRule\",A=\"riskTarget.delTule\",H=(k(F,e.Component),d(F,[{key:\"componentDidMount\",value:function(){this.setState({formOptions:this.getFormOptions()})}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getFormOptions\",value:function(e){var t=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,a=\"最多保留2位小数 如：1、1.0、0.88\",n=\"最多保留2位小数\";return\"Y\"==(0<arguments.length&&void 0!==e?e:{}).isLeaf?[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"告警上限\",name:\"warningValue\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",name:\"warnFlg\",span:6,length:4,list:[{label:\"是否告警\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:5,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",name:\"isShow\",span:12,length:2,list:[{label:\"不显示在风险明细中\",value:\"Y\"}],options:{initialValue:[]}}]:[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:2,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:2,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:3,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}}]}},{key:\"render\",value:function(){var t=this,a=this.props.authority,n=this.state,r=n.authorityDetailNode,s=n.authorityDetailLeaf,l=n.formOptions,u=n.btnOptions,d=n.nodeData;return e.createElement(i.default,{gutter:16,className:\"risk-target\"},e.createElement(o.default,{span:5},e.createElement(h.CardCommon,{title:\"航班风险因素节点\"},e.createElement($,{getSelectedNodeData:this.nodeData,authority:a}))),e.createElement(o.default,{span:19},e.createElement(h.CardCommon,{title:\"风险因素配置\"},e.createElement(\"div\",{className:\"risk-target-content\"},e.createElement(\"div\",{className:\"risk-target-form\"},r&&\"N\"==d.isLeaf&&e.createElement(h.CommonForm,{options:l,btnOptions:u,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),!r&&\"N\"==d.isLeaf&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),s&&\"Y\"==d.isLeaf&&e.createElement(h.CommonForm,{options:l,btnOptions:u,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),!s&&\"Y\"==d.isLeaf&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\")),\"N\"==d.isLeaf&&e.createElement(B,{options:d,authority:a}),\"Y\"==d.isLeaf&&e.createElement(P,{id:d.id,authority:a})))))}}]),F);function F(e){v(this,F);var t=R(this,(F.__proto__||Object.getPrototypeOf(F)).call(this,e));return t.submit=function(){event.preventDefault(),t.form.validateFields(function(e,a){e||(a.id=t.state.nodeData.id,a.useDefault=a.useDefault[0],a.isShow&&(a.isShow=a.isShow[0]),a.warnFlg&&(a.warnFlg=a.warnFlg[0]),a=(0,f.handleInParams)(a),(0,g.post)({url:\"rmItem/updateRmItemAndRmItemFunPoints\",data:a,success:function(e){r.default.success(\"保存成功\")}}))})},t.cancel=function(){t.form.resetFields()},t.nodeData=function(e){var a=\"N\"==e.isLeaf&&!t.state.authorityEditNode||\"Y\"==e.isLeaf&&!t.state.authorityEditLeaf;(0,g.post)({url:\"rmItem/showRmItemById/rmItemParentList\",data:{id:e.id},success:function(e){var n=Object.assign({},e.rmItem,{parentName:e.parentrmItem.name,parentCode:e.parentrmItem.code});t.setState({formOptions:t.getFormOptions(n),nodeData:n,btnOptions:a?{}:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:t.submit},{text:\"取消\",options:\"reload\",event:t.cancel}]}});var i={name:n.name,code:n.code,parentCode:n.parentCode,parentName:n.parentName,useDefault:[n.useDefault],defaultValue:n.defaultValue,probability:n.probability,proportion:n.proportion};\"Y\"==n.isLeaf&&(i.isShow=[n.isShow],i.warnFlg=[n.warnFlg],i.warningValue=n.warningValue),t.form&&t.form.setFieldsValue(i)}})},t.state={authorityEditNode:(0,f.isAuthority)(\"riskTarget.editNode\",e.authority),authorityDetailNode:(0,f.isAuthority)(\"riskTarget.detailNode\",e.authority),authorityEditLeaf:(0,f.isAuthority)(\"riskTarget.editLeaf\",e.authority),authorityDetailLeaf:(0,f.isAuthority)(\"riskTarget.detailLeaf\",e.authority),nodeData:{},formOptions:[],btnOptions:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:t.submit},{text:\"取消\",options:\"reload\",event:t.cancel}]}},t.form,t}var P=(k(_,e.Component),d(_,[{key:\"componentDidMount\",value:function(){this.getList({params:{rmItemId:this.state.id}})}},{key:\"componentWillReceiveProps\",value:function(e){if(e.id!=this.props.id){var t=e.id==E?M:e.id,a=e.id==E;this.setState({id:t,readonly:a}),this.getList({params:{rmItemId:t},pageNum:1})}}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getRmItemRuleDataAndRuleItem\",value:function(e,t){(0,g.post)({url:\"rmItemRuleData/queryRmItemRuleDataAndRuleItemByRmItemRuleId\",data:e,success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"handleData\",value:function(e){var t=[];for(var a in e)\"ruleItem\"!=a&&\"symbol\"!=a&&\"setValue\"!=a||t.push(a+\"=\"+e[a]);return t}},{key:\"getResult\",value:function(e){var t=this;return e.map(function(e){return t.handleData(e)})}},{key:\"getParams\",value:function(e){e.rmItemId=this.state.id,\"edit\"==this.state.currentAction&&(e.id=this.state.selectedRows[0].id),e.customKey&&(e.customKey=e.customKey.value);var t=[],a=[];for(var n in e)if(e[n])if(\"customKey\"==n){var i=this.getResult(e[n]);0==i.length?(this.setState({modalOkBtnLoading:!1}),r.default.warning(\"请至少添加一条风险节点规则条件\")):a=i.reduce(function(e,t){return e.concat(t)})}else t.push(n+\"=\"+e[n]);return t.concat(a)}},{key:\"getFormOptions\",value:function(){var e=this.state,t=e.currentAction,a=e.table,n=e.selectedRows,i=e.rmItemRuleData,o={};if((\"edit\"==t||\"detail\"==t)&&0<n.length){var r=a.dataList.filter(function(e){return e.id==n[0].id})[0];o={name:r.name,riskValue:r.riskValue,informationDescription:r.informationDescription,mitigatingMeasures:r.mitigatingMeasures,memo:r.memo,customKey:i.rmItemRuleDataList}}var s=[{type:\"Input\",label:\"风险节点名称\",name:\"name\",span:24,placeholder:\"请输入风险节点名称\",options:{initialValue:o.name,rules:[{required:!0,message:\"风险节点名称不能为空\"}]}},{type:\"Input\",label:\"分值\",name:\"riskValue\",span:24,placeholder:\"请输入数字，最多保留2位小数\",options:{initialValue:o.riskValue,rules:[{required:!0,message:\"分值不能为空\"},{pattern:/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,message:\"最多保留2位小数 如：1、1.0、0.88\"}]}},{type:\"TextArea\",label:\"信息描述\",name:\"informationDescription\",span:24,options:{initialValue:o.informationDescription}},{type:\"TextArea\",label:\"建议措施\",name:\"mitigatingMeasures\",span:24,options:{initialValue:o.mitigatingMeasures}},{type:\"TextArea\",label:\"备注\",name:\"memo\",span:24,options:{initialValue:o.memo}},{type:\"DynamicFieldSetCustom\",name:\"customKey\",span:24,data:i,options:{initialValue:o.customKey}}];return\"detail\"==t&&s.forEach(function(e){e.disabled=!0}),s}},{key:\"render\",value:function(){var t=this,a=this.state,n=a.readonly,i=a.table,o=a.modalOkBtnLoading,r=a.selectedRowKeys,s=a.currentAction,l=a.authorityList,u=[{name:\"查看\",icon:\"eye\",onClick:this.detail}],d=[{name:\"新增\",id:O,icon:\"plus-circle\",onClick:this.add},{name:\"修改\",id:T,icon:\"edit\",onClick:this.edit},{name:\"删除\",id:A,icon:\"minus-circle\",onClick:this.del}].filter(function(e){return(0,f.isAuthority)(e.id,t.props.authority)}),m={notCheck:!1,table:i,columns:this.columns,scroll:{x:\"max-content\"},rowSelection:{selectedRowKeys:r,onChange:function(e,a){t.onChecked(e,a)}},onChange:this.getList},c={shape:\"round\",size:\"small\"},p={options:{title:\"编辑\",width:\"600px\",bodyStyle:{height:\"443px\",overflow:\"auto\"},okButtonProps:{loading:o}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};\"detail\"==s&&(p.options.footer=null);var g=this.getFormOptions();return e.createElement(\"div\",{className:\"mb20\"},e.createElement(\"div\",{className:\"risk-target-tit\"},e.createElement(\"div\",null,\"风险因素节点规则\"),e.createElement(\"div\",{className:\"buttons\"},n&&l&&e.createElement(h.CommonBtns,{options:c,btns:u}),!n&&e.createElement(h.CommonBtns,{options:c,btns:d}))),l&&e.createElement(h.CommonTable,{options:m,onChecked:this.onChecked}),!l&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),e.createElement(h.CommonModal,p,e.createElement(\"div\",{className:\"form-grid-7\",style:{paddingLeft:\"20px\",paddingRight:\"30px\"}},e.createElement(h.CommonForm,{options:g,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),_);function _(e){v(this,_);var t=R(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,e));t.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.state.table;a.setPage(e);var n=a.getParmaData();(0,g.post)({url:\"rmItemRule/queryRmItemRuleByItemId\",data:n,success:function(e){if(e&&e.rows){var i=e.rows.map(function(e,t){return e.index=(n.pageNum-1)*n.pageSize+t+1,e});a.setPage({dataList:i,total:e.total,pageNum:n.pageNum,pageSize:n.pageSize}),t.setState({table:a,selectedRowKeys:[],selectedRows:[],currentAction:\"\"})}}})},t.onChecked=function(e,a){t.setState({selectedRowKeys:e,selectedRows:a})},t.add=function(e){e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id},function(e){a.setState({rmItemRuleData:e,currentAction:\"add\"}),a.modal.show()})},t.edit=function(e){if(0==t.state.selectedRows.length)r.default.warning(\"必须选择一个选项才能编辑！\"),e();else if(1<t.state.selectedRows.length)r.default.warning(\"只能选择一个选项！\"),e();else{e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id,rmItemRuleId:t.state.selectedRows[0].id},function(e){a.setState({rmItemRuleData:e,currentAction:\"edit\"}),a.modal.show()})}},t.detail=function(e){if(0==t.state.selectedRows.length)r.default.warning(\"必须选择一个选项才能查看！\"),e();else if(1<t.state.selectedRows.length)r.default.warning(\"只能选择一个选项！\"),e();else{e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id,rmItemRuleId:t.state.selectedRows[0].id},function(e){a.setState({rmItemRuleData:e,currentAction:\"detail\"}),a.modal.show()})}},t.submit=function(){t.setState({modalOkBtnLoading:!0}),t.form.validateFields(function(e,a){if(e)t.setState({modalOkBtnLoading:!1});else{var n,i,o=t.getParams(a);\"add\"==t.state.currentAction?(n=\"rmItemRule/insertRmtemRuleAndItemRuleDataAtRmtem\",i=\"添加成功\"):\"edit\"==t.state.currentAction&&(n=\"rmItemRule/updateRmtemRuleAndItemRuleDataAtRmtem\",i=\"修改成功\"),(0,g.post)({url:n,data:o.join(\"&\"),btn:function(){return t.setState({modalOkBtnLoading:!1})},success:function(e){r.default.success(i),t.modal.hide(),t.getList({params:{rmItemId:t.props.id},pageNum:1})}})}})},t.del=function(e){if(0==t.state.selectedRows.length)r.default.warning(\"未选中选项！\"),e();else{var a=t;D({title:\"确认删除选项吗？\",onOk:function(){var t=a.state.selectedRows.map(function(e){return e.id});(0,g.post)({url:\"rmItemRule/deleteRmItemRuleAndRmItemRuleData\",data:{ids:t},btn:e,success:function(e){r.default.success(\"删除成功\"),a.getList({params:{rmItemId:a.props.id},pageNum:1})}})},onCancel:e})}};var a=e.id==E?M:e.id,n=e.id==E;return t.state={id:a,readonly:n,table:new y.default,selectedRowKeys:[],selectedRows:[],currentAction:\"\",rmItemRuleData:{},modalOkBtnLoading:!1,authorityList:(0,f.isAuthority)(\"riskTarget.listRule\",e.authority)},t.columns=[{title:\"序号\",dataIndex:\"index\",width:50},{title:\"风险节点规则名称\",dataIndex:\"name\",className:\"text-left\",width:300,isTooltip:!0},{title:\"分值\",dataIndex:\"riskValue\",width:50},{title:\"信息描述\",dataIndex:\"informationDescription\",className:\"text-left\",width:400,isTooltip:!0},{title:\"建议措施\",dataIndex:\"mitigatingMeasures\",className:\"text-left\",width:300,isTooltip:!0},{title:\"备注\",dataIndex:\"memo\",className:\"text-left\",width:300,isTooltip:!0}],t.modal,t.form,t}var B=(k(K,e.Component),d(K,[{key:\"componentDidMount\",value:function(){this.getRuleItem(this.props.options)}},{key:\"componentWillReceiveProps\",value:function(e){e.options.id!=this.state.options.id&&(this.setState({options:e.options}),this.getRuleItem(e.options))}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getDom\",value:function(t){return e.createElement(l.default,{name:t,value:this.state.rmItemRuleMatrix[t],onChange:this.onChange,autoComplete:\"off\"})}},{key:\"getRuleItem\",value:function(e){var t=this;(0,g.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e.id},success:function(a){(0,g.post)({url:\"rmItemRuleMatrix/queryRmItemRuleMatrixListByRmItemId\",data:{rmItemId:e.id},success:function(e){var n={};switch(e.forEach(function(e){n[e.rowIndentifier]=e.matrixRowValue}),t.setState({length:a.length,rmItemRuleMatrix:n}),a.length){case 0:case 1:break;case 2:var i=[{title:\"\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],o=[{label:a[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:a[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:a[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}];t.setState({columns1:i,dataSource1:o});break;case 3:i=[{title:a[2].name+\"(低)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}];var r=[{title:a[2].name+\"(中)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],s=[{title:a[2].name+\"(高)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],l=(o=[{label:a[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:a[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:a[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}],[{label:a[1].name+\"(低)\",l:\"MLL\",m:\"MLM\",h:\"MLH\"},{label:a[1].name+\"(中)\",l:\"MML\",m:\"MMM\",h:\"MMH\"},{label:a[1].name+\"(高)\",l:\"MHL\",m:\"MHM\",h:\"MHH\"}]),u=[{label:a[1].name+\"(低)\",l:\"HLL\",m:\"HLM\",h:\"HLH\"},{label:a[1].name+\"(中)\",l:\"HML\",m:\"HMM\",h:\"HMH\"},{label:a[1].name+\"(高)\",l:\"HHL\",m:\"HHM\",h:\"HHH\"}];t.setState({columns1:i,columns2:r,columns3:s,dataSource1:o,dataSource2:l,dataSource3:u})}}})}})}},{key:\"render\",value:function(){var t=this.state.authorityList,a={notCheck:!0,table:{dataList:this.state.dataSource1,loading:!1},columns:this.state.columns1,needPage:!1},n={notCheck:!0,table:{dataList:this.state.dataSource2,loading:!1},columns:this.state.columns2,needPage:!1},i={notCheck:!0,table:{dataList:this.state.dataSource3,loading:!1},columns:this.state.columns3,needPage:!1};return e.createElement(e.Fragment,null,2<=this.state.length&&this.state.length<=3&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"buttons\"},e.createElement(h.CommonBtns,{btns:this.state.btns})),t&&e.createElement(\"form\",null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(h.CommonTable,{options:a})),3==this.state.length&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(h.CommonTable,{options:n})),e.createElement(\"div\",{className:\"mt15 mb30\"},e.createElement(h.CommonTable,{options:i})))),!t&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\")))}}]),K);function K(e){v(this,K);var t=R(this,(K.__proto__||Object.getPrototypeOf(K)).call(this,e));return t.submit=function(e){var a=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,n=t.state.rmItemRuleMatrix;for(var i in n)if(n[i]&&!a.test(n[i]))return void r.default.warning(\"请输入数字，最多保留2位小数 如：1、1.0、0.88\");(0,g.post)({url:\"rmItemRuleMatrix/updateRmItemRuleMatrix\",data:{rmItemId:t.state.options.id,matrixValue:JSON.stringify(t.state.rmItemRuleMatrix)},btn:e,success:function(e){e.success?r.default.success(\"保存成功\"):r.default.errpr(\"保存失败\")}})},t.cancel=function(e){t.setState({rmItemRuleMatrix:{}}),e()},t.onChange=function(e){var a=t.state.rmItemRuleMatrix;a[e.target.name]=e.target.value,t.setState({rmItemRuleMatrix:a})},t.state={options:e.options,length:0,btns:[{name:\"保存\",id:V,icon:\"save\",onClick:t.submit},{name:\"取消\",id:V,icon:\"reload\",onClick:t.cancel}].filter(function(t){return(0,f.isAuthority)(t.id,e.authority)}),rmItemRuleMatrix:[],columns1:[],columns2:[],columns3:[],dataSource1:[],dataSource2:[],dataSource3:[],authorityList:(0,f.isAuthority)(\"riskTarget.detailMatrix\",e.authority)},t}var $=(k(Y,e.Component),d(Y,[{key:\"componentDidMount\",value:function(){this.init()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"init\",value:function(){var e=this;this.getRiskValue(\"root\",function(t){return e.setState({treeData:t,expandedKeys:[]})})}},{key:\"getRiskValue\",value:function(e,t){(0,g.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e},success:function(e){var a=e.map(function(e){return{title:e.name,key:e.id,isLeaf:\"N\"!=e.isLeaf,datas:e}});t&&\"function\"==typeof t&&t(a)}})}},{key:\"treeReplace\",value:function(e,t,a){var n=this;return e&&e.forEach(function(e){e.key==a?e.children=t:e.children&&(e.children=n.treeReplace(e.children,t,a))}),e}},{key:\"onSearch\",value:function(e){var t=this;if(e){var a=this;(0,g.post)({url:\"rmItem/searchRmImte\",data:{name:e},success:function(n){if(n){var i=t.state.treeData,o=0;!function t(){var r=n[o].id;a.getRiskValue(r,function(s){i=a.treeReplace(i,s,r),++o<n.length?t():a.setState({treeData:i,expandedKeys:n.map(function(e){return e.id}),searchValue:e})})}()}}})}else r.default.warning(this.state.tip)}},{key:\"getFormOptions\",value:function(){var e=\"edit\"==this.state.currentAction?this.state.nodeData:{};return[{type:\"Input\",label:\"节点名称\",name:\"name\",span:24,options:{initialValue:e.name,rules:[{required:!0,message:\"节点名称不能为空\"}]}},{type:\"Input\",label:\"节点编号\",name:\"code\",span:24,options:{initialValue:e.code,rules:[{required:!0,message:\"节点编号不能为空\"}]}},{type:\"InputExplain\",label:\"序号\",name:\"ordIdx\",span:24,explain:\"序号从1开始\",explainClassName:\"form-explain\",options:{initialValue:e.ordIdx,rules:[{required:!0,message:\"序号不能为空\"},{validator:function(e,t,a){/^$|^0$|^[1-9]+\\d*$/.test(t.value)||a(\"请输入正整数！\"),a()}}]}},{type:\"Select\",label:\"状态\",name:\"status\",span:24,list:[{key:\"E\",text:\"启用\"},{key:\"D\",text:\"禁用\"}],options:{initialValue:e.status,rules:[{required:!0,message:\"请选择状态\"}]},isHasAllSelect:!1},{type:\"Select\",label:\"是否叶子\",name:\"isLeaf\",span:24,list:[{key:\"Y\",text:\"是\"},{key:\"N\",text:\"否\"}],options:{initialValue:e.isLeaf,rules:[{required:!0,message:\"请选择叶子\"}]},isHasAllSelect:!1}]}},{key:\"render\",value:function(){var t=this,a=this.state.authorityList,n={options:{title:\"添加节点\",okButtonProps:{loading:this.state.modalOkBtnLoading}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)},i=this.getFormOptions(),o={options:this.state.contextMenuOptions,list:this.state.contextMenuList,onRef:function(e){t.contextMenu=e}};return e.createElement(e.Fragment,null,a&&e.createElement(w,{placeholder:this.state.tip,onSearch:function(e){return t.onSearch(e)}}),a&&e.createElement(\"div\",{className:\"search-tree\"},e.createElement(L,{loadData:this.onLoadData,onExpand:this.onExpand,onRightClick:this.onRightClick,expandedKeys:this.state.expandedKeys,loadedKeys:this.state.expandedKeys,autoExpandParent:this.state.autoExpandParent,onSelect:function(e,a){return t.props.getSelectedNodeData(a.node.props.dataRef.datas)}},this.renderTreeNodes(this.state.treeData))),!a&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),e.createElement(h.ContextMenu,o),e.createElement(h.CommonModal,n,e.createElement(\"div\",{className:\"form-grid-5\"},e.createElement(h.CommonForm,{options:i,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),Y);function Y(t){v(this,Y);var a=R(this,(Y.__proto__||Object.getPrototypeOf(Y)).call(this,t));return a.onLoadData=function(e){return new Promise(function(t){e.props.children?t():a.getRiskValue(e.props.dataRef.key,function(n){e.props.dataRef.children=n,a.setState({treeData:[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(a.state.treeData))}),t()})})},a.onExpand=function(e,t){t.expanded,t.node,a.setState({expandedKeys:e})},a.renderTreeNodes=function(t){return t.map(function(t){var n=a.state.searchValue,i=t.title.indexOf(n),o=t.title.substr(0,i),r=t.title.substr(i+n.length),s=-1==i?t.title:e.createElement(e.Fragment,null,o,\" \",e.createElement(\"span\",{className:\"text-danger\"},n),\" \",r);return t.children?e.createElement(x,{title:s,key:t.key,isLeaf:t.isLeaf,dataRef:t},a.renderTreeNodes(t.children)):e.createElement(x,{title:s,key:t.key,isLeaf:t.isLeaf,dataRef:t})})},a.onRightClick=function(e){e.node.props.dataRef.datas,a.setState({contextMenuOptions:{pageX:e.event.pageX,pageY:e.event.pageY,datas:e.node.props.dataRef.datas}}),a.contextMenu.show()},a.onAddTreeNode=function(e){a.setState({nodeData:e,currentAction:\"add\"}),a.modal.show()},a.onEditTreeNode=function(e){a.setState({nodeData:e,currentAction:\"edit\"}),a.modal.show()},a.onDelTreeNode=function(e){a.setState({nodeData:e,currentAction:\"del\"});var t=a;D({title:\"确认删除选项吗？\",onOk:function(){(0,g.post)({url:\"rmItem/deleteRmItemRreeCode\",data:{id:e.id},success:function(e){r.default.success(\"节点删除成功\"),t.init()}})}})},a.submit=function(){a.setState({modalOkBtnLoading:!0}),a.form.validateFields(function(e,t){if(e)a.setState({modalOkBtnLoading:!1});else{for(var n in t)\"ordIdx\"==n&&(t[n]=t[n].value);var i,o;t=(0,f.handleInParams)(t),\"add\"==a.state.currentAction?(t.id=a.state.nodeData.id,i=\"rmItem/addRmItemTreeCode\",o=\"添加成功\"):\"edit\"==a.state.currentAction&&(t.parentId=a.state.nodeData.parentId,t.id=a.state.nodeData.id,i=\"rmItem/updateRmItemTreeCode\",o=\"修改成功\"),(0,g.post)({url:i,data:t,btn:function(){return a.setState({modalOkBtnLoading:!1})},success:function(e){r.default.success(o),a.modal.hide(),a.init()}})}})},a.state={treeData:[],tip:\"请输入节点名称\",expandedKeys:[],searchValue:\"\",autoExpandParent:!1,contextMenuOptions:{pageX:\"\",pageY:\"\",datas:null},contextMenuList:[{name:\"添加\",id:S,click:a.onAddTreeNode},{name:\"修改\",id:C,click:a.onEditTreeNode},{name:\"删除\",id:N,click:a.onDelTreeNode}].filter(function(e){return(0,f.isAuthority)(e.id,t.authority)}),nodeData:{},currentAction:\"\",modalOkBtnLoading:!1,authorityList:(0,f.isAuthority)(\"riskTarget.listTree\",t.authority)},a.modal,a.contextMenu,a.form,a}t.default=(0,p.connect)(function(e){return{authority:e.authority}})(n.default.create({name:\"TreeForm\"})((0,c.withRouter)(H)))}).call(this,a(1))}}]);","extractedComments":[]}