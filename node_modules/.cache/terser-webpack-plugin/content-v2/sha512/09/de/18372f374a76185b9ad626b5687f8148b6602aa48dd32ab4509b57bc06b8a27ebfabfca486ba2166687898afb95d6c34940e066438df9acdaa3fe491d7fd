{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{211:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var r=h(n(28)),a=h(n(178)),i=h(n(36)),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e};function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n(27),n(176),n(35);var c=n(20),l=n(24),f=n(23),p=n(22);function h(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function y(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function k(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=i.default.confirm,v=a.default.TreeNode,g=a.default.DirectoryTree,b=(k(R,e.Component),s(R,[{key:\"componentDidMount\",value:function(){var e=this;this.getRiskValue(\"root\",function(t){return e.setState({treeData:t})}),this.getHightRiskValueParentIds()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getHightRiskValueParentIds\",value:function(){var e=this;(0,p.post)({url:\"airLineRisk/queryHightRiskValueParentIds\",data:{soflSeqNr:this.props.treeParams.soflSeqNr},success:function(t){t=t||[],e.setState({parentIds:t})}})}},{key:\"getRiskValue\",value:function(e,t){var n=this.props,r=n.treeParams,a=n.isHistory;if(r&&r.soflSeqNr){var i={parentId:e,soflSeqNr:r.soflSeqNr};r.batchNum&&(i.batchNum=r.batchNum);var o=a?r.batchNum?\"airLineRisk/queryRiskValuesForHis\":\"airLineRisk/queryRiskValueHisNew\":r.batchNum?\"airLineRisk/queryHisRiskValue\":\"airLineRisk/queryRiskValue\";(0,p.post)({url:o,data:i,success:function(e){var n=e.map(function(e){var t={};return t.title=e.riskValue||0==e.riskValue?e.name+\"：\"+e.riskValue:e.name+\"：\",t.key=e.id,t.isLeaf=\"N\"!=e.isLeaf,t.datas=e,t.datas.soflSeqNr=r.soflSeqNr,t});t&&\"function\"==typeof t&&t(n)}})}}},{key:\"treeReplace\",value:function(e,t,n){var r=this;return e.map(function(e){e.key==n?e.children=t:e.children&&(e.children=r.treeReplace(e.children,t,e.parentId))}),e}},{key:\"onMathRmItem\",value:function(e){if(this.state.authorityCount){var t=this;m({title:\"是否开始计算？\",onOk:function(){(0,p.post)({url:\"droolsEngine/mathRmItem\",data:{soflSeqNr:e.soflSeqNr,rmItemId:e.id,batchNum:e.batchNum},success:function(n){n.success?m({title:\"计算风险完毕！是否需要节点风险值？\",onOk:function(){t.getRiskValue(e.parentId,function(n){var r=t.treeReplace(t.state.treeData,n,e.parentId);t.setState(r)})}}):r.default.error(\"计算风险失败\")}})}})}else r.default.info(\"没有权限操作\")}},{key:\"render\",value:function(){return e.createElement(g,{loadData:this.onLoadData},this.renderTreeNodes(this.state.treeData))}}]),R);function R(t){d(this,R);var n=y(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,t));return n.onLoadData=function(e){return new Promise(function(t){e.props.children?t():n.getRiskValue(e.props.dataRef.key,function(r){e.props.dataRef.children=r,n.setState({treeData:[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.state.treeData))}),t()})})},n.renderTreeNodes=function(t){return t.map(function(t){var r=e.createElement(N,o({hasAction:n.props.hasAction,parentIds:n.state.parentIds},t,{onClick:n.onMathRmItem.bind(n,t.datas)}));return t.children?e.createElement(v,{title:r,key:t.key,isLeaf:t.isLeaf,dataRef:t},n.renderTreeNodes(t.children)):e.createElement(v,{title:r,key:t.key,isLeaf:t.isLeaf,dataRef:t})})},n.state={treeData:[],parentIds:[],authorityCount:(0,f.isAuthority)(\"flightRiskShow.countLeaf\",t.authority)},n}var N=(k(w,e.Component),s(w,[{key:\"componentDidMount\",value:function(){this.getFlag(this.props.parentIds)}},{key:\"componentWillReceiveProps\",value:function(e){this.getFlag(e.parentIds)}},{key:\"getFlag\",value:function(e){var t=this;e.forEach(function(e){e==t.props.datas.id&&t.setState({isFlag:!0})})}},{key:\"handleClick\",value:function(e){e.stopPropagation(),this.props.onClick()}},{key:\"render\",value:function(){return e.createElement(e.Fragment,null,e.createElement(\"span\",{className:7<this.props.datas.riskValue?\"text-danger\":this.state.isFlag?\"text-warning\":\"\"},this.props.title),this.props.isLeaf&&this.props.hasAction&&e.createElement(\"span\",{className:\"tree-btn\",onClick:this.handleClick.bind(this)},\"重新计算\"))}}]),w);function w(e){d(this,w);var t=y(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,e));return t.state={isFlag:!1},t}t.default=(0,l.connect)(function(e){return{authority:e.authority}})((0,c.withRouter)(b))}).call(this,n(1))}}]);","extractedComments":[]}