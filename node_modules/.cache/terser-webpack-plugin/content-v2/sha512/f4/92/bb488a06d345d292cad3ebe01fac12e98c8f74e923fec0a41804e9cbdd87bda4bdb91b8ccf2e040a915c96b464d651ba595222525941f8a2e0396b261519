{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{415:function(e,t,a){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var i=p(a(27)),n=p(a(35));function o(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a(26),a(34);var l=a(20),s=a(24),r=a(25),u=a(22),d=a(21),c=p(a(29));function p(e){return e&&e.__esModule?e:{default:e}}var m=n.default.confirm,f=\"relateRiskTarget.addEdit\",h=\"relateRiskTarget.del\",b=(function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(g,e.Component),function(e,t,a){t&&o(e.prototype,t),a&&o(e,a)}(g,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getFormOptions\",value:function(){var e=this,t=this.state,a=t.currentAction,i=t.selectedRows,n=t.table,o=t.isRiskvariablevalue,l={},s=!1,r=!1;\"add\"==a&&(l.accumulatemethod=\"无累计\"),\"edit\"==a&&0<i.length&&(s=\"是\"==(l=n.dataList.find(function(e){return e.id==i[0].id})).useDefault,r=\"是\"==l.valid);var u=o?\"\":l.riskvariablevalue;return[{type:\"Input\",label:\"编号\",name:\"id\",span:24,placeholder:\"关联风险编号（非空，唯一，长度64位以内）\",options:{initialValue:l.id,rules:[{required:!0,message:\"编号不能为空\"},{max:64,message:\"长度在64之内\"},{pattern:/^[a-zA-Z]\\d+$/,message:\"第一位为字母，其余为数字\"}]}},{type:\"Input\",label:\"风险名\",name:\"name\",span:24,placeholder:\"风险名（非空，长度64位以内）\",options:{initialValue:l.name,rules:[{required:!0,message:\"编号不能为空\"},{max:64,message:\"长度在64之内\"}]}},{type:\"Input\",label:\"规则描述\",name:\"ruleDisc\",span:24,placeholder:\"规则描述（长度800以内）\",options:{initialValue:l.ruleDisc,rules:[{max:800,message:\"规则描述长度不可超过800\"}]}},{type:\"Input\",label:\"风险等级\",name:\"riskLevel\",span:24,placeholder:\"风险等级（长度1位）\",options:{initialValue:l.riskLevel,rules:[{max:1,message:\"风险等级长度为1\"}]}},{type:\"Input\",label:\"风险值\",name:\"riskValue\",span:24,placeholder:\"风险值（非默认情况下必填，数字）\",options:{initialValue:l.riskValue,rules:[{validator:function(t,a,i){return e.form.getFieldValue(\"useDefault\")[0]||a?i():i(\"非默认风险需要设置风险值\")}},{pattern:/^[0-9]+(.[0-9]{2})?$/,message:\"风险值为正实数，且小数点后面保留2位\"}]}},{type:\"Input\",label:\"风险描述\",name:\"resultDisc\",span:24,placeholder:\"风险描述（长度500以内）\",options:{initialValue:l.resultDisc}},{type:\"Radio\",label:\"风险累计方式\",name:\"accumulatemethod\",span:24,list:[\"无累计\",\"乘法(风险值*风险变量值)\",\"加法(风险值+风险变量值)\"],options:{initialValue:l.accumulatemethod},onChange:function(t){\"无累计\"==t&&e.setState({isRiskvariablevalue:!0})}},{type:\"Input\",label:\"风险变量值\",name:\"riskvariablevalue\",span:24,placeholder:\"风险变量值（非无累计情况下必填，数字）\",options:{initialValue:u,rules:[{pattern:/^[0-9]+(.[0-9]{2})?$/,message:\"风险变量值为正实数，且小数点后面保留2位\"}]},hide:function(){return!!(e.form&&\"无累计\"==e.form.getFieldValue(\"accumulatemethod\")||!e.form&&\"无累计\"==l.accumulatemethod||e.form&&!e.form.getFieldValue(\"accumulatemethod\")&&\"无累计\"==l.accumulatemethod)}},{type:\"Input\",label:\"建议措施\",name:\"measures\",span:24,placeholder:\"建议措施（长度500以内）\",options:{initialValue:l.measures,rules:[{max:500,message:\"缓解措施长度不可超过500\"}]}},{type:\"Input\",label:\"优先级\",name:\"priority\",span:24,placeholder:\"优先级（非空，数字）\",options:{initialValue:l.priority,rules:[{pattern:/^[1-9]\\d{0,3}$/,message:\"风险优先级为4位以内的数值\"}]}},{type:\"Checkbox\",label:\"默认\",name:\"useDefault\",span:7,list:[{label:\"\",value:!0}],options:{initialValue:[s]}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:15,placeholder:\"默认值（默认情况下必填，数字）\",options:{initialValue:l.defaultValue,rules:[{validator:function(t,a,i){return e.form.getFieldValue(\"useDefault\")[0]&&!a?i(\"默认风险需要设置对应的默认风险值\"):i()}},{pattern:/^[0-9]+(.[0-9]{2})?$/,message:\"默认风险值为正实数，且小数点后面保留2位\"}]}},{type:\"Checkbox\",label:\"生效\",name:\"valid\",span:7,list:[{label:\"\",value:!0}],options:{initialValue:[r]}}]}},{key:\"render\",value:function(){var t=this,a=this.state,i=a.table,n=a.selectedRowKeys,o=a.authorityList,l={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},s={columns:this.columns,table:i,scroll:{x:\"1532px\"},rowSelection:{selectedRowKeys:n,onChange:function(e,a){t.onChecked(e,a)}},onChange:this.getList},u={options:{title:\"add\"==this.state.currentAction?\"新增\":\"edit\"==this.state.currentAction?\"编辑\":\"\",width:\"650px\",bodyStyle:{height:\"443px\",overflow:\"auto\"},okButtonProps:{loading:this.state.modalOkBtnLoading}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)},d=this.getFormOptions();return e.createElement(r.CardCommon,null,o&&e.createElement(r.CommonForm,{options:this.searchFormOptions,btnOptions:l,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.searcForm=e.props.form)}}),e.createElement(\"div\",{className:\"buttons\"},e.createElement(r.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),o&&e.createElement(r.CommonTable,{options:s,onChecked:this.onChecked}),!o&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),e.createElement(r.CommonModal,u,e.createElement(\"div\",{className:\"form-grid-6\"},e.createElement(r.CommonForm,{options:d,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),g);function g(e){!function(e,t){if(!(e instanceof g))throw new TypeError(\"Cannot call a class as a function\")}(this);var t=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,e));return t.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.state.table;a.setPage(e);var i=a.getParmaData();(0,d.post)({url:\"associateRisk/queryRiskByName\",data:i,success:function(e){if(e&&e.rows){var n=e.rows.map(function(e,t){return e.index=(i.pageNum-1)*i.pageSize+t+1,e});a.setPage({dataList:n,total:e.total,pageNum:i.pageNum,pageSize:i.pageSize}),t.setState({table:a,selectedRowKeys:[],selectedRows:[]})}}})},t.onChecked=function(e,a){t.setState({selectedRowKeys:e,selectedRows:a})},t.search=function(){t.searcForm.validateFields(function(e,a){e||(a=(0,u.handleInParams)(a),t.getList({params:a,pageNum:1}))})},t.add=function(e){e(),t.setState({currentAction:\"add\"}),t.modal.show()},t.edit=function(e){0==t.state.selectedRows.length?(e(),i.default.warning(\"必须选择一个选项才能编辑！\")):1<t.state.selectedRows.length?(e(),i.default.warning(\"只能选择一个选项！\")):(e(),t.setState({currentAction:\"edit\",isRiskvariablevalue:!1}),t.modal.show())},t.submit=function(){t.setState({modalOkBtnLoading:!0}),t.form.validateFields(function(e,a){e?t.setState({modalOkBtnLoading:!1}):(a.useDefault=a.useDefault[0],a.valid=a.valid[0],a=(0,u.handleInParams)(a),(0,d.post)({url:\"associateRisk/saveRisk\",data:a,btn:function(){return t.setState({modalOkBtnLoading:!1})},success:function(e){var a=\"add\"==t.state.currentAction?\"添加成功\":\"修改成功\";i.default.success(a),t.modal.hide(),t.getList()}}))})},t.del=function(e){if(0==t.state.selectedRows.length)e(),i.default.warning(\"请至少选择一行数据\");else{var a=t.state.selectedRows.map(function(e){return e.useDefault=\"是\"==e.useDefault,e.valid=\"是\"==e.valid,e}),n=a.map(function(e){return e.name});m({title:\"确认删除【\"+n.join(\"、\")+\"】风险?\",okType:\"danger\",onOk:function(){(0,d.post)({url:\"associateRisk/deleteRisk\",data:{risks:JSON.stringify(a)},btn:e,success:function(e){i.default.success(\"删除成功\"),t.getList()}})},onCancel:e})}},t.state={table:new c.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",id:f,icon:\"plus-circle\",onClick:t.add},{name:\"修改\",id:f,icon:\"edit\",onClick:t.edit},{name:\"删除\",id:h,icon:\"minus-circle\",onClick:t.del}].filter(function(t){return(0,u.isAuthority)(t.id,e.authority)}),authorityList:(0,u.isAuthority)(\"relateRiskTarget.list\",e.authority),modalOkBtnLoading:!1,currentAction:\"\",isRiskvariablevalue:!1},t.searchFormOptions=[{type:\"Input\",label:\"风险名称\",name:\"riskName\",span:6,placeholder:\"风险名称\"}],t.columns=[{title:\"编号\",dataIndex:\"id\",width:46,fixed:\"left\"},{title:\"风险名\",dataIndex:\"name\",width:150,fixed:\"left\",isTooltip:!0},{title:\"规则描述\",dataIndex:\"ruleDisc\",width:220,isTooltip:!0},{title:\"风险等级\",dataIndex:\"riskLevel\",width:76},{title:\"风险值\",dataIndex:\"riskValue\",width:64},{title:\"风险描述\",dataIndex:\"resultDisc\",width:220,isTooltip:!0},{title:\"风险累计方式\",dataIndex:\"accumulatemethod\",width:180,isTooltip:!0},{title:\"风险变量\",dataIndex:\"riskvariablevalue\",width:76},{title:\"建议措施\",dataIndex:\"measures\",width:220,isTooltip:!0},{title:\"优先级\",dataIndex:\"priority\",width:64},{title:\"默认\",dataIndex:\"useDefault\",width:46},{title:\"默认值\",dataIndex:\"defaultValue\",width:64},{title:\"生效\",dataIndex:\"valid\",width:46}],t.searcForm,t.modal,t.form,t}t.default=(0,s.connect)(function(e){return{authority:e.authority}})((0,l.withRouter)(b))}).call(this,a(1))}}]);","extractedComments":[]}