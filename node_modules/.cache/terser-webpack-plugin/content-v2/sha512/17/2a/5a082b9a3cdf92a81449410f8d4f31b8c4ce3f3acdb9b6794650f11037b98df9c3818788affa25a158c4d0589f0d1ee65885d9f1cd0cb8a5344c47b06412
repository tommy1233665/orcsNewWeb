{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{446:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var o=h(n(145)),a=h(n(84)),i=h(n(28)),s=h(n(34)),r=function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e};function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n(144),n(221),n(27),n(33);var u=n(20),c=n(24),d=n(25),m=n(22),p=n(21),f=h(n(31));function h(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function g(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function b(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=s.default.confirm,w=\"role.add\",k=\"role.edit\",C=\"role.del\",R=(b(O,e.Component),r(O,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getRolesDetail\",value:function(e,t){(0,p.post)({url:\"sysRole/getPermissionsDetailByRoleId\",data:{roleId:e},success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"getSearchFormOptions\",value:function(){return[{type:\"Input\",label:\"角色名称\",name:\"name\",span:6}]}},{key:\"getAddFormOptions\",value:function(){return[{type:\"Input\",label:\"角色名称\",name:\"name\",span:22,options:{rules:[{required:!0,message:\"角色名称不可为空！\"}]}},{type:\"Input\",label:\"角色描述\",name:\"roleDesc\",span:22},{type:\"Select\",label:\"角色状态\",name:\"available\",span:22,list:this.state.statusList,isHasAllSelect:!1,options:{rules:[{required:!0,message:\"角色状态不可为空！\"}]}}]}},{key:\"getFormOptions\",value:function(){var e=this.state.currentRole,t=[{type:\"Input\",label:\"角色名称\",name:\"name\",span:8,length:5,options:{initialValue:e.name,rules:[{required:!0,message:\"角色名称不可为空！\"}]}},{type:\"Input\",label:\"角色描述\",name:\"roleDesc\",span:8,length:4,options:{initialValue:e.roleDesc}},{type:\"Select\",label:\"角色状态\",name:\"available\",span:8,length:5,list:this.state.statusList,isHasAllSelect:!1,options:{initialValue:e.available,rules:[{required:!0,message:\"角色状态不可为空！\"}]}}];return\"detail\"==this.state.currentAction&&(t=t.map(function(e){return e.disabled=!0,e})),t}},{key:\"render\",value:function(){var t=this,n=this.state,o=n.table,a=n.modalOkBtnLoading,i=n.currentAction,s=n.detailData,r=n.selectedRowKeys,l=n.authorityList,u=n.editHasAuthority,c=n.detailHasAuthority,m=this.getSearchFormOptions(),p={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},f={table:o,onChange:this.getList,columns:this.columns,rowSelection:{selectedRowKeys:r,onChange:function(e,n){t.onChecked(e,n)}}},h={options:{title:\"新增角色\",okButtonProps:{loading:a}},onRef:function(e){t.addModal=e},ok:this.addSubmit.bind(this)},y=this.getAddFormOptions(),g={options:{title:\"edit\"==i?\"修改角色权限信息\":\"查看角色拥有权限\",width:\"800px\",okButtonProps:{loading:a}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};(u&&\"edit\"==i||c&&\"detail\"==i)&&(g.options.bodyStyle={height:\"500px\",overflow:\"auto\"}),\"detail\"==i&&(g.options.footer=null);var b=this.getFormOptions();return e.createElement(d.CardCommon,null,l&&e.createElement(d.CommonForm,{options:m,btnOptions:p,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.searcForm=e.props.form)}}),e.createElement(\"div\",{className:\"buttons\"},e.createElement(d.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),l&&e.createElement(d.CommonTable,{options:f,onChecked:this.onChecked}),!l&&e.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),e.createElement(d.CommonModal,h,e.createElement(\"div\",{className:\"form-grid-6\"},e.createElement(d.CommonForm,{options:y,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.addForm=e.props.form)}}))),e.createElement(d.CommonModal,g,e.createElement(\"div\",null,e.createElement(d.CommonForm,{options:b,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),u&&\"edit\"==i&&e.createElement(S,{detailData:s,currentAction:i,onRef:function(e){return t.tableCustom=e}}),c&&\"detail\"==i&&e.createElement(S,{detailData:s,currentAction:i,onRef:function(e){return t.tableCustom=e}}))))}}]),O);function O(t){y(this,O);var n=g(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,t));return n.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=n.state.table;t.setPage(e);var o=t.getParmaData();(0,p.post)({url:\"sysRole/querySysRoleListByParam\",data:o,success:function(e){if(e&&e.rows){var a=e.rows.map(function(e,t){return e.index=(o.pageNum-1)*o.pageSize+t+1,e});t.setPage({dataList:a,total:e.total,pageNum:o.pageNum,pageSize:o.pageSize}),n.setState({table:t,selectedRowKeys:[],selectedRows:[]})}}})},n.onChecked=function(e,t){n.setState({selectedRowKeys:e,selectedRows:t})},n.search=function(){n.searcForm.validateFields(function(e,t){e||(t=(0,m.handleInParams)(t),n.getList({params:t,pageNum:1}))})},n.add=function(e){e(),n.addModal.show()},n.addSubmit=function(){n.setState({modalOkBtnLoading:!0}),n.addForm.validateFields(function(e,t){e?n.setState({modalOkBtnLoading:!1}):(t=(0,m.handleInParams)(t),(0,p.post)({url:\"sysRole/insert\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){i.default.success(\"添加角色成功！\"),n.addModal.hide(),n.getList({pageNum:1})}}))})},n.edit=function(e){0==n.state.selectedRows.length?(e(),i.default.warning(\"必须选择一个选项才能编辑！\")):1<n.state.selectedRows.length?(e(),i.default.warning(\"只能选择一个选项！\")):(e(),n.getRolesDetail(n.state.selectedRows[0].id,function(e){n.setState({currentAction:\"edit\",currentRole:n.state.selectedRows[0],detailData:e.mapList}),n.modal.show()}))},n.detail=function(e){n.getRolesDetail(e.id,function(t){n.setState({currentAction:\"detail\",currentRole:e,detailData:t.mapList}),n.modal.show()})},n.submit=function(){n.setState({modalOkBtnLoading:!0}),n.form.validateFields(function(e,t){if(e)n.setState({modalOkBtnLoading:!1});else{if((t=(0,m.handleInParams)(t)).roleId=n.state.currentRole.id,n.state.editHasAuthority){var o=n.tableCustom.getValues();Object.assign(t,o)}(0,p.post)({url:\"sysRole/updateRolePermissions\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){i.default.success(\"修改成功\"),n.modal.hide(),n.getList({pageNum:1})}})}})},n.del=function(e){if(0==n.state.selectedRows.length)e(),i.default.warning(\"请至少选择一行数据\");else{var t=n.state.selectedRows.map(function(e){return e.id}),o=n.state.selectedRows.map(function(e){return e.name});v({title:\"确认删除【\"+o.join(\"、\")+\"】吗?\",okType:\"danger\",onOk:function(){(0,p.post)({url:\"sysRole/delete\",data:{roleIds:t},btn:e,success:function(e){i.default.success(\"删除成功\"),n.getList({pageNum:1})}})},onCancel:e})}},n.state={table:new f.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",id:w,icon:\"plus-circle\",onClick:n.add},{name:\"修改\",id:k,icon:\"edit\",onClick:n.edit},{name:\"删除\",id:C,icon:\"minus-circle\",onClick:n.del}].filter(function(e){return(0,m.isAuthority)(e.id,t.authority)}),modalOkBtnLoading:!1,currentAction:\"\",statusList:[{key:\"1\",text:\"启用\"},{key:\"0\",text:\"禁用\"}],currentRole:{},detailData:{},authorityList:(0,m.isAuthority)(\"role.list\",t.authority),editHasAuthority:(0,m.isAuthority)(\"role.editHasAuthority\",t.authority),detailHasAuthority:(0,m.isAuthority)(\"role.detailHasAuthority\",t.authority)},n.columns=[{title:\"编号\",dataIndex:\"index\"},{title:\"角色名称 \",dataIndex:\"name\"},{title:\"角色描述 \",dataIndex:\"roleDesc\"},{title:\"角色状态\",dataIndex:\"available\",render:function(e){return\"1\"==e?\"启用\":\"禁用\"}},{title:\"权限\",key:\"action\",render:function(t){return e.createElement(\"a\",{onClick:function(){return n.detail(t)}},\"查看\")}}],n.searcForm,n.addModal,n.addForm,n.modal,n.form,n.tableCustom,n}var S=(b(L,e.Component),r(L,[{key:\"componentDidMount\",value:function(){this.props.onRef&&this.props.onRef(this)}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getValues\",value:function(){var e=this.props.form.getFieldsValue();for(var t in e)e[t]&&(e[t]=e[t].filter(function(e){if(e)return e}));var n=[];for(var t in e)-1<t.indexOf(\"-\")&&(n=n.concat(e[t]));return{permissionIds:n,branchCds:e.branchCds,branchCds2:e.branchCds2}}},{key:\"getEditDataSource\",value:function(){var e=this.props.detailData,t=e.branchMap,n=void 0===t?{}:t,o=e.branchMap2,a=void 0===o?{}:o,i=e.permissionMap,s=void 0===i?{}:i,r=[];if(0<Object.keys(s).length)for(var l in s){var u={systemModule:l,permissionsList:s[l],permissionsName:\"permissionIds-\"+l};for(var c in n)l==c&&(u.company=n[c],u.companyName=\"branchCds\");for(var d in a)l==d&&(u.company=a[d],u.companyName=\"branchCds2\");r.push(u)}return r}},{key:\"getEditColumnDom\",value:function(t,n,i){var s=this.props.form.getFieldDecorator,r=\"\";if(t){var l=t.map(function(e){return\"company\"==i?{label:e.branchCd+e.chnDescShort,value:e.branchCd}:{label:e.name,value:e.id}}),u=t.map(function(e){if(\"checked\"==e.checked)return\"company\"==i?e.branchCd:e.id}),c=\"company\"==i?n.companyName:n.permissionsName;r=e.createElement(o.default.Item,null,s(c,{initialValue:u})(e.createElement(a.default.Group,{options:l,disabled:\"detail\"==this.props.currentAction})))}return r}},{key:\"render\",value:function(){var t=this,n={notCheck:!0,columns:[{title:\"系统模块\",dataIndex:\"systemModule\",width:160},{title:\"公司 \",dataIndex:\"company\",width:232,className:\"text-left role-edit-select\",render:function(e,n){return t.getEditColumnDom(e,n,\"company\")}},{title:\"权限清单 \",dataIndex:\"permissionsList\",width:340,className:\"text-left role-edit-select\",render:function(e,n){return t.getEditColumnDom(e,n,\"permissionsList\")}}],table:{dataList:this.getEditDataSource(),loading:!1},needPage:!1};return e.createElement(o.default,null,e.createElement(d.CommonTable,{options:n}))}}]),L);function L(e){y(this,L);var t=g(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,e));return t.state={},t}S=o.default.create({})(S),t.default=(0,c.connect)(function(e){return{authority:e.authority}})((0,u.withRouter)(R))}).call(this,n(1))}}]);","extractedComments":[]}