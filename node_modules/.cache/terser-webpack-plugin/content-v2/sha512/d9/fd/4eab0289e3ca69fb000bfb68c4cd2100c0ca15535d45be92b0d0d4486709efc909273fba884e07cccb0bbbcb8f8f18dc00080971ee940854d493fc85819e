{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{411:function(t,e,a){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var i=g(a(28)),r=g(a(177)),s=g(a(36)),o=g(a(118));function n(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}a(27),a(175),a(35),a(217);var l=a(20),u=g(a(5)),c=a(24),h=a(181),f=a(25),y=a(23),d=a(22),m=g(a(32)),p=g(a(211)),k=g(a(1));function g(t){return t&&t.__esModule?t:{default:t}}o.default.SubMenu;var b=s.default.confirm,v=r.default.TabPane,C=(function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(R,k.default.Component),function(t,e,a){e&&n(t.prototype,e),a&&n(t,a)}(R,[{key:\"componentDidMount\",value:function(){var t=this;this.getData(),this.columns=(0,f.riskCAirportColumns)({detailUrl:this.detailUrl,onLook:function(e){t.setState({treeParams:{soflSeqNr:e.flightCode},fltNr:e.fltNr}),t.modal1.show(),t.getHisTotaleRiskValue({params:{soflSeqNr:e.flightCode}})}}),this.historyColumns=[{title:\"风险计算时间\",dataIndex:\"analysisTime\"},{title:\"起飞阶段风险值\",dataIndex:\"flyingRiskValue\"},{title:\"巡航阶段风险值\",dataIndex:\"cruiseRiskValue\"},{title:\"着陆阶段风险值\",dataIndex:\"landRiskValue\"},{title:\"风险明细\",key:\"action1\",render:function(e,a){return k.default.createElement(\"a\",{onClick:function(){return t.onLook2(a)}},\"查看\")}},{title:\"风险详情\",key:\"action2\",render:function(e,a){var r=t.state,s=r.isHistory,o=r.authorityHistoryDetail,n=r.authorityHistoryDetailHistory;return s&&n||!s&&o?k.default.createElement(l.Link,{to:\"\"+t.detailUrl+a.flightCode+\"/\"+a.batchNum,target:\"_blank\"},\"查看\"):k.default.createElement(\"a\",{onClick:function(){i.default.info(\"没有权限查看\")}},\"查看\")}}],this.state.isHistory||(this.timer=setInterval(function(){t.refresh()},3e4))}},{key:\"componentWillUnmount\",value:function(){this.state.isHistory||clearInterval(this.timer),this.setState=function(t,e){}}},{key:\"componentDidUpdate\",value:function(){document.addEventListener(\"keydown\",this.onkeydown)}},{key:\"onLook2\",value:function(t){var e=this.state,a=e.isHistory,r=e.authorityHistoryTree,s=e.authorityHistoryTreeHistory;a&&s||!a&&r?(this.setState({treeParams:{soflSeqNr:t.flightCode,batchNum:t.batchNum}}),this.modal2.show()):i.default.info(\"没有查看权限\")}},{key:\"refresh\",value:function(){var t=this;(0,d.post)({url:\"airLineRisk/queryRedisKeys\",success:function(e){\"1\"==e.success&&t.getList()}})}},{key:\"getData\",value:function(){var t=this,e=this.state.isHistory?\"airLineRisk/queryHisRiskFlightAll\":\"airLineRisk/queryRiskFlightAll\";(0,d.post)({url:e,success:function(e){t.setState({form:e}),t.getList()}})}},{key:\"calculate\",value:function(t){var e=this.state.selectedRows;if(0==e.length)return s.default.info({content:\"请选择需要计算的航班！!\"}),void t();var a=i.default.loading(\"后台正在计算，耐心等候\",0),r=e.map(function(t){return\"flitSoflSeqNrs=\"+t.soflSeqNr}),o=this;(0,d.post)({url:\"droolsEngine/math\",data:r.join(\"&\"),timeout:1200,btn:function(){t(),a&&\"function\"==typeof a&&a()},success:function(t){t.success?b({title:\"计算风险完毕！是否需要刷新页面？\",onOk:function(){o.getList({params:{filtSoflSeqNrs:e.map(function(t){return t.soflSeqNr})},pageNum:1})}}):i.default.error(\"网络出错，计算风险值失败！\")}})}},{key:\"warnList\",value:function(t){t();var e=\"/index/flightRisk/RiskWarnList\",a=(0,y.getCurrentMenu)(this.props,e);this.props.updateCurrentMenu({currentMenus:a}),(0,y.href)(this,e)}},{key:\"handleSearchParams\",value:function(t){var e=(0,y.handleInParams)(t);for(var a in e)\"date\"==a&&2==e[a].length&&(e.start=(0,u.default)(e[a][0]).format(\"YYYY-MM-DD\"),e.end=(0,u.default)(e[a][1]).format(\"YYYY-MM-DD\"),delete e[a]),\"latestEqpCds\"==a&&!Array.isArray(e[a])&&e[a].value&&(e[a]=e[a].value),\"riskTabs\"==a&&\"\"!=e[a]&&(e[a]=e[a].value),\"riskValue\"==a&&\"\"!=e[a]&&(e[a]=e[a].value);return e}},{key:\"getFormOptions\",value:function(){var t=this,e=this.state,a=e.isHistory,i=e.riskParamsMapList,r=this.state.form.branchInfoList.filter(function(t){return\"CKG\"!=t.branchCd}).map(function(t,e){return{key:t.branchCd,text:t.branchCd+t.chnDescShort}}),s=this.state.form.performanceTypeList.map(function(t){return{label:t.performanceType,value:t.performanceType}}),o=a?(0,u.default)().subtract(3,\"days\"):(0,u.default)(),n={date:[o,o],comp:a?this.state.form.userBelongsToCompany:\"\",latestEqpCds:s.map(function(t){return t.value}),flightStatus:\"\",riskValue:\"\",riskTabs:\"\",sorder:\"update_time\"};return[{type:\"RangePicker\",label:\"航班日期\",name:\"date\",span:8,options:{initialValue:n.date}},{type:\"Input\",label:\"出发机场\",name:\"latestDepArpChineseName\",span:6,placeholder:\"出发机场，如：广州,CAN,ZGGG\",options:{initialValue:n.latestDepArpChineseName}},{type:\"Input\",label:\"航班号\",name:\"fltNr\",span:6,length:3,placeholder:\"航班号，如：3027\",options:{initialValue:n.fltNr}},{type:\"Select\",label:\"阶段\",name:\"flightStatus\",span:4,length:3,list:[{key:\"flying\",text:\"起飞阶段\"},{key:\"cruise\",text:\"巡航阶段\"},{key:\"landed\",text:\"着陆阶段\"}],options:{initialValue:n.flightStatus}},{type:\"Select\",label:\"公司\",name:\"comp\",span:function(){return t.form&&t.form.getFieldValue(\"comp\"),8},list:r,options:{initialValue:n.comp}},{type:\"Input\",label:\"到达机场\",name:\"latestArvArpChineseName\",span:6,placeholder:\"到达机场，如：南京,NKG,ZSNJ\",options:{initialValue:n.latestArvArpChineseName}},{type:\"Input\",label:\"机尾号\",name:\"latestTailNr\",span:6,length:3,placeholder:\"机尾号，如：B6378\",options:{initialValue:n.latestTailNr}},{type:\"Select\",label:\"排序\",name:\"order\",span:4,length:3,list:[{key:\"update_time\",text:\"按更新时间\"},{key:\"latest_dep_dt\",text:\"按滑出时间\"},{key:\"latest_arv_dt\",text:\"按滑入时间\"},{key:\"total_value\",text:\"按风险值\"}],options:{initialValue:n.sorder}},{type:\"CheckboxCustom\",label:\"机型组\",name:\"latestEqpCds\",span:16,list:s,options:{initialValue:n.latestEqpCds}},{type:\"RiskTabsTreeSelect\",label:\"风险项\",name:\"riskTabs\",span:4,length:3,list:i,options:{initialValue:n.riskTabs}},{type:\"MultipleSelect\",label:\"风险值\",name:\"riskValue\",span:4,length:3,list:[{key:\"H\",text:\"高\"},{key:\"M\",text:\"中\"},{key:\"L\",text:\"低\"}],options:{initialValue:n.riskValue}}]}},{key:\"render\",value:function(){var t=this,e=this.getFormOptions(),a=this.state,i=a.isHistory,s=a.treeParams,o=a.table,n=a.historyTable,l=a.selectedRowKeys,u=a.authorityList,c=a.authorityCountFlightRiskValue,h=a.authorityCurrentTree,y=a.authorityCurrentTreeHistory,d=a.authorityHistoryList,m=a.authorityHistoryListHistory,g={table:o,columns:this.columns,rowSelection:{selectedRowKeys:l,onChange:function(e,a){t.onChecked(e,a)}},onChange:this.getList},b={notCheck:!0,table:n,columns:this.historyColumns,onChange:this.getHisTotaleRiskValue},C=u?[{name:\"查询\",id:u,type:\"primary\",icon:\"search\",onClick:this.submit.bind(this)},{name:\"重置\",id:u,icon:\"reload\",onClick:this.reset.bind(this)}]:[];i||(c&&C.push({name:\"计算\",icon:\"calculator\",type:\"primary\",onClick:this.calculate.bind(this)}),C.push({name:\"告警列表\",icon:\"unordered-list\",onClick:this.warnList.bind(this)}));var R={options:{title:\"风险节点信息\",footer:null,width:\"60%\"},onRef:function(e){t.modal1=e}},w={options:{title:\"历史风险值展示\",footer:null,bodyStyle:{height:\"443px\",overflow:\"auto\"}},onRef:function(e){t.modal2=e}};return k.default.createElement(f.CardCommon,{className:\"flight-risk\"},u&&k.default.createElement(f.CommonForm,{options:e,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),k.default.createElement(\"div\",{className:\"buttons clearfix\"},k.default.createElement(f.CommonBtns,{btns:C}),k.default.createElement(\"div\",{className:\"fr\"},k.default.createElement(f.ChartsTip,{low:\"1.0-4.0\",middle:\"4.1-7.0\",height:\"7.1-10.0\"}),k.default.createElement(\"div\",{className:\"text-danger text-right\"},\"*以北京时间显示\"))),u&&k.default.createElement(f.CommonTable,{options:g,onChecked:this.onChecked}),!u&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),k.default.createElement(f.CommonModal,R,k.default.createElement(r.default,{className:\"flight-risk-tab\",defaultActiveKey:\"1\",size:\"small\"},k.default.createElement(v,{tab:\"当前风险\",key:\"1\"},h&&!i&&k.default.createElement(p.default,{treeParams:s,isHistory:i,hasAction:!i}),!h&&!i&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),y&&i&&k.default.createElement(p.default,{treeParams:s,isHistory:i,hasAction:!i}),!y&&i&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\")),k.default.createElement(v,{tab:\"历史风险\",key:\"2\"},d&&!i&&k.default.createElement(f.CommonTable,{options:b}),!d&&!i&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),m&&i&&k.default.createElement(f.CommonTable,{options:b}),!m&&i&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),k.default.createElement(f.CommonModal,w,k.default.createElement(p.default,{treeParams:s,isHistory:i}))))))}}]),R);function R(t){!function(t,e){if(!(t instanceof R))throw new TypeError(\"Cannot call a class as a function\")}(this);var e=function(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,t));e.onkeydown=function(t){13===t.keyCode&&e.submit()},e.onChecked=function(t,a){e.setState({selectedRowKeys:t,selectedRows:a})},e.getList=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.form?e.handleSearchParams(e.form.getFieldsValue()):{};t.params=Object.assign({},a,t.params);var i=e.state.table;i.setPage(t);var r=i.getParmaData();if(!(r.fltNr||r.latestDepArpChineseName&&r.latestArvArpChineseName)){var o=(0,u.default)(r.start,\"YYYY-MM-DD\");if(2880<=(0,u.default)(r.end,\"YYYY-MM-DD\").diff(o,\"minute\"))return void s.default.info({content:\"未指定航班或航线，只能查询1天范围数据！\"})}var n=e.state.isHistory?\"airLineRisk/queryHisRiskFlightByParam\":\"airLineRisk/queryAirLineRiskByParam\";(0,d.post)({url:n,data:r,success:function(t){if(t&&t.pages){var a=t.pages;i.setPage({dataList:a.list,total:a.total,pageNum:a.pageNum,pageSize:a.pageSize}),e.setState({table:i,selectedRowKeys:[],selectedRows:[]})}}})},e.getHisTotaleRiskValue=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.state.historyTable;a.setPage(t);var i=a.getParmaData(),r=e.state.isHistory?\"airLineRisk/queryTotalRiskValueForHis\":\"airLineRisk/queryHisTotaleRiskValue\";(0,d.post)({url:r,data:i,success:function(t){var i=t.rmRiskpages;a.setPage({dataList:i.list,total:i.total,pageNum:i.pageNum,pageSize:i.pageSize}),e.setState({historyTable:a})}})},e.submit=function(t){t&&\"function\"==typeof t&&t(),event.preventDefault(),e.form.validateFields(function(t,a){t||(a=e.handleSearchParams(a),e.getList({params:a,pageNum:1}))})},e.reset=function(t){t&&\"function\"==typeof t&&t(),e.form.resetFields(),e.submit()};var a=-1!=t.match.path.indexOf(\"History\"),i=a?\"flightRiskShow.listHistory\":\"flightRiskShow.list\";return e.state={isHistory:a,table:new m.default,selectedRowKeys:[],selectedRows:[],treeParams:{},form:{performanceTypeList:[],branchInfoList:[],userBelongsToCompany:\"\"},historyTable:new m.default({pageSize:5}),fltNr:\"\",authorityList:(0,y.isAuthority)(i,t.authority),authorityCountFlightRiskValue:(0,y.isAuthority)(\"flightRiskShow.countFlightRiskValue\",t.authority),authorityCurrentTree:(0,y.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityCurrentTreeHistory:(0,y.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityHistoryList:(0,y.isAuthority)(\"flightRiskShow.historyList\",t.authority),authorityHistoryListHistory:(0,y.isAuthority)(\"flightRiskShow.historyListHistory\",t.authority),authorityHistoryTree:(0,y.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryTreeHistory:(0,y.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryDetail:(0,y.isAuthority)(\"flightRiskShow.historyDetail\",t.authority),authorityHistoryDetailHistory:(0,y.isAuthority)(\"flightRiskShow.historyDetail\",t.authority)},e.columns,e.historyColumns,e.form,e.modal1,e.modal2,e.detailUrl=e.state.isHistory?\"/HistoryFlightRiskDetail/\":\"/FlightRiskDetail/\",e.timer,e}e.default=(0,c.connect)(function(t){return{permission:t.permission,currentMenu:t.currentMenu,authority:t.authority}},function(t){return{updateCurrentMenu:function(e){return t((0,h.updateCurrentMenu)(e))}}})((0,l.withRouter)(C))}}]);","extractedComments":[]}