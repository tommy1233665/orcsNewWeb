{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{429:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var o=p(n(178)),a=p(n(81)),s=p(n(25)),i=p(n(34)),r=function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e};function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n(177),n(211),n(24),n(33);var c=n(23),u=n(26),d=n(21),m=p(n(31));function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function h(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function g(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=i.default.confirm,y=(g(v,e.Component),r(v,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getRolesDetail\",value:function(e,t){(0,d.post)({url:\"sysRole/getPermissionsDetailByRoleId\",data:{roleId:e},success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"getSearchFormOptions\",value:function(){return[{type:\"Input\",label:\"角色名称\",name:\"name\",span:6}]}},{key:\"getAddFormOptions\",value:function(){return[{type:\"Input\",label:\"角色名称\",name:\"name\",span:22,options:{rules:[{required:!0,message:\"角色名称不可为空！\"}]}},{type:\"Input\",label:\"角色描述\",name:\"roleDesc\",span:22},{type:\"Select\",label:\"角色状态\",name:\"available\",span:22,list:this.state.statusList,isHasAllSelect:!1,options:{rules:[{required:!0,message:\"角色状态不可为空！\"}]}}]}},{key:\"getFormOptions\",value:function(){var e=this.state.currentRole,t=[{type:\"Input\",label:\"角色名称\",name:\"name\",span:8,length:5,options:{initialValue:e.name,rules:[{required:!0,message:\"角色名称不可为空！\"}]}},{type:\"Input\",label:\"角色描述\",name:\"roleDesc\",span:8,length:4,options:{initialValue:e.roleDesc}},{type:\"Select\",label:\"角色状态\",name:\"available\",span:8,length:5,list:this.state.statusList,isHasAllSelect:!1,options:{initialValue:e.available,rules:[{required:!0,message:\"角色状态不可为空！\"}]}}];return\"detail\"==this.state.currentAction&&(t=t.map(function(e){return e.disabled=!0,e})),t}},{key:\"render\",value:function(){var t=this,n=this.state,o=n.table,a=n.modalOkBtnLoading,s=n.currentAction,i=n.detailData,r=n.selectedRowKeys,l=this.getSearchFormOptions(),u={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},d={table:o,onChange:this.getList,columns:this.columns,rowSelection:{selectedRowKeys:r,onChange:function(e,n){t.onChecked(e,n)}}},m={options:{title:\"新增角色\",okButtonProps:{loading:a}},onRef:function(e){t.addModal=e},ok:this.addSubmit.bind(this)},p=this.getAddFormOptions(),f={options:{title:\"edit\"==s?\"修改角色权限信息\":\"查看角色拥有权限\",width:\"800px\",bodyStyle:{height:\"500px\",overflow:\"auto\"},okButtonProps:{loading:a}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};\"detail\"==s&&(f.options.footer=null);var h=this.getFormOptions();return e.createElement(c.CardCommon,null,e.createElement(c.CommonForm,{options:l,btnOptions:u,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.searcForm=e.props.form)}}),e.createElement(\"div\",{className:\"buttons\"},e.createElement(c.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),e.createElement(c.CommonTable,{options:d,onChecked:this.onChecked}),e.createElement(c.CommonModal,m,e.createElement(\"div\",{className:\"form-grid-6\"},e.createElement(c.CommonForm,{options:p,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.addForm=e.props.form)}}))),e.createElement(c.CommonModal,f,e.createElement(\"div\",null,e.createElement(c.CommonForm,{options:h,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),e.createElement(w,{detailData:i,currentAction:s,onRef:function(e){return t.tableCustom=e}}))))}}]),v);function v(t){f(this,v);var n=h(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,t));return n.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=n.state.table;t.setPage(e);var o=t.getParmaData();(0,d.post)({url:\"sysRole/querySysRoleListByParam\",data:o,success:function(e){if(e&&e.rows){var a=e.rows.map(function(e,t){return e.index=(o.pageNum-1)*o.pageSize+t+1,e});t.setPage({dataList:a,total:e.total,pageNum:o.pageNum,pageSize:o.pageSize}),n.setState({table:t,selectedRowKeys:[],selectedRows:[]})}}})},n.onChecked=function(e,t){n.setState({selectedRowKeys:e,selectedRows:t})},n.search=function(){n.searcForm.validateFields(function(e,t){e||(t=(0,u.handleInParams)(t),n.getList({params:t,pageNum:1}))})},n.add=function(e){e(),n.addModal.show()},n.addSubmit=function(){n.setState({modalOkBtnLoading:!0}),n.addForm.validateFields(function(e,t){e?n.setState({modalOkBtnLoading:!1}):(t=(0,u.handleInParams)(t),(0,d.post)({url:\"sysRole/insert\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){s.default.success(\"添加角色成功！\"),n.addModal.hide(),n.getList({pageNum:1})}}))})},n.edit=function(e){0==n.state.selectedRows.length?(e(),s.default.warning(\"必须选择一个选项才能编辑！\")):1<n.state.selectedRows.length?(e(),s.default.warning(\"只能选择一个选项！\")):(e(),n.getRolesDetail(n.state.selectedRows[0].id,function(e){n.setState({currentAction:\"edit\",currentRole:n.state.selectedRows[0],detailData:e.mapList}),n.modal.show()}))},n.detail=function(e){n.getRolesDetail(e.id,function(t){n.setState({currentAction:\"detail\",currentRole:e,detailData:t.mapList}),n.modal.show()})},n.submit=function(){n.setState({modalOkBtnLoading:!0}),n.form.validateFields(function(e,t){if(e)n.setState({modalOkBtnLoading:!1});else{(t=(0,u.handleInParams)(t)).roleId=n.state.currentRole.id;var o=n.tableCustom.getValues();Object.assign(t,o),(0,d.post)({url:\"sysRole/updateRolePermissions\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){s.default.success(\"修改成功\"),n.modal.hide(),n.getList({pageNum:1})}})}})},n.del=function(e){if(0==n.state.selectedRows.length)e(),s.default.warning(\"请至少选择一行数据\");else{var t=n.state.selectedRows.map(function(e){return e.id}),o=n.state.selectedRows.map(function(e){return e.name});b({title:\"确认删除【\"+o.join(\"、\")+\"】吗?\",okType:\"danger\",onOk:function(){(0,d.post)({url:\"sysRole/delete\",data:{roleIds:t},btn:e,success:function(e){s.default.success(\"删除成功\"),n.getList({pageNum:1})}})},onCancel:e})}},n.state={table:new m.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",icon:\"plus-circle\",onClick:n.add},{name:\"修改\",icon:\"edit\",onClick:n.edit},{name:\"删除\",icon:\"minus-circle\",onClick:n.del}],modalOkBtnLoading:!1,currentAction:\"\",statusList:[{key:\"1\",text:\"启用\"},{key:\"0\",text:\"禁用\"}],currentRole:{},detailData:{}},n.columns=[{title:\"编号\",dataIndex:\"index\"},{title:\"角色名称 \",dataIndex:\"name\"},{title:\"角色描述 \",dataIndex:\"roleDesc\"},{title:\"角色状态\",dataIndex:\"available\",render:function(e){return\"1\"==e?\"启用\":\"禁用\"}},{title:\"权限\",key:\"action\",render:function(t){return e.createElement(\"a\",{onClick:function(){return n.detail(t)}},\"查看\")}}],n.searcForm,n.addModal,n.addForm,n.modal,n.form,n.tableCustom,n}var w=(g(k,e.Component),r(k,[{key:\"componentDidMount\",value:function(){this.props.onRef&&this.props.onRef(this)}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getValues\",value:function(){var e=this.props.form.getFieldsValue();for(var t in e)e[t]&&(e[t]=e[t].filter(function(e){if(e)return e}));var n=[];for(var t in e)-1<t.indexOf(\"-\")&&(n=n.concat(e[t]));return{permissionIds:n,branchCds:e.branchCds,branchCds2:e.branchCds2}}},{key:\"getEditDataSource\",value:function(){var e=this.props.detailData,t=e.branchMap,n=void 0===t?{}:t,o=e.branchMap2,a=void 0===o?{}:o,s=e.permissionMap,i=void 0===s?{}:s,r=[];if(0<Object.keys(i).length)for(var l in i){var c={systemModule:l,permissionsList:i[l],permissionsName:\"permissionIds-\"+l};for(var u in n)l==u&&(c.company=n[u],c.companyName=\"branchCds\");for(var d in a)l==d&&(c.company=a[d],c.companyName=\"branchCds2\");r.push(c)}return r}},{key:\"getEditColumnDom\",value:function(t,n,s){var i=this.props.form.getFieldDecorator,r=\"\";if(t){var l=t.map(function(e){return\"company\"==s?{label:e.branchCd+e.chnDescShort,value:e.branchCd}:{label:e.name,value:e.id}}),c=t.map(function(e){if(\"checked\"==e.checked)return\"company\"==s?e.branchCd:e.id}),u=\"company\"==s?n.companyName:n.permissionsName;r=e.createElement(o.default.Item,null,i(u,{initialValue:c})(e.createElement(a.default.Group,{options:l,disabled:\"detail\"==this.props.currentAction})))}return r}},{key:\"render\",value:function(){var t=this,n={notCheck:!0,columns:[{title:\"系统模块\",dataIndex:\"systemModule\",width:160},{title:\"公司 \",dataIndex:\"company\",width:232,className:\"text-left role-edit-select\",render:function(e,n){return t.getEditColumnDom(e,n,\"company\")}},{title:\"权限清单 \",dataIndex:\"permissionsList\",width:340,className:\"text-left role-edit-select\",render:function(e,n){return t.getEditColumnDom(e,n,\"permissionsList\")}}],table:{dataList:this.getEditDataSource(),loading:!1},needPage:!1};return e.createElement(o.default,null,e.createElement(c.CommonTable,{options:n}))}}]),k);function k(e){f(this,k);var t=h(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e));return t.state={},t}w=o.default.create({})(w),t.default=y}).call(this,n(1))}}]);","extractedComments":[]}