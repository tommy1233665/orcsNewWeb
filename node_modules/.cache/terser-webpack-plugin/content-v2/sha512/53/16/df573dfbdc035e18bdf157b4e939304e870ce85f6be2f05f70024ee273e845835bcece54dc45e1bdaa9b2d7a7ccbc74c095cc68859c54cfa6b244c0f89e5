{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{409:function(t,e,i){\"use strict\";(function(t){Object.defineProperty(e,\"__esModule\",{value:!0});var a=d(i(28)),o=d(i(244)),r=d(i(36));function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}i(27),i(243),i(35);var n=i(20),l=d(i(5)),u=i(25),c=i(214),h=i(26),f=i(23),y=i(22),m=d(i(33)),p=d(i(208));function d(t){return t&&t.__esModule?t:{default:t}}var g=r.default.confirm,k=o.default.TabPane,b=(function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(v,t.Component),function(t,e,i){e&&s(t.prototype,e),i&&s(t,i)}(v,[{key:\"componentDidMount\",value:function(){var e=this;this.getData(),this.columns=(0,h.riskCAirportColumns)({detailUrl:this.detailUrl,onLook:function(t){e.setState({treeParams:{soflSeqNr:t.flightCode},fltNr:t.fltNr}),e.modal1.show(),e.getHisTotaleRiskValue({params:{soflSeqNr:t.flightCode}})}}),this.historyColumns=[{title:\"风险计算时间\",dataIndex:\"analysisTime\"},{title:\"起飞阶段风险值\",dataIndex:\"flyingRiskValue\"},{title:\"巡航阶段风险值\",dataIndex:\"cruiseRiskValue\"},{title:\"着陆阶段风险值\",dataIndex:\"landRiskValue\"},{title:\"风险明细\",key:\"action1\",render:function(i,a){return t.createElement(\"a\",{onClick:function(){return e.onLook2(a)}},\"查看\")}},{title:\"风险详情\",key:\"action2\",render:function(i,o){var r=e.state,s=r.isHistory,l=r.authorityHistoryDetail,u=r.authorityHistoryDetailHistory;return s&&u||!s&&l?t.createElement(n.Link,{to:\"\"+e.detailUrl+o.flightCode+\"/\"+o.batchNum,target:\"_blank\"},\"查看\"):t.createElement(\"a\",{onClick:function(){a.default.info(\"没有权限查看\")}},\"查看\")}}],this.state.isHistory||(this.timer=setInterval(function(){e.refresh()},3e4))}},{key:\"componentWillUnmount\",value:function(){this.state.isHistory||clearInterval(this.timer),this.setState=function(t,e){}}},{key:\"onLook2\",value:function(t){var e=this.state,i=e.isHistory,o=e.authorityHistoryTree,r=e.authorityHistoryTreeHistory;i&&r||!i&&o?(this.setState({treeParams:{soflSeqNr:t.flightCode,batchNum:t.batchNum}}),this.modal2.show()):a.default.info(\"没有查看权限\")}},{key:\"refresh\",value:function(){var t=this;(0,y.post)({url:\"airLineRisk/queryRedisKeys\",success:function(e){\"1\"==e.success&&t.getList()}})}},{key:\"getData\",value:function(){var t=this,e=this.state.isHistory?\"airLineRisk/queryHisRiskFlightAll\":\"airLineRisk/queryRiskFlightAll\";(0,y.post)({url:e,success:function(e){t.setState({form:e}),t.getList()}})}},{key:\"calculate\",value:function(t){var e=this.state.selectedRows;if(0==e.length)return r.default.info({content:\"请选择需要计算的航班！!\"}),void t();var i=a.default.loading(\"后台正在计算，耐心等候\",0),o=e.map(function(t){return\"flitSoflSeqNrs=\"+t.soflSeqNr}),s=this;(0,y.post)({url:\"droolsEngine/math\",data:o.join(\"&\"),timeout:1200,btn:function(){t(),i&&\"function\"==typeof i&&i()},success:function(t){t.success?g({title:\"计算风险完毕！是否需要刷新页面？\",onOk:function(){s.getList({params:{filtSoflSeqNrs:e.map(function(t){return t.soflSeqNr})},pageNum:1})}}):a.default.error(\"网络出错，计算风险值失败！\")}})}},{key:\"warnList\",value:function(t){t();var e=\"/index/flightRisk/RiskWarnList\",i=(0,f.getCurrentMenu)(this.props,e);this.props.updateCurrentMenu({currentMenus:i}),(0,f.href)(this,e)}},{key:\"handleSearchParams\",value:function(t){var e=(0,f.handleInParams)(t);for(var i in e)\"date\"==i&&2==e[i].length&&(e.start=(0,l.default)(e[i][0]).format(\"YYYY-MM-DD\"),e.end=(0,l.default)(e[i][1]).format(\"YYYY-MM-DD\"),delete e[i]),\"latestEqpCds\"==i&&!Array.isArray(e[i])&&e[i].value&&(e[i]=e[i].value);return e}},{key:\"getFormOptions\",value:function(){var t=this,e=this.state.isHistory,i=this.state.form.branchInfoList.filter(function(t){return\"CKG\"!=t.branchCd}).map(function(t,e){return{key:t.branchCd,text:t.branchCd+t.chnDescShort}}),a=this.state.form.performanceTypeList.map(function(t){return{label:t.performanceType,value:t.performanceType}}),o=e?(0,l.default)().subtract(7,\"days\"):(0,l.default)(),r={date:[o,o],comp:e?this.state.form.userBelongsToCompany:\"\",condition:\"conditionBranchCode\",latestEqpCds:a.map(function(t){return t.value}),flightStatus:\"\",riskValue:\"\",sorder:\"total_value\"};return[{type:\"RangePicker\",label:\"航班日期\",name:\"date\",span:8,options:{initialValue:r.date}},{type:\"Input\",label:\"出发机场\",name:\"latestDepArpChineseName\",span:6,placeholder:\"出发机场，如：广州\",options:{initialValue:r.latestDepArpChineseName}},{type:\"Input\",label:\"航班号\",name:\"fltNr\",span:6,length:3,placeholder:\"航班号，如：3027\",options:{initialValue:r.fltNr}},{type:\"Select\",label:\"阶段\",name:\"flightStatus\",span:4,length:3,list:[{key:\"flying\",text:\"起飞阶段\"},{key:\"cruise\",text:\"巡航阶段\"},{key:\"landed\",text:\"着陆阶段\"}],options:{initialValue:r.flightStatus}},{type:\"Select\",label:\"公司\",name:\"comp\",span:function(){return t.form&&\"\"==t.form.getFieldValue(\"comp\")?8:5},list:i,options:{initialValue:r.comp}},{type:\"Select\",name:\"condition\",span:3,list:[{key:\"conditionTailNr\",text:\"按飞机\"},{key:\"conditionBranchCode\",text:\"按航班\"},{key:\"crew\",text:\"按机组\"}],options:{initialValue:r.condition},isHasAllSelect:!1,hide:function(){return!(!t.form||\"\"!=t.form.getFieldValue(\"comp\"))}},{type:\"Input\",label:\"到达机场\",name:\"latestArvArpChineseName\",span:6,placeholder:\"到达机场，如：南京\",options:{initialValue:r.latestArvArpChineseName}},{type:\"Input\",label:\"机尾号\",name:\"latestTailNr\",span:6,length:3,placeholder:\"机尾号，如：B6378\",options:{initialValue:r.latestTailNr}},{type:\"Select\",label:\"排序\",name:\"order\",span:4,length:3,list:[{key:\"total_value\",text:\"按风险值\"},{key:\"latest_dep_dt\",text:\"按滑出时间\"},{key:\"latest_arv_dt\",text:\"按滑入时间\"},{key:\"update_time\",text:\"按更新时间\"}],options:{initialValue:r.sorder}},{type:\"CheckboxCustom\",label:\"机型组\",name:\"latestEqpCds\",span:20,list:a,options:{initialValue:r.latestEqpCds}},{type:\"Select\",label:\"风险值\",name:\"riskValue\",span:4,length:3,list:[{key:\"H\",text:\"高\"},{key:\"M\",text:\"中\"},{key:\"L\",text:\"低\"}],options:{initialValue:r.riskValue}}]}},{key:\"render\",value:function(){var e=this,i=this.getFormOptions(),a=this.state,r=a.isHistory,s=a.treeParams,n=a.table,l=a.historyTable,u=a.selectedRowKeys,c=a.authorityList,f=a.authorityCountFlightRiskValue,y=a.authorityCurrentTree,m=a.authorityCurrentTreeHistory,d=a.authorityHistoryList,g=a.authorityHistoryListHistory,b={table:n,columns:this.columns,rowSelection:{selectedRowKeys:u,onChange:function(t,i){e.onChecked(t,i)}},onChange:this.getList},v={notCheck:!0,table:l,columns:this.historyColumns,onChange:this.getHisTotaleRiskValue},C=c?[{name:\"查询\",id:c,type:\"primary\",icon:\"search\",onClick:this.submit.bind(this)},{name:\"重置\",id:c,icon:\"reload\",onClick:this.reset.bind(this)}]:[];r||(f&&C.push({name:\"计算\",icon:\"calculator\",type:\"primary\",onClick:this.calculate.bind(this)}),C.push({name:\"告警列表\",icon:\"unordered-list\",onClick:this.warnList.bind(this)}));var R={options:{title:\"风险节点信息\",footer:null,width:\"60%\"},onRef:function(t){e.modal1=t}},S={options:{title:\"历史风险值展示\",footer:null,bodyStyle:{height:\"443px\",overflow:\"auto\"}},onRef:function(t){e.modal2=t}};return t.createElement(h.CardCommon,{className:\"flight-risk\"},c&&t.createElement(h.CommonForm,{options:i,wrappedComponentRef:function(t){t&&t.props&&t.props.form&&(e.form=t.props.form)}}),t.createElement(\"div\",{className:\"buttons clearfix\"},t.createElement(h.CommonBtns,{btns:C}),t.createElement(\"div\",{className:\"fr\"},t.createElement(h.ChartsTip,{low:\"1.0-4.0\",middle:\"4.1-7.0\",height:\"7.1-10.0\"}),t.createElement(\"div\",{className:\"text-danger text-right\"},\"*以北京时间显示\"))),c&&t.createElement(h.CommonTable,{options:b,onChecked:this.onChecked}),!c&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),t.createElement(h.CommonModal,R,t.createElement(o.default,{className:\"flight-risk-tab\",defaultActiveKey:\"1\",size:\"small\"},t.createElement(k,{tab:\"当前风险\",key:\"1\"},y&&!r&&t.createElement(p.default,{treeParams:s,isHistory:r,hasAction:!r}),!y&&!r&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),m&&r&&t.createElement(p.default,{treeParams:s,isHistory:r,hasAction:!r}),!m&&r&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\")),t.createElement(k,{tab:\"历史风险\",key:\"2\"},d&&!r&&t.createElement(h.CommonTable,{options:v}),!d&&!r&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),g&&r&&t.createElement(h.CommonTable,{options:v}),!g&&r&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),t.createElement(h.CommonModal,S,t.createElement(p.default,{treeParams:s,isHistory:r}))))))}}]),v);function v(t){!function(t,e){if(!(t instanceof v))throw new TypeError(\"Cannot call a class as a function\")}(this);var e=function(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,t));e.onChecked=function(t,i){e.setState({selectedRowKeys:t,selectedRows:i})},e.getList=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.form?e.handleSearchParams(e.form.getFieldsValue()):{};t.params=Object.assign({},i,t.params);var a=e.state.table;a.setPage(t);var o=a.getParmaData();if(!(o.fltNr||o.latestDepArpChineseName&&o.latestArvArpChineseName)){var s=(0,l.default)(o.start,\"YYYY-MM-DD\");if(2880<=(0,l.default)(o.end,\"YYYY-MM-DD\").diff(s,\"minute\"))return void r.default.info({content:\"未指定航班或航线，只能查询1天范围数据！\"})}var n=e.state.isHistory?\"airLineRisk/queryHisRiskFlightByParam\":\"airLineRisk/queryAirLineRiskByParam\";(0,y.post)({url:n,data:o,success:function(t){if(t&&t.pages){var i=t.pages;a.setPage({dataList:i.list,total:i.total,pageNum:i.pageNum,pageSize:i.pageSize}),e.setState({table:a,selectedRowKeys:[],selectedRows:[]})}}})},e.getHisTotaleRiskValue=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.state.historyTable;i.setPage(t);var a=i.getParmaData(),o=e.state.isHistory?\"airLineRisk/queryTotalRiskValueForHis\":\"airLineRisk/queryHisTotaleRiskValue\";(0,y.post)({url:o,data:a,success:function(t){var a=t.rmRiskpages;i.setPage({dataList:a.list,total:a.total,pageNum:a.pageNum,pageSize:a.pageSize}),e.setState({historyTable:i})}})},e.submit=function(t){t&&\"function\"==typeof t&&t(),event.preventDefault(),e.form.validateFields(function(t,i){t||(i=e.handleSearchParams(i),e.getList({params:i,pageNum:1}))})},e.reset=function(t){t&&\"function\"==typeof t&&t(),e.form.resetFields(),e.submit()};var i=-1!=t.match.path.indexOf(\"History\"),a=i?\"flightRiskShow.listHistory\":\"flightRiskShow.list\";return e.state={isHistory:i,table:new m.default,selectedRowKeys:[],selectedRows:[],treeParams:{},form:{performanceTypeList:[],branchInfoList:[],userBelongsToCompany:\"\"},historyTable:new m.default({pageSize:5}),fltNr:\"\",authorityList:(0,f.isAuthority)(a,t.authority),authorityCountFlightRiskValue:(0,f.isAuthority)(\"flightRiskShow.countFlightRiskValue\",t.authority),authorityCurrentTree:(0,f.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityCurrentTreeHistory:(0,f.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityHistoryList:(0,f.isAuthority)(\"flightRiskShow.historyList\",t.authority),authorityHistoryListHistory:(0,f.isAuthority)(\"flightRiskShow.historyListHistory\",t.authority),authorityHistoryTree:(0,f.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryTreeHistory:(0,f.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryDetail:(0,f.isAuthority)(\"flightRiskShow.historyDetail\",t.authority),authorityHistoryDetailHistory:(0,f.isAuthority)(\"flightRiskShow.historyDetail\",t.authority)},e.columns,e.historyColumns,e.form,e.modal1,e.modal2,e.detailUrl=e.state.isHistory?\"/HistoryFlightRiskDetail/\":\"/FlightRiskDetail/\",e.timer,e}e.default=(0,u.connect)(function(t){return{permission:t.permission,currentMenu:t.currentMenu,authority:t.authority}},function(t){return{updateCurrentMenu:function(e){return t((0,c.updateCurrentMenu)(e))}}})((0,n.withRouter)(b))}).call(this,i(1))}}]);","extractedComments":[]}