{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{409:function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});var a=g(i(28)),r=g(i(245)),o=g(i(36)),s=g(i(117));function n(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}i(27),i(244),i(35),i(214);var l=i(20),u=g(i(5)),c=i(25),h=i(215),f=i(26),d=i(23),y=i(22),m=g(i(33)),p=g(i(208)),k=g(i(1));function g(t){return t&&t.__esModule?t:{default:t}}s.default.SubMenu;var b=o.default.confirm,v=r.default.TabPane,C=(function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(R,k.default.Component),function(t,e,i){e&&n(t.prototype,e),i&&n(t,i)}(R,[{key:\"componentDidMount\",value:function(){var t=this;this.getData(),this.columns=(0,f.riskCAirportColumns)({detailUrl:this.detailUrl,onLook:function(e){t.setState({treeParams:{soflSeqNr:e.flightCode},fltNr:e.fltNr}),t.modal1.show(),t.getHisTotaleRiskValue({params:{soflSeqNr:e.flightCode}})}}),this.historyColumns=[{title:\"风险计算时间\",dataIndex:\"analysisTime\"},{title:\"起飞阶段风险值\",dataIndex:\"flyingRiskValue\"},{title:\"巡航阶段风险值\",dataIndex:\"cruiseRiskValue\"},{title:\"着陆阶段风险值\",dataIndex:\"landRiskValue\"},{title:\"风险明细\",key:\"action1\",render:function(e,i){return k.default.createElement(\"a\",{onClick:function(){return t.onLook2(i)}},\"查看\")}},{title:\"风险详情\",key:\"action2\",render:function(e,i){var r=t.state,o=r.isHistory,s=r.authorityHistoryDetail,n=r.authorityHistoryDetailHistory;return o&&n||!o&&s?k.default.createElement(l.Link,{to:\"\"+t.detailUrl+i.flightCode+\"/\"+i.batchNum,target:\"_blank\"},\"查看\"):k.default.createElement(\"a\",{onClick:function(){a.default.info(\"没有权限查看\")}},\"查看\")}}],this.state.isHistory||(this.timer=setInterval(function(){t.refresh()},3e4))}},{key:\"componentWillUnmount\",value:function(){this.state.isHistory||clearInterval(this.timer),this.setState=function(t,e){}}},{key:\"componentDidUpdate\",value:function(){document.addEventListener(\"keydown\",this.onkeydown)}},{key:\"onLook2\",value:function(t){var e=this.state,i=e.isHistory,r=e.authorityHistoryTree,o=e.authorityHistoryTreeHistory;i&&o||!i&&r?(this.setState({treeParams:{soflSeqNr:t.flightCode,batchNum:t.batchNum}}),this.modal2.show()):a.default.info(\"没有查看权限\")}},{key:\"refresh\",value:function(){var t=this;(0,y.post)({url:\"airLineRisk/queryRedisKeys\",success:function(e){\"1\"==e.success&&t.getList()}})}},{key:\"getData\",value:function(){var t=this,e=this.state.isHistory?\"airLineRisk/queryHisRiskFlightAll\":\"airLineRisk/queryRiskFlightAll\";(0,y.post)({url:e,success:function(e){t.setState({form:e}),t.getList()}})}},{key:\"calculate\",value:function(t){var e=this.state.selectedRows;if(0==e.length)return o.default.info({content:\"请选择需要计算的航班！!\"}),void t();var i=a.default.loading(\"后台正在计算，耐心等候\",0),r=e.map(function(t){return\"flitSoflSeqNrs=\"+t.soflSeqNr}),s=this;(0,y.post)({url:\"droolsEngine/math\",data:r.join(\"&\"),timeout:1200,btn:function(){t(),i&&\"function\"==typeof i&&i()},success:function(t){t.success?b({title:\"计算风险完毕！是否需要刷新页面？\",onOk:function(){s.getList({params:{filtSoflSeqNrs:e.map(function(t){return t.soflSeqNr})},pageNum:1})}}):a.default.error(\"网络出错，计算风险值失败！\")}})}},{key:\"warnList\",value:function(t){t();var e=\"/index/flightRisk/RiskWarnList\",i=(0,d.getCurrentMenu)(this.props,e);this.props.updateCurrentMenu({currentMenus:i}),(0,d.href)(this,e)}},{key:\"handleSearchParams\",value:function(t){var e=(0,d.handleInParams)(t);for(var i in e)\"date\"==i&&2==e[i].length&&(e.start=(0,u.default)(e[i][0]).format(\"YYYY-MM-DD\"),e.end=(0,u.default)(e[i][1]).format(\"YYYY-MM-DD\"),delete e[i]),\"latestEqpCds\"==i&&!Array.isArray(e[i])&&e[i].value&&(e[i]=e[i].value),\"riskTabs\"==i&&\"\"!=e[i]&&(e[i]=e[i].value),\"riskValue\"==i&&\"\"!=e[i]&&(e[i]=e[i].value);return e}},{key:\"getFormOptions\",value:function(){var t=this,e=this.state,i=e.isHistory,a=e.riskParamsMapList,r=this.state.form.branchInfoList.filter(function(t){return\"CKG\"!=t.branchCd}).map(function(t,e){return{key:t.branchCd,text:t.branchCd+t.chnDescShort}}),o=this.state.form.performanceTypeList.map(function(t){return{label:t.performanceType,value:t.performanceType}}),s=i?(0,u.default)().subtract(3,\"days\"):(0,u.default)(),n={date:[s,s],comp:i?this.state.form.userBelongsToCompany:\"\",condition:\"conditionBranchCode\",latestEqpCds:o.map(function(t){return t.value}),flightStatus:\"\",riskValue:\"\",riskTabs:\"\",sorder:\"update_time\"};return[{type:\"RangePicker\",label:\"航班日期\",name:\"date\",span:8,options:{initialValue:n.date}},{type:\"Input\",label:\"出发机场\",name:\"latestDepArpChineseName\",span:6,placeholder:\"出发机场，如：广州,CAN,ZGGG\",options:{initialValue:n.latestDepArpChineseName}},{type:\"Input\",label:\"航班号\",name:\"fltNr\",span:6,length:3,placeholder:\"航班号，如：3027\",options:{initialValue:n.fltNr}},{type:\"Select\",label:\"阶段\",name:\"flightStatus\",span:4,length:3,list:[{key:\"flying\",text:\"起飞阶段\"},{key:\"cruise\",text:\"巡航阶段\"},{key:\"landed\",text:\"着陆阶段\"}],options:{initialValue:n.flightStatus}},{type:\"Select\",label:\"公司\",name:\"comp\",span:function(){return t.form&&t.form.getFieldValue(\"comp\"),8},list:r,options:{initialValue:n.comp}},{type:\"Input\",label:\"到达机场\",name:\"latestArvArpChineseName\",span:6,placeholder:\"到达机场，如：南京,NKG,ZSNJ\",options:{initialValue:n.latestArvArpChineseName}},{type:\"Input\",label:\"机尾号\",name:\"latestTailNr\",span:6,length:3,placeholder:\"机尾号，如：B6378\",options:{initialValue:n.latestTailNr}},{type:\"Select\",label:\"排序\",name:\"order\",span:4,length:3,list:[{key:\"update_time\",text:\"按更新时间\"},{key:\"latest_dep_dt\",text:\"按滑出时间\"},{key:\"latest_arv_dt\",text:\"按滑入时间\"},{key:\"total_value\",text:\"按风险值\"}],options:{initialValue:n.sorder}},{type:\"CheckboxCustom\",label:\"机型组\",name:\"latestEqpCds\",span:16,list:o,options:{initialValue:n.latestEqpCds}},{type:\"RiskTabsTreeSelect\",label:\"风险项\",name:\"riskTabs\",span:4,length:3,list:a,options:{initialValue:n.riskTabs}},{type:\"MultipleSelect\",label:\"风险值\",name:\"riskValue\",span:4,length:3,list:[{key:\"H\",text:\"高\"},{key:\"M\",text:\"中\"},{key:\"L\",text:\"低\"}],options:{initialValue:n.riskValue}}]}},{key:\"render\",value:function(){var t=this,e=this.getFormOptions(),i=this.state,a=i.isHistory,o=i.treeParams,s=i.table,n=i.historyTable,l=i.selectedRowKeys,u=i.authorityList,c=i.authorityCountFlightRiskValue,h=i.authorityCurrentTree,d=i.authorityCurrentTreeHistory,y=i.authorityHistoryList,m=i.authorityHistoryListHistory,g={table:s,columns:this.columns,rowSelection:{selectedRowKeys:l,onChange:function(e,i){t.onChecked(e,i)}},onChange:this.getList},b={notCheck:!0,table:n,columns:this.historyColumns,onChange:this.getHisTotaleRiskValue},C=u?[{name:\"查询\",id:u,type:\"primary\",icon:\"search\",onClick:this.submit.bind(this)},{name:\"重置\",id:u,icon:\"reload\",onClick:this.reset.bind(this)}]:[];a||(c&&C.push({name:\"计算\",icon:\"calculator\",type:\"primary\",onClick:this.calculate.bind(this)}),C.push({name:\"告警列表\",icon:\"unordered-list\",onClick:this.warnList.bind(this)}));var R={options:{title:\"风险节点信息\",footer:null,width:\"60%\"},onRef:function(e){t.modal1=e}},w={options:{title:\"历史风险值展示\",footer:null,bodyStyle:{height:\"443px\",overflow:\"auto\"}},onRef:function(e){t.modal2=e}};return k.default.createElement(f.CardCommon,{className:\"flight-risk\"},u&&k.default.createElement(f.CommonForm,{options:e,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),k.default.createElement(\"div\",{className:\"buttons clearfix\"},k.default.createElement(f.CommonBtns,{btns:C}),k.default.createElement(\"div\",{className:\"fr\"},k.default.createElement(f.ChartsTip,{low:\"1.0-4.0\",middle:\"4.1-7.0\",height:\"7.1-10.0\"}),k.default.createElement(\"div\",{className:\"text-danger text-right\"},\"*以北京时间显示\"))),u&&k.default.createElement(f.CommonTable,{options:g,onChecked:this.onChecked}),!u&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),k.default.createElement(f.CommonModal,R,k.default.createElement(r.default,{className:\"flight-risk-tab\",defaultActiveKey:\"1\",size:\"small\"},k.default.createElement(v,{tab:\"当前风险\",key:\"1\"},h&&!a&&k.default.createElement(p.default,{treeParams:o,isHistory:a,hasAction:!a}),!h&&!a&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),d&&a&&k.default.createElement(p.default,{treeParams:o,isHistory:a,hasAction:!a}),!d&&a&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\")),k.default.createElement(v,{tab:\"历史风险\",key:\"2\"},y&&!a&&k.default.createElement(f.CommonTable,{options:b}),!y&&!a&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),m&&a&&k.default.createElement(f.CommonTable,{options:b}),!m&&a&&k.default.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),k.default.createElement(f.CommonModal,w,k.default.createElement(p.default,{treeParams:o,isHistory:a}))))))}}]),R);function R(t){!function(t,e){if(!(t instanceof R))throw new TypeError(\"Cannot call a class as a function\")}(this);var e=function(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,t));e.onkeydown=function(t){13===t.keyCode&&e.submit()},e.onChecked=function(t,i){e.setState({selectedRowKeys:t,selectedRows:i})},e.getList=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.form?e.handleSearchParams(e.form.getFieldsValue()):{};t.params=Object.assign({},i,t.params);var a=e.state.table;a.setPage(t);var r=a.getParmaData();if(!(r.fltNr||r.latestDepArpChineseName&&r.latestArvArpChineseName)){var s=(0,u.default)(r.start,\"YYYY-MM-DD\");if(2880<=(0,u.default)(r.end,\"YYYY-MM-DD\").diff(s,\"minute\"))return void o.default.info({content:\"未指定航班或航线，只能查询1天范围数据！\"})}var n=e.state.isHistory?\"airLineRisk/queryHisRiskFlightByParam\":\"airLineRisk/queryAirLineRiskByParam\";(0,y.post)({url:n,data:r,success:function(t){if(t&&t.pages){var i=t.pages;a.setPage({dataList:i.list,total:i.total,pageNum:i.pageNum,pageSize:i.pageSize}),e.setState({table:a,selectedRowKeys:[],selectedRows:[]})}}})},e.getHisTotaleRiskValue=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.state.historyTable;i.setPage(t);var a=i.getParmaData(),r=e.state.isHistory?\"airLineRisk/queryTotalRiskValueForHis\":\"airLineRisk/queryHisTotaleRiskValue\";(0,y.post)({url:r,data:a,success:function(t){var a=t.rmRiskpages;i.setPage({dataList:a.list,total:a.total,pageNum:a.pageNum,pageSize:a.pageSize}),e.setState({historyTable:i})}})},e.submit=function(t){t&&\"function\"==typeof t&&t(),event.preventDefault(),e.form.validateFields(function(t,i){t||(i=e.handleSearchParams(i),e.getList({params:i,pageNum:1}))})},e.reset=function(t){t&&\"function\"==typeof t&&t(),e.form.resetFields(),e.submit()};var i=-1!=t.match.path.indexOf(\"History\"),a=i?\"flightRiskShow.listHistory\":\"flightRiskShow.list\";return e.state={isHistory:i,table:new m.default,selectedRowKeys:[],selectedRows:[],treeParams:{},form:{performanceTypeList:[],branchInfoList:[],userBelongsToCompany:\"\"},historyTable:new m.default({pageSize:5}),fltNr:\"\",authorityList:(0,d.isAuthority)(a,t.authority),authorityCountFlightRiskValue:(0,d.isAuthority)(\"flightRiskShow.countFlightRiskValue\",t.authority),authorityCurrentTree:(0,d.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityCurrentTreeHistory:(0,d.isAuthority)(\"flightRiskShow.currentTree\",t.authority),authorityHistoryList:(0,d.isAuthority)(\"flightRiskShow.historyList\",t.authority),authorityHistoryListHistory:(0,d.isAuthority)(\"flightRiskShow.historyListHistory\",t.authority),authorityHistoryTree:(0,d.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryTreeHistory:(0,d.isAuthority)(\"flightRiskShow.historyTree\",t.authority),authorityHistoryDetail:(0,d.isAuthority)(\"flightRiskShow.historyDetail\",t.authority),authorityHistoryDetailHistory:(0,d.isAuthority)(\"flightRiskShow.historyDetail\",t.authority)},e.columns,e.historyColumns,e.form,e.modal1,e.modal2,e.detailUrl=e.state.isHistory?\"/HistoryFlightRiskDetail/\":\"/FlightRiskDetail/\",e.timer,e}e.default=(0,c.connect)(function(t){return{permission:t.permission,currentMenu:t.currentMenu,authority:t.authority}},function(t){return{updateCurrentMenu:function(e){return t((0,h.updateCurrentMenu)(e))}}})((0,l.withRouter)(C))}}]);","extractedComments":[]}