{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{418:function(t,e,n){\"use strict\";(function(t){Object.defineProperty(e,\"__esModule\",{value:!0});var a=g(n(125)),o=g(n(77)),i=g(n(28)),r=g(n(36)),s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},l=function(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t};function u(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}n(141),n(76),n(27),n(35);var d=n(20),c=n(25),m=n(26),p=n(23),f=n(22),h=g(n(33)),y=g(n(5));function g(t){return t&&t.__esModule?t:{default:t}}function k(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function b(t,e){if(!t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!e||\"object\"!=typeof e&&\"function\"!=typeof e?t:e}function w(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var v=r.default.confirm,R=\"rmRiskArpt.add\",C=\"rmRiskArpt.edit\",S=\"rmRiskArpt.del\",I=(w(x,t.Component),l(x,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(t,e){}}},{key:\"getSearchFormOptions\",value:function(){return[{type:\"Input\",label:\"关键字搜索\",name:\"rmArptRisk\",span:10,length:5,placeholder:\"请输入机场名称（全称）、三字码（全称）、四字码（全称）搜索\"}]}},{key:\"getAddFormOptions\",value:function(){return[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:22,options:{rules:[{required:!0,message:\"机场名称不可为空！\"}]}},{type:\"Input\",label:\"三字码\",name:\"arpCd\",span:22,options:{rules:[{required:!0,message:\"三字码不可为空！\"}]}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:22,options:{rules:[{required:!0,message:\"四字码不可为空！\"}]}},{type:\"Input\",label:\"起飞得分\",name:\"takeoffValue\",span:22},{type:\"Input\",label:\"着陆得分\",name:\"landValue\",span:22}]}},{key:\"getFormOptions\",value:function(){var t=this.state.currentData,e=[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:6,length:4,disabled:!0,options:{initialValue:t.arpName}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:6,length:3,disabled:!0,options:{initialValue:t.icaoCode}},{type:\"InputExplain\",label:\"起飞得分\",name:\"takeoffValue\",span:6,length:4,isHelp:\"根据机场起飞阶段的风险项目按一定算法综合得出，将参与起飞阶段风险值的计算。\",options:{initialValue:t.takeoffValue}},{type:\"InputExplain\",label:\"着陆得分\",name:\"landValue\",span:6,length:4,isHelp:\"根据机场着陆阶段的风险项目按一定算法综合得出，将参与着陆阶段风险值的计算。\",options:{initialValue:t.landValue}}];return\"detail\"==this.state.currentAction&&(e=e.map(function(t){return t.disabled=!0,t})),e}},{key:\"render\",value:function(){var e=this,n=this.state,a=n.table,o=n.modalOkBtnLoading,i=n.currentAction,r=n.currentData,s=n.selectedRowKeys,l=n.authorityList,u=(n.authorityDetail,this.getSearchFormOptions()),d={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},c={key:\"arpCd\",columns:this.columns,table:a,rowSelection:{selectedRowKeys:s,onChange:function(t,n){e.onChecked(t,n)}},onChange:this.getList},p={options:{title:\"新增\",okButtonProps:{loading:o}},onRef:function(t){e.addModal=t},ok:this.addSubmit.bind(this)},f=this.getAddFormOptions(),h={options:{title:(\"edit\"==i?\"编辑\":\"查看\")+\"机场风险详情\",width:\"1000px\",bodyStyle:{width:\"1000px\"},okButtonProps:{loading:o}},onRef:function(t){e.modal=t},ok:this.submit.bind(this)};\"detail\"==i&&(h.options.footer=null);var y=this.getFormOptions();return t.createElement(m.CardCommon,null,l&&t.createElement(m.CommonForm,{options:u,btnOptions:d,wrappedComponentRef:function(t){t&&t.props&&t.props.form&&(e.searcForm=t.props.form)}}),t.createElement(\"div\",{className:\"buttons\"},t.createElement(m.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),l&&t.createElement(m.CommonTable,{options:c,onChecked:this.onChecked}),!l&&t.createElement(\"div\",{className:\"no-authority-box\"},\"无权限查看\"),t.createElement(m.CommonModal,p,t.createElement(\"div\",{className:\"form-grid-6\"},t.createElement(m.CommonForm,{options:f,wrappedComponentRef:function(t){t&&t.props&&t.props.form&&(e.addForm=t.props.form)}}))),t.createElement(m.CommonModal,h,t.createElement(m.CommonForm,{options:y,wrappedComponentRef:function(t){t&&t.props&&t.props.form&&(e.form=t.props.form)}}),t.createElement(A,{datas:r,currentAction:i,onRef:function(t){return e.tableCustom=t}})))}}]),x);function x(e){k(this,x);var n=b(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,e));return n.getList=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=n.state.table;e.setPage(t);var a=e.getParmaData();(0,f.post)({url:\"rmRiskArpt/queryRmRiskArptListByParam\",data:a,success:function(t){if(t&&t.rows){var o=t.rows.map(function(t,e){return t.index=(a.pageNum-1)*a.pageSize+e+1,t});e.setPage({dataList:o,total:t.total,pageNum:a.pageNum,pageSize:a.pageSize}),n.setState({table:e,selectedRowKeys:[],selectedRows:[]})}}})},n.onChecked=function(t,e){n.setState({selectedRowKeys:t,selectedRows:e})},n.search=function(){n.searcForm.validateFields(function(t,e){t||(e=(0,p.handleInParams)(e),n.getList({params:e,pageNum:1}))})},n.add=function(t){t(),n.addModal.show()},n.addSubmit=function(){n.setState({modalOkBtnLoading:!0}),n.addForm.validateFields(function(t,e){t?n.setState({modalOkBtnLoading:!1}):(e=(0,p.handleInParams)(e),(0,f.post)({url:\"rmRiskArpt/addRmRiskArpt\",data:e,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(t){i.default.success(\"添加成功！\"),n.addModal.hide(),n.getList({pageNum:1})}}))})},n.edit=function(t){0==n.state.selectedRows.length?(t(),i.default.warning(\"必须选择一个选项才能编辑！\")):1<n.state.selectedRows.length?(t(),i.default.warning(\"只能选择一个选项！\")):(t(),n.setState({currentAction:\"edit\",currentData:n.state.selectedRows[0]}),n.modal.show())},n.detail=function(t){n.state.authorityDetail?(n.setState({currentAction:\"detail\",currentData:t}),n.modal.show()):i.default.info(\"无权限查看\")},n.submit=function(){n.setState({modalOkBtnLoading:!0}),n.form.validateFields(function(t,e){if(t)n.setState({modalOkBtnLoading:!1});else{for(var a in e)\"landValue\"!=a&&\"takeoffValue\"!=a||e[a]&&\"object\"==s(e[a])&&(e[a]=e[a].value);(e=(0,p.handleInParams)(e)).arpCd=n.state.currentData.arpCd,e.detailListStr=JSON.stringify(n.tableCustom.state.selectedRows),(0,f.post)({url:\"rmRiskArpt/updateRiskArptDetail\",data:e,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(t){i.default.success(\"修改成功\"),n.modal.hide(),n.getList({pageNum:1})}})}})},n.del=function(t){if(0==n.state.selectedRows.length)t(),i.default.warning(\"请至少选择一行数据\");else{var e=n.state.selectedRows.map(function(t){return t.arpCd}),a=n.state.selectedRows.map(function(t){return t.arpName});v({title:\"确认删除【\"+a.join(\"、\")+\"】吗?\",okType:\"danger\",onOk:function(){(0,f.post)({url:\"rmRiskArpt/delRmRiskArpt\",data:{ids:e},btn:t,success:function(t){i.default.success(\"删除成功\"),n.getList({pageNum:1})}})},onCancel:t})}},n.state={table:new h.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",id:R,icon:\"plus-circle\",onClick:n.add},{name:\"修改\",id:C,icon:\"edit\",onClick:n.edit},{name:\"删除\",id:S,icon:\"minus-circle\",onClick:n.del}].filter(function(t){return(0,p.isAuthority)(t.id,e.authority)}),modalOkBtnLoading:!1,currentAction:\"\",currentData:{},authorityList:(0,p.isAuthority)(\"rmRiskArpt.list\",e.authority),authorityDetail:(0,p.isAuthority)(\"rmRiskArpt.detail\",e.authority)},n.columns=[{title:\"序号\",dataIndex:\"index\"},{title:\"机场名称\",dataIndex:\"arpName\"},{title:\"三字码\",dataIndex:\"arpCd\"},{title:\"四字码\",dataIndex:\"icaoCode\"},{title:\"起飞得分\",dataIndex:\"takeoffValue\"},{title:\"着陆得分\",dataIndex:\"landValue\"},{title:\"更新人\",dataIndex:\"updateUser\"},{title:\"更新时间\",dataIndex:\"updateTime\"},{title:\"状态\",dataIndex:\"status\",render:function(e,a){return t.createElement(\"a\",{onClick:function(){return n.detail(a)}},e)}}],n.addModal,n.addForm,n.modal,n.form,n.tableCustom,n}var A=(w(D,t.Component),l(D,[{key:\"componentDidMount\",value:function(){var t=this;this.props.onRef&&this.props.onRef(this),this.getDefaultArp(function(e){t.getList(e)});var e=this;document.onclick=function(t){\"TD\"!=t.target.nodeName&&(\"DIV\"!=t.target.nodeName||t.target.onclick)||e.setState({edit:!1})}}},{key:\"componentWillUnmount\",value:function(){this.setState=function(t,e){}}},{key:\"getDom\",value:function(e,n,i){var r=this;return\"detail\"==this.props.currentAction?t.createElement(\"div\",null,n):this.state.edit&&i.arpRiskParamId==this.state.selected.arpRiskParamId?t.createElement(a.default,{title:n},t.createElement(o.default,{defaultValue:n,onChange:function(t){return r.onChange(e,i,t)},autoComplete:\"off\"})):\"riskDetail\"==e?t.createElement(\"div\",{style:{minHeight:\"22px\"},onClick:this.onStartEdit.bind(this,i)},n):\"invalidTime\"==e?t.createElement(\"div\",null,n):void 0}},{key:\"onChange\",value:function(t,e,n){var a=this.state.dataSource.map(function(a){return a.arpRiskParamId==e.arpRiskParamId&&(a[t]=n.target.value),a});this.setState({dataSource:a})}},{key:\"onStartEdit\",value:function(t){t.invalidTime||(t.invalidTime=this.getInvalidTime(t.operPeriod)),this.setState({edit:!0,selected:t})}},{key:\"getInvalidTime\",value:function(t){switch(t){case\"一年\":return(0,y.default)().subtract(-1,\"years\").format(\"YYYY-MM-DD HH:mm:ss\");case\"半年\":return(0,y.default)().subtract(-6,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"三个月\":return(0,y.default)().subtract(-3,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"暂无要求\":default:var e=(0,y.default)().format(\"YYYY-MM-DD HH:mm:ss\");return e.replace(e.slice(0,4),\"2999\")}}},{key:\"getDefaultArp\",value:function(t){(0,f.post)({url:\"rmRiskArpt/queryDefaultArpOptions\",data:{arpCd:this.props.datas.arpCd},success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"render\",value:function(){var e=this,n=this.state,a=n.dataSource,o=n.selectedRowKeys,i=n.loading,r={key:\"itemNum\",columns:this.columns,table:{dataList:a,loading:i},scroll:{x:\"750px\",y:\"300px\"},rowSelection:{selectedRowKeys:o,onChange:function(t,n){e.onChecked(t,n)},getCheckboxProps:function(t){return{disabled:\"detail\"==e.props.currentAction}}},needPage:!1};return t.createElement(t.Fragment,null,t.createElement(\"div\",null,\"选择机场风险因素\"),t.createElement(m.CommonTabs,{className:\"mt20 mb20\",tabs:this.state.tabs,onClick:this.onTab}),t.createElement(m.CommonTable,{options:r,onChecked:this.onChecked}))}}]),D);function D(e){k(this,D);var n=b(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,e));return n.getList=function(t){(0,f.post)({url:\"rmRiskArpt/queryrmRiskArptDetail\",data:{arpCd:n.props.datas.arpCd},success:function(e){if(e&&e.rows){var a=e.rows.map(function(t,e){return t.index=e+1,t}),o=[],i=[];t.forEach(function(t){a.forEach(function(e,n){t==e.arpRiskParamId&&(o.push(e.itemNum),i.push(e))})}),n.setState({dataSource:a,selectedRowKeys:o,selectedRows:i,loading:!1})}}})},n.onTab=function(t,e){var a,o=n.state.dataSource;for(e=0;e<o.length-1;e++)o[0].flyPhase==t.name?a=1:o[e].flyPhase!=o[e+1].flyPhase&&o[e+1].flyPhase==t.name&&(a=e+1);var i=document.getElementById(a);i&&i.scrollIntoView()},n.onChecked=function(t,e){n.setState({selectedRowKeys:t,selectedRows:e})},n.state={tabs:[{name:\"多阶段并存风险\"},{name:\"机坪运行阶段\"},{name:\"起飞阶段\"},{name:\"离场阶段\"},{name:\"进场阶段\"},{name:\"进近阶段\"},{name:\"五边阶段\"},{name:\"着陆阶段\"},{name:\"复飞阶段\"}],dataSource:[],selectedRows:[],selectedRowKeys:[],edit:!1,selected:{},loading:!0},n.columns=[{title:\"编号\",dataIndex:\"index\",width:50,render:function(e){return t.createElement(\"div\",{id:e},e)}},{title:\"项目编号\",dataIndex:\"itemNum\",width:70},{title:\"风险因素\",dataIndex:\"riskItem\",width:220,className:\"text-left\"},{title:\"风险值\",dataIndex:\"riskValue\",width:50},{title:\"风险详细描述\",dataIndex:\"riskDetail\",width:100,className:\"text-left\",render:function(t,e){return n.getDom(\"riskDetail\",t,e)}},{title:\"维护期限\",dataIndex:\"operPeriod\",width:70},{title:\"失效日期\",dataIndex:\"invalidTime\",width:70,render:function(t,e){return n.getDom(\"invalidTime\",t,e)}},{title:\"更新时间\",dataIndex:\"updateTime\",width:70}],n}e.default=(0,c.connect)(function(t){return{authority:t.authority}})((0,d.withRouter)(I))}).call(this,n(1))}}]);","extractedComments":[]}