{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{417:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var a=f(n(124)),o=f(n(76)),i=f(n(25)),s=f(n(34)),r=function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e};function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n(141),n(75),n(24),n(33);var d=n(23),u=n(26),c=n(21),m=f(n(31)),p=f(n(5));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function g(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function k(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=s.default.confirm,y=(k(w,e.Component),r(w,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getSearchFormOptions\",value:function(){return[{type:\"Input\",label:\"关键字搜索\",name:\"rmArptRisk\",span:10,length:5,placeholder:\"请输入机场名称（全称）、三字码（全称）、四字码（全称）搜索\"}]}},{key:\"getAddFormOptions\",value:function(){return[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:22,options:{rules:[{required:!0,message:\"机场名称不可为空！\"}]}},{type:\"Input\",label:\"三字码\",name:\"arpCd\",span:22,options:{rules:[{required:!0,message:\"三字码不可为空！\"}]}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:22,options:{rules:[{required:!0,message:\"四字码不可为空！\"}]}},{type:\"Input\",label:\"起飞得分\",name:\"takeoffValue\",span:22},{type:\"Input\",label:\"着陆得分\",name:\"landValue\",span:22}]}},{key:\"getFormOptions\",value:function(){var e=this.state.currentData,t=[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:6,length:4,disabled:!0,options:{initialValue:e.arpName}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:6,length:3,disabled:!0,options:{initialValue:e.icaoCode}},{type:\"Input\",label:\"起飞得分\",name:\"takeoffValue\",span:6,length:4,options:{initialValue:e.takeoffValue}},{type:\"Input\",label:\"着陆得分\",name:\"landValue\",span:6,length:4,options:{initialValue:e.landValue}}];return\"detail\"==this.state.currentAction&&(t=t.map(function(e){return e.disabled=!0,e})),t}},{key:\"render\",value:function(){var t=this,n=this.state,a=n.table,o=n.modalOkBtnLoading,i=n.currentAction,s=n.currentData,r=n.selectedRowKeys,l=this.getSearchFormOptions(),u={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},c={key:\"arpCd\",columns:this.columns,table:a,rowSelection:{selectedRowKeys:r,onChange:function(e,n){t.onChecked(e,n)}},onChange:this.getList},m={options:{title:\"新增\",okButtonProps:{loading:o}},onRef:function(e){t.addModal=e},ok:this.addSubmit.bind(this)},p=this.getAddFormOptions(),f={options:{title:(\"edit\"==i?\"编辑\":\"查看\")+\"机场风险详情\",width:\"1000px\",bodyStyle:{width:\"1000px\"},okButtonProps:{loading:o}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};\"detail\"==i&&(f.options.footer=null);var h=this.getFormOptions();return e.createElement(d.CardCommon,null,e.createElement(d.CommonForm,{options:l,btnOptions:u,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.searcForm=e.props.form)}}),e.createElement(\"div\",{className:\"buttons\"},e.createElement(d.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),e.createElement(d.CommonTable,{options:c,onChecked:this.onChecked}),e.createElement(d.CommonModal,m,e.createElement(\"div\",{className:\"form-grid-6\"},e.createElement(d.CommonForm,{options:p,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.addForm=e.props.form)}}))),e.createElement(d.CommonModal,f,e.createElement(d.CommonForm,{options:h,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),e.createElement(v,{datas:s,currentAction:i,onRef:function(e){return t.tableCustom=e}})))}}]),w);function w(t){h(this,w);var n=g(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,t));return n.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=n.state.table;t.setPage(e);var a=t.getParmaData();(0,c.post)({url:\"rmRiskArpt/queryRmRiskArptListByParam\",data:a,success:function(e){if(e&&e.rows){var o=e.rows.map(function(e,t){return e.index=(a.pageNum-1)*a.pageSize+t+1,e});t.setPage({dataList:o,total:e.total,pageNum:a.pageNum,pageSize:a.pageSize}),n.setState({table:t,selectedRowKeys:[],selectedRows:[]})}}})},n.onChecked=function(e,t){n.setState({selectedRowKeys:e,selectedRows:t})},n.search=function(){n.searcForm.validateFields(function(e,t){e||(t=(0,u.handleInParams)(t),n.getList({params:t,pageNum:1}))})},n.add=function(e){e(),n.addModal.show()},n.addSubmit=function(){n.setState({modalOkBtnLoading:!0}),n.addForm.validateFields(function(e,t){e?n.setState({modalOkBtnLoading:!1}):(t=(0,u.handleInParams)(t),(0,c.post)({url:\"rmRiskArpt/addRmRiskArpt\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){i.default.success(\"添加成功！\"),n.addModal.hide(),n.getList({pageNum:1})}}))})},n.edit=function(e){0==n.state.selectedRows.length?(e(),i.default.warning(\"必须选择一个选项才能编辑！\")):1<n.state.selectedRows.length?(e(),i.default.warning(\"只能选择一个选项！\")):(e(),n.setState({currentAction:\"edit\",currentData:n.state.selectedRows[0]}),n.modal.show())},n.detail=function(e){n.setState({currentAction:\"detail\",currentData:e}),n.modal.show()},n.submit=function(){n.setState({modalOkBtnLoading:!0}),n.form.validateFields(function(e,t){e?n.setState({modalOkBtnLoading:!1}):((t=(0,u.handleInParams)(t)).arpCd=n.state.currentData.arpCd,t.detailListStr=JSON.stringify(n.tableCustom.state.selectedRows),(0,c.post)({url:\"rmRiskArpt/updateRiskArptDetail\",data:t,btn:function(){return n.setState({modalOkBtnLoading:!1})},success:function(e){i.default.success(\"修改成功\"),n.modal.hide(),n.getList({pageNum:1})}}))})},n.del=function(e){if(0==n.state.selectedRows.length)e(),i.default.warning(\"请至少选择一行数据\");else{var t=n.state.selectedRows.map(function(e){return e.arpCd}),a=n.state.selectedRows.map(function(e){return e.arpName});b({title:\"确认删除【\"+a.join(\"、\")+\"】吗?\",okType:\"danger\",onOk:function(){(0,c.post)({url:\"rmRiskArpt/delRmRiskArpt\",data:{ids:t},btn:e,success:function(e){i.default.success(\"删除成功\"),n.getList({pageNum:1})}})},onCancel:e})}},n.state={table:new m.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",icon:\"plus-circle\",onClick:n.add},{name:\"修改\",icon:\"edit\",onClick:n.edit},{name:\"删除\",icon:\"minus-circle\",onClick:n.del}],modalOkBtnLoading:!1,currentAction:\"\",currentData:{}},n.columns=[{title:\"序号\",dataIndex:\"index\"},{title:\"机场名称\",dataIndex:\"arpName\"},{title:\"三字码\",dataIndex:\"arpCd\"},{title:\"四字码\",dataIndex:\"icaoCode\"},{title:\"起飞得分\",dataIndex:\"takeoffValue\"},{title:\"着陆得分\",dataIndex:\"landValue\"},{title:\"更新人\",dataIndex:\"updateUser\"},{title:\"更新时间\",dataIndex:\"updateTime\"},{title:\"状态\",dataIndex:\"status\",render:function(t,a){return e.createElement(\"a\",{onClick:function(){return n.detail(a)}},t)}}],n.addModal,n.addForm,n.modal,n.form,n.tableCustom,n}var v=(k(C,e.Component),r(C,[{key:\"componentDidMount\",value:function(){var e=this;this.props.onRef&&this.props.onRef(this),this.getDefaultArp(function(t){e.getList(t)});var t=this;document.onclick=function(e){\"TD\"!=e.target.nodeName&&(\"DIV\"!=e.target.nodeName||e.target.onclick)||t.setState({edit:!1})}}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getDom\",value:function(t,n,i){var s=this;return\"detail\"==this.props.currentAction?e.createElement(\"div\",null,n):this.state.edit&&i.arpRiskParamId==this.state.selected.arpRiskParamId?e.createElement(a.default,{title:n},e.createElement(o.default,{defaultValue:n,onChange:function(e){return s.onChange(t,i,e)},autoComplete:\"off\"})):\"riskDetail\"==t?e.createElement(\"div\",{style:{minHeight:\"22px\"},onClick:this.onStartEdit.bind(this,i)},n):\"invalidTime\"==t?e.createElement(\"div\",null,n):void 0}},{key:\"onChange\",value:function(e,t,n){var a=this.state.dataSource.map(function(a){return a.arpRiskParamId==t.arpRiskParamId&&(a[e]=n.target.value),a});this.setState({dataSource:a})}},{key:\"onStartEdit\",value:function(e){e.invalidTime||(e.invalidTime=this.getInvalidTime(e.operPeriod)),this.setState({edit:!0,selected:e})}},{key:\"getInvalidTime\",value:function(e){switch(e){case\"一年\":return(0,p.default)().subtract(-1,\"years\").format(\"YYYY-MM-DD HH:mm:ss\");case\"半年\":return(0,p.default)().subtract(-6,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"三个月\":return(0,p.default)().subtract(-3,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"暂无要求\":default:var t=(0,p.default)().format(\"YYYY-MM-DD HH:mm:ss\");return t.replace(t.slice(0,4),\"2999\")}}},{key:\"getDefaultArp\",value:function(e){(0,c.post)({url:\"rmRiskArpt/queryDefaultArpOptions\",data:{arpCd:this.props.datas.arpCd},success:function(t){e&&\"function\"==typeof e&&e(t)}})}},{key:\"render\",value:function(){var t=this,n=this.state,a=n.dataSource,o=n.selectedRowKeys,i=n.loading,s={key:\"itemNum\",columns:this.columns,table:{dataList:a,loading:i},scroll:{x:\"750px\",y:\"300px\"},rowSelection:{selectedRowKeys:o,onChange:function(e,n){t.onChecked(e,n)},getCheckboxProps:function(e){return{disabled:\"detail\"==t.props.currentAction}}},needPage:!1};return e.createElement(e.Fragment,null,e.createElement(\"div\",null,\"选择机场风险因素\"),e.createElement(d.CommonTabs,{className:\"mt20 mb20\",tabs:this.state.tabs,onClick:this.onTab}),e.createElement(d.CommonTable,{options:s,onChecked:this.onChecked}))}}]),C);function C(t){h(this,C);var n=g(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,t));return n.getList=function(e){(0,c.post)({url:\"rmRiskArpt/queryrmRiskArptDetail\",data:{arpCd:n.props.datas.arpCd},success:function(t){if(t&&t.rows){var a=t.rows.map(function(e,t){return e.index=t+1,e}),o=[],i=[];e.forEach(function(e){a.forEach(function(t,n){e==t.arpRiskParamId&&(o.push(t.itemNum),i.push(t))})}),n.setState({dataSource:a,selectedRowKeys:o,selectedRows:i,loading:!1})}}})},n.onTab=function(e,t){var a,o=n.state.dataSource;for(t=0;t<o.length-1;t++)o[0].flyPhase==e.name?a=1:o[t].flyPhase!=o[t+1].flyPhase&&o[t+1].flyPhase==e.name&&(a=t+1);var i=document.getElementById(a);i&&i.scrollIntoView()},n.onChecked=function(e,t){n.setState({selectedRowKeys:e,selectedRows:t})},n.state={tabs:[{name:\"多阶段并存风险\"},{name:\"机坪运行阶段\"},{name:\"起飞阶段\"},{name:\"离场阶段\"},{name:\"进场阶段\"},{name:\"进近阶段\"},{name:\"五边阶段\"},{name:\"着陆阶段\"},{name:\"复飞阶段\"}],dataSource:[],selectedRows:[],selectedRowKeys:[],edit:!1,selected:{},loading:!0},n.columns=[{title:\"编号\",dataIndex:\"index\",width:50,render:function(t){return e.createElement(\"div\",{id:t},t)}},{title:\"项目编号\",dataIndex:\"itemNum\",width:70},{title:\"风险因素\",dataIndex:\"riskItem\",width:220,className:\"text-left\"},{title:\"风险值\",dataIndex:\"riskValue\",width:50},{title:\"风险详细描述\",dataIndex:\"riskDetail\",width:100,className:\"text-left\",render:function(e,t){return n.getDom(\"riskDetail\",e,t)}},{title:\"维护期限\",dataIndex:\"operPeriod\",width:70},{title:\"失效日期\",dataIndex:\"invalidTime\",width:70,render:function(e,t){return n.getDom(\"invalidTime\",e,t)}},{title:\"更新时间\",dataIndex:\"updateTime\",width:70}],n}t.default=y}).call(this,n(1))}}]);","extractedComments":[]}