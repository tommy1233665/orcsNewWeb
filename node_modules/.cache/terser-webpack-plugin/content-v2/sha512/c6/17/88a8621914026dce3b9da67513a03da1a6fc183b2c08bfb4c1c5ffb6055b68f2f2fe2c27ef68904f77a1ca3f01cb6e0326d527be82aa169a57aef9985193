{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{417:function(e,t,a){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=p(a(76)),o=p(a(25)),i=p(a(34)),s=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a(75),a(24),a(33);var l=a(23),d=a(26),u=a(21),c=p(a(31)),m=p(a(5));function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function h(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function g(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var k=i.default.confirm,b=(g(y,e.Component),s(y,[{key:\"componentDidMount\",value:function(){this.getList()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getSearchFormOptions\",value:function(){return[{type:\"Input\",label:\"关键字搜索\",name:\"rmArptRisk\",span:10,length:5,placeholder:\"请输入机场名称（全称）、三字码（全称）、四字码（全称）搜索\"}]}},{key:\"getAddFormOptions\",value:function(){return[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:22,options:{rules:[{required:!0,message:\"机场名称不可为空！\"}]}},{type:\"Input\",label:\"三字码\",name:\"arpCd\",span:22,options:{rules:[{required:!0,message:\"三字码不可为空！\"}]}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:22,options:{rules:[{required:!0,message:\"四字码不可为空！\"}]}},{type:\"Input\",label:\"起飞得分\",name:\"takeoffValue\",span:22},{type:\"Input\",label:\"着陆得分\",name:\"landValue\",span:22}]}},{key:\"getFormOptions\",value:function(){var e=this.state.currentData,t=[{type:\"Input\",label:\"机场名称\",name:\"arpName\",span:6,length:4,disabled:!0,options:{initialValue:e.arpName}},{type:\"Input\",label:\"四字码\",name:\"icaoCode\",span:6,length:3,disabled:!0,options:{initialValue:e.icaoCode}},{type:\"Input\",label:\"起飞得分\",name:\"takeoffValue\",span:6,length:4,options:{initialValue:e.takeoffValue}},{type:\"Input\",label:\"着陆得分\",name:\"landValue\",span:6,length:4,options:{initialValue:e.landValue}}];return\"detail\"==this.state.currentAction&&(t=t.map(function(e){return e.disabled=!0,e})),t}},{key:\"render\",value:function(){var t=this,a=this.state,n=a.table,o=a.modalOkBtnLoading,i=a.currentAction,s=a.currentData,r=a.selectedRowKeys,d=this.getSearchFormOptions(),u={aligin:\"left\",span:6,list:[{text:\"查询\",options:\"queryOpt\",event:this.search}]},c={key:\"arpCd\",columns:this.columns,dataSource:n.dataList,rowSelection:{selectedRowKeys:r,onChange:function(e,a){t.onChecked(e,a)}}},m={pageNum:n.pageNum,pageSize:n.pageSize,total:n.total,onChange:this.getList},p={options:{title:\"新增\",okButtonProps:{loading:o}},onRef:function(e){t.addModal=e},ok:this.addSubmit.bind(this)},f=this.getAddFormOptions(),h={options:{title:(\"edit\"==i?\"编辑\":\"查看\")+\"机场风险详情\",width:\"1000px\",bodyStyle:{width:\"1000px\"},okButtonProps:{loading:o}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};\"detail\"==i&&(h.options.footer=null);var g=this.getFormOptions();return e.createElement(l.CardCommon,null,e.createElement(l.CommonForm,{options:d,btnOptions:u,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.searcForm=e.props.form)}}),e.createElement(\"div\",{className:\"buttons\"},e.createElement(l.CommonBtns,{options:{shape:\"round\",size:\"small\"},btns:this.state.btns})),e.createElement(l.CommonTable,{tableOptions:c,pagingOptions:m,onChecked:this.onChecked}),e.createElement(l.CommonModal,p,e.createElement(\"div\",{className:\"form-grid-6\"},e.createElement(l.CommonForm,{options:f,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.addForm=e.props.form)}}))),e.createElement(l.CommonModal,h,e.createElement(l.CommonForm,{options:g,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),e.createElement(w,{datas:s,currentAction:i,onRef:function(e){return t.tableCustom=e}})))}}]),y);function y(t){f(this,y);var a=h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,t));return a.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.params=Object.assign({},(0,d.handleInParams)(a.searcForm.getFieldsValue()),e.params);var t=a.state.table;t.setPage(e);var n=t.getParmaData();(0,u.post)({url:\"rmRiskArpt/queryRmRiskArptListByParam\",data:n,success:function(e){if(e&&e.rows){var o=e.rows.map(function(e,t){return e.index=(n.pageNum-1)*n.pageSize+t+1,e});t.setPage({dataList:o,total:e.total,pageNum:n.pageNum,pageSize:n.pageSize}),a.setState({table:t,selectedRowKeys:[],selectedRows:[]})}}})},a.onChecked=function(e,t){a.setState({selectedRowKeys:e,selectedRows:t})},a.search=function(){a.searcForm.validateFields(function(e,t){e||a.getList()})},a.add=function(e){e(),a.addModal.show()},a.addSubmit=function(){a.setState({modalOkBtnLoading:!0}),a.addForm.validateFields(function(e,t){e?a.setState({modalOkBtnLoading:!1}):(t=(0,d.handleInParams)(t),(0,u.post)({url:\"rmRiskArpt/addRmRiskArpt\",data:t,btn:function(){return a.setState({modalOkBtnLoading:!1})},success:function(e){o.default.success(\"添加成功！\"),a.addModal.hide(),a.getList({pageNum:1})}}))})},a.edit=function(e){0==a.state.selectedRows.length?(e(),o.default.warning(\"必须选择一个选项才能编辑！\")):1<a.state.selectedRows.length?(e(),o.default.warning(\"只能选择一个选项！\")):(e(),a.setState({currentAction:\"edit\",currentData:a.state.selectedRows[0]}),a.modal.show())},a.detail=function(e){a.setState({currentAction:\"detail\",currentData:e}),a.modal.show()},a.submit=function(){a.setState({modalOkBtnLoading:!0}),a.form.validateFields(function(e,t){e?a.setState({modalOkBtnLoading:!1}):((t=(0,d.handleInParams)(t)).arpCd=a.state.currentData.arpCd,t.detailListStr=JSON.stringify(a.tableCustom.state.selectedRows),(0,u.post)({url:\"rmRiskArpt/updateRiskArptDetail\",data:t,btn:function(){return a.setState({modalOkBtnLoading:!1})},success:function(e){o.default.success(\"修改成功\"),a.modal.hide(),a.getList({pageNum:1})}}))})},a.del=function(e){if(0==a.state.selectedRows.length)e(),o.default.warning(\"请至少选择一行数据\");else{var t=a.state.selectedRows.map(function(e){return e.arpCd}),n=a.state.selectedRows.map(function(e){return e.arpName});k({title:\"确认删除【\"+n.join(\"、\")+\"】吗?\",okType:\"danger\",onOk:function(){(0,u.post)({url:\"rmRiskArpt/delRmRiskArpt\",data:{ids:t},btn:e,success:function(e){o.default.success(\"删除成功\"),a.getList({pageNum:1})}})},onCancel:e})}},a.state={table:new c.default,selectedRowKeys:[],selectedRows:[],btns:[{name:\"新增\",icon:\"plus-circle\",onClick:a.add},{name:\"修改\",icon:\"edit\",onClick:a.edit},{name:\"删除\",icon:\"minus-circle\",onClick:a.del}],modalOkBtnLoading:!1,currentAction:\"\",currentData:{}},a.columns=[{title:\"序号\",dataIndex:\"index\"},{title:\"机场名称\",dataIndex:\"arpName\"},{title:\"三字码\",dataIndex:\"arpCd\"},{title:\"四字码\",dataIndex:\"icaoCode\"},{title:\"起飞得分\",dataIndex:\"takeoffValue\"},{title:\"着陆得分\",dataIndex:\"landValue\"},{title:\"更新人\",dataIndex:\"updateUser\"},{title:\"更新时间\",dataIndex:\"updateTime\"},{title:\"状态\",dataIndex:\"status\",render:function(t,n){return e.createElement(\"a\",{onClick:function(){return a.detail(n)}},t)}}],a.addModal,a.addForm,a.modal,a.form,a.tableCustom,a}var w=(g(v,e.Component),s(v,[{key:\"componentDidMount\",value:function(){var e=this;this.props.onRef&&this.props.onRef(this),this.getDefaultArp(function(t){e.getList(t)});var t=this;document.onclick=function(e){\"TD\"!=e.target.nodeName&&(\"DIV\"!=e.target.nodeName||e.target.onclick)||t.setState({edit:!1})}}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getDom\",value:function(t,a,o){var i=this;return\"detail\"==this.props.currentAction?e.createElement(\"div\",null,a):this.state.edit&&o.arpRiskParamId==this.state.selected.arpRiskParamId?e.createElement(n.default,{defaultValue:a,onChange:function(e){return i.onChange(t,o,e)},autoComplete:\"off\"}):\"riskDetail\"==t?e.createElement(\"div\",{style:{minHeight:\"22px\"},onClick:this.onStartEdit.bind(this,o)},a):\"invalidTime\"==t?e.createElement(\"div\",null,a):void 0}},{key:\"onChange\",value:function(e,t,a){var n=this.state.dataSource.map(function(n){return n.arpRiskParamId==t.arpRiskParamId&&(n[e]=a.target.value),n});this.setState({dataSource:n})}},{key:\"onStartEdit\",value:function(e){e.invalidTime||(e.invalidTime=this.getInvalidTime(e.operPeriod)),this.setState({edit:!0,selected:e})}},{key:\"getInvalidTime\",value:function(e){switch(e){case\"一年\":return(0,m.default)().subtract(-1,\"years\").format(\"YYYY-MM-DD HH:mm:ss\");case\"半年\":return(0,m.default)().subtract(-6,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"三个月\":return(0,m.default)().subtract(-3,\"months\").format(\"YYYY-MM-DD HH:mm:ss\");case\"暂无要求\":default:var t=(0,m.default)().format(\"YYYY-MM-DD HH:mm:ss\");return t.replace(t.slice(0,4),\"2999\")}}},{key:\"getDefaultArp\",value:function(e){(0,u.post)({url:\"rmRiskArpt/queryDefaultArpOptions\",data:{arpCd:this.props.datas.arpCd},success:function(t){e&&\"function\"==typeof e&&e(t)}})}},{key:\"render\",value:function(){var t=this,a=this.state,n=a.dataSource,o=a.selectedRowKeys,i={key:\"itemNum\",columns:this.columns,dataSource:n,scroll:{x:\"750px\",y:\"300px\"},rowSelection:{selectedRowKeys:o,onChange:function(e,a){t.onChecked(e,a)},getCheckboxProps:function(e){return{disabled:\"detail\"==t.props.currentAction}}}};return e.createElement(e.Fragment,null,e.createElement(\"div\",null,\"选择机场风险因素\"),e.createElement(l.CommonTabs,{className:\"mt20 mb20\",tabs:this.state.tabs,onClick:this.onTab}),e.createElement(l.CommonTable,{tableOptions:i,needPage:!1,onChecked:this.onChecked}))}}]),v);function v(t){f(this,v);var a=h(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,t));return a.getList=function(e){(0,u.post)({url:\"rmRiskArpt/queryrmRiskArptDetail\",data:{arpCd:a.props.datas.arpCd},success:function(t){if(t&&t.rows){var n=t.rows.map(function(e,t){return e.index=t+1,e}),o=[],i=[];e.forEach(function(e){n.forEach(function(t,a){e==t.arpRiskParamId&&(o.push(t.itemNum),i.push(t))})}),a.setState({dataSource:n,selectedRowKeys:o,selectedRows:i})}}})},a.onTab=function(e,t){var n,o=a.state.dataSource;for(t=0;t<o.length-1;t++)o[0].flyPhase==e.name?n=1:o[t].flyPhase!=o[t+1].flyPhase&&o[t+1].flyPhase==e.name&&(n=t+1);var i=document.getElementById(n);i&&i.scrollIntoView()},a.onChecked=function(e,t){a.setState({selectedRowKeys:e,selectedRows:t})},a.state={tabs:[{name:\"多阶段并存风险\"},{name:\"机坪运行阶段\"},{name:\"起飞阶段\"},{name:\"离场阶段\"},{name:\"进场阶段\"},{name:\"进近阶段\"},{name:\"五边阶段\"},{name:\"着陆阶段\"},{name:\"复飞阶段\"}],dataSource:[],selectedRows:[],selectedRowKeys:[],edit:!1,selected:{}},a.columns=[{title:\"编号\",dataIndex:\"index\",width:50,render:function(t){return e.createElement(\"div\",{id:t},t)}},{title:\"项目编号\",dataIndex:\"itemNum\",width:70},{title:\"风险因素\",dataIndex:\"riskItem\",width:220,className:\"text-left\"},{title:\"风险值\",dataIndex:\"riskValue\",width:50},{title:\"风险详细描述\",dataIndex:\"riskDetail\",width:100,className:\"text-left\",render:function(e,t){return a.getDom(\"riskDetail\",e,t)}},{title:\"维护期限\",dataIndex:\"operPeriod\",width:70},{title:\"失效日期\",dataIndex:\"invalidTime\",width:70,render:function(e,t){return a.getDom(\"invalidTime\",e,t)}},{title:\"更新时间\",dataIndex:\"updateTime\",width:70}],a}t.default=b}).call(this,a(1))}}]);","extractedComments":[]}