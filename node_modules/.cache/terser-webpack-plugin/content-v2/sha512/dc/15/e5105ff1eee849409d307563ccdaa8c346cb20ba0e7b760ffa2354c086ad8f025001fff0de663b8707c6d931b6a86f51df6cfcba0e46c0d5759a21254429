{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{411:function(e,t,a){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=I(a(178)),i=I(a(209)),o=I(a(210)),l=I(a(25)),s=I(a(34)),r=I(a(76)),u=I(a(176)),m=function(e,t,a){return t&&d(e.prototype,t),a&&d(e,a),e};function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a(177),a(212),a(213),a(24),a(33),a(75),a(175);var c=a(57),p=a(26),f=a(23),h=a(21),g=I(a(31));function I(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function v(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function y(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var R=u.default.TreeNode,k=u.default.DirectoryTree,x=r.default.Search,L=s.default.confirm,w=\"61ee45a7490d460ab8d63e9ecffe5fde\",D=\"ff1a0425002a4817bb3075a1d9cc347c\",S=(y(M,e.Component),m(M,[{key:\"componentDidMount\",value:function(){this.setState({formOptions:this.getFormOptions()})}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getFormOptions\",value:function(e){var t=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,a=\"最多保留2位小数 如：1、1.0、0.88\",n=\"最多保留2位小数\";return\"Y\"==(0<arguments.length&&void 0!==e?e:{}).isLeaf?[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"告警上限\",name:\"warningValue\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",name:\"warnFlg\",span:6,length:4,list:[{label:\"是否告警\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:4,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:5,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",name:\"isShow\",span:12,length:2,list:[{label:\"不显示在风险明细中\",value:\"Y\"}],options:{initialValue:[]}}]:[{type:\"Input\",label:\"节点编号\",name:\"code\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点编号\",name:\"parentCode\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"比重\",name:\"proportion\",span:6,length:2,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Checkbox\",label:\"\",name:\"useDefault\",span:6,length:3,list:[{label:\"是否使用默认值\",value:\"Y\"}],options:{initialValue:[]}},{type:\"Input\",label:\"节点名称\",name:\"name\",span:6,length:4,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"父节点名称\",name:\"parentName\",span:6,length:5,disabled:!0,options:{initialValue:\"\"}},{type:\"Input\",label:\"概率\",name:\"probability\",span:6,length:2,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}},{type:\"Input\",label:\"默认值\",name:\"defaultValue\",span:6,length:3,placeholder:n,options:{initialValue:\"\",rules:[{pattern:t,message:a}]}}]}},{key:\"render\",value:function(){var t=this;return e.createElement(i.default,{gutter:16,className:\"risk-target\"},e.createElement(o.default,{span:5},e.createElement(f.CardCommon,{title:\"航班风险因素节点\"},e.createElement(N,{getSelectedNodeData:this.nodeData}))),e.createElement(o.default,{span:19},e.createElement(f.CardCommon,{title:\"风险因素配置\"},e.createElement(\"div\",{className:\"risk-target-content\"},e.createElement(\"div\",{className:\"risk-target-form\"},e.createElement(f.CommonForm,{options:this.state.formOptions,btnOptions:this.state.btnOptions,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}})),\"N\"==this.state.nodeData.isLeaf&&e.createElement(V,{options:this.state.nodeData}),\"Y\"==this.state.nodeData.isLeaf&&e.createElement(C,{id:this.state.nodeData.id})))))}}]),M);function M(){b(this,M);var e=v(this,(M.__proto__||Object.getPrototypeOf(M)).call(this));return e.submit=function(){event.preventDefault(),e.form.validateFields(function(t,a){t||(a.id=e.state.nodeData.id,a.useDefault=a.useDefault[0],a.isShow&&(a.isShow=a.isShow[0]),a.warnFlg&&(a.warnFlg=a.warnFlg[0]),(0,h.post)({url:\"rmItem/updateRmItemAndRmItemFunPoints\",data:a,success:function(e){l.default.success(\"保存成功\")}}))})},e.cancel=function(){e.form.resetFields()},e.nodeData=function(t){(0,h.post)({url:\"rmItem/showRmItemById/rmItemParentList\",data:{id:t.id},success:function(t){var a=Object.assign({},t.rmItem,{parentName:t.parentrmItem.name,parentCode:t.parentrmItem.code});e.setState({formOptions:e.getFormOptions(a),nodeData:a,btnOptions:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:e.submit},{text:\"取消\",options:\"reload\",event:e.cancel}]}});var n={name:a.name,code:a.code,parentCode:a.parentCode,parentName:a.parentName,useDefault:[a.useDefault],defaultValue:a.defaultValue,probability:a.probability,proportion:a.proportion};\"Y\"==a.isLeaf&&(n.isShow=[a.isShow],n.warnFlg=[a.warnFlg],n.warningValue=a.warningValue),e.form.setFieldsValue(n)}})},e.state={nodeData:{},formOptions:[],btnOptions:{aligin:\"right\",span:24,list:[{text:\"保存\",options:\"saveOpt\",event:e.submit},{text:\"取消\",options:\"reload\",event:e.cancel}]}},e.form,e}var C=(y(E,e.Component),m(E,[{key:\"componentDidMount\",value:function(){this.getList({params:{rmItemId:this.state.id}})}},{key:\"componentWillReceiveProps\",value:function(e){if(e.id!=this.props.id){var t=e.id==w?D:e.id,a=e.id==w;this.setState({id:t,readonly:a}),this.getList({params:{rmItemId:t},pageNum:1})}}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getRmItemRuleDataAndRuleItem\",value:function(e,t){(0,h.post)({url:\"rmItemRuleData/queryRmItemRuleDataAndRuleItemByRmItemRuleId\",data:e,success:function(e){t&&\"function\"==typeof t&&t(e)}})}},{key:\"handleData\",value:function(e){var t=[];for(var a in e)\"ruleItem\"!=a&&\"symbol\"!=a&&\"setValue\"!=a||t.push(a+\"=\"+e[a]);return t}},{key:\"getResult\",value:function(e){var t=this;return e.map(function(e){return t.handleData(e)})}},{key:\"getParams\",value:function(e){e.rmItemId=this.state.id,\"edit\"==this.state.currentAction&&(e.id=this.state.selectedRows[0].id),e.customKey&&(e.customKey=e.customKey.value);var t=[],a=[];for(var n in e)if(e[n])if(\"customKey\"==n){var i=this.getResult(e[n]);0==i.length?(this.setState({modalOkBtnLoading:!1}),l.default.warning(\"请至少添加一条风险节点规则条件\")):a=i.reduce(function(e,t){return e.concat(t)})}else t.push(n+\"=\"+e[n]);return t.concat(a)}},{key:\"getFormOptions\",value:function(){var e=this.state,t=e.currentAction,a=e.table,n=e.selectedRows,i=e.rmItemRuleData,o={};if((\"edit\"==t||\"detail\"==t)&&0<n.length){var l=a.dataList.filter(function(e){return e.id==n[0].id})[0];o={name:l.name,riskValue:l.riskValue,informationDescription:l.informationDescription,mitigatingMeasures:l.mitigatingMeasures,memo:l.memo,customKey:i.rmItemRuleDataList}}var s=[{type:\"Input\",label:\"风险节点名称\",name:\"name\",span:24,placeholder:\"请输入风险节点名称\",options:{initialValue:o.name,rules:[{required:!0,message:\"风险节点名称不能为空\"}]}},{type:\"Input\",label:\"分值\",name:\"riskValue\",span:24,placeholder:\"请输入数字，最多保留2位小数\",options:{initialValue:o.riskValue,rules:[{required:!0,message:\"分值不能为空\"},{pattern:/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,message:\"最多保留2位小数 如：1、1.0、0.88\"}]}},{type:\"TextArea\",label:\"信息描述\",name:\"informationDescription\",span:24,options:{initialValue:o.informationDescription}},{type:\"TextArea\",label:\"建议措施\",name:\"mitigatingMeasures\",span:24,options:{initialValue:o.mitigatingMeasures}},{type:\"TextArea\",label:\"备注\",name:\"memo\",span:24,options:{initialValue:o.memo}},{type:\"DynamicFieldSetCustom\",name:\"customKey\",span:24,data:i,options:{initialValue:o.customKey}}];return\"detail\"==t&&s.forEach(function(e){e.disabled=!0}),s}},{key:\"render\",value:function(){var t=this,a=this.state,n=a.readonly,i=a.table,o=a.modalOkBtnLoading,l=a.selectedRowKeys,s=a.currentAction,r=[{name:\"查看\",icon:\"eye\",onClick:this.detail}],u=[{name:\"新增\",icon:\"plus-circle\",onClick:this.add},{name:\"修改\",icon:\"edit\",onClick:this.edit},{name:\"删除\",icon:\"minus-circle\",onClick:this.del}],m={notCheck:!1,table:i,columns:this.columns,scroll:{x:\"max-content\"},rowSelection:{selectedRowKeys:l,onChange:function(e,a){t.onChecked(e,a)}},onChange:this.getList},d={shape:\"round\",size:\"small\"},c={options:{title:\"编辑\",width:\"600px\",bodyStyle:{height:\"443px\",overflow:\"auto\"},okButtonProps:{loading:o}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)};\"detail\"==s&&(c.options.footer=null);var p=this.getFormOptions();return e.createElement(\"div\",{className:\"mb20\"},e.createElement(\"div\",{className:\"risk-target-tit\"},e.createElement(\"div\",null,\"风险因素节点规则\"),e.createElement(\"div\",{className:\"buttons\"},n&&e.createElement(f.CommonBtns,{options:d,btns:r}),!n&&e.createElement(f.CommonBtns,{options:d,btns:u}))),e.createElement(f.CommonTable,{options:m,onChecked:this.onChecked}),e.createElement(f.CommonModal,c,e.createElement(\"div\",{className:\"form-grid-7\",style:{paddingLeft:\"20px\",paddingRight:\"30px\"}},e.createElement(f.CommonForm,{options:p,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),E);function E(e){b(this,E);var t=v(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e));t.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.state.table;a.setPage(e);var n=a.getParmaData();(0,h.post)({url:\"rmItemRule/queryRmItemRuleByItemId\",data:n,success:function(e){if(e&&e.rows){var i=e.rows.map(function(e,t){return e.index=(n.pageNum-1)*n.pageSize+t+1,e});a.setPage({dataList:i,total:e.total,pageNum:n.pageNum,pageSize:n.pageSize}),t.setState({table:a,selectedRowKeys:[],selectedRows:[],currentAction:\"\"})}}})},t.onChecked=function(e,a){t.setState({selectedRowKeys:e,selectedRows:a})},t.add=function(e){e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id},function(e){a.setState({rmItemRuleData:e,currentAction:\"add\"}),a.modal.show()})},t.edit=function(e){if(0==t.state.selectedRows.length)l.default.warning(\"必须选择一个选项才能编辑！\"),e();else if(1<t.state.selectedRows.length)l.default.warning(\"只能选择一个选项！\"),e();else{e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id,rmItemRuleId:t.state.selectedRows[0].id},function(e){a.setState({rmItemRuleData:e,currentAction:\"edit\"}),a.modal.show()})}},t.detail=function(e){if(0==t.state.selectedRows.length)l.default.warning(\"必须选择一个选项才能查看！\"),e();else if(1<t.state.selectedRows.length)l.default.warning(\"只能选择一个选项！\"),e();else{e();var a=t;t.getRmItemRuleDataAndRuleItem({rmtemId:t.state.id,rmItemRuleId:t.state.selectedRows[0].id},function(e){a.setState({rmItemRuleData:e,currentAction:\"detail\"}),a.modal.show()})}},t.submit=function(){t.setState({modalOkBtnLoading:!0}),t.form.validateFields(function(e,a){if(e)t.setState({modalOkBtnLoading:!1});else{var n,i,o=t.getParams(a);\"add\"==t.state.currentAction?(n=\"rmItemRule/insertRmtemRuleAndItemRuleDataAtRmtem\",i=\"添加成功\"):\"edit\"==t.state.currentAction&&(n=\"rmItemRule/updateRmtemRuleAndItemRuleDataAtRmtem\",i=\"修改成功\"),(0,h.post)({url:n,data:o.join(\"&\"),btn:function(){return t.setState({modalOkBtnLoading:!1})},success:function(e){l.default.success(i),t.modal.hide(),t.getList({params:{rmItemId:t.props.id},pageNum:1})}})}})},t.del=function(e){if(0==t.state.selectedRows.length)l.default.warning(\"未选中选项！\"),e();else{var a=t;L({title:\"确认删除选项吗？\",onOk:function(){var t=a.state.selectedRows.map(function(e){return e.id});(0,h.post)({url:\"rmItemRule/deleteRmItemRuleAndRmItemRuleData\",data:{ids:t},btn:e,success:function(e){l.default.success(\"删除成功\"),a.getList({params:{rmItemId:a.props.id},pageNum:1})}})},onCancel:e})}};var a=e.id==w?D:e.id,n=e.id==w;return t.state={id:a,readonly:n,table:new g.default,selectedRowKeys:[],selectedRows:[],currentAction:\"\",rmItemRuleData:{},modalOkBtnLoading:!1},t.columns=[{title:\"序号\",dataIndex:\"index\",width:50},{title:\"风险节点规则名称\",dataIndex:\"name\",className:\"text-left\",width:300,isTooltip:!0},{title:\"分值\",dataIndex:\"riskValue\",width:50},{title:\"信息描述\",dataIndex:\"informationDescription\",className:\"text-left\",width:400,isTooltip:!0},{title:\"建议措施\",dataIndex:\"mitigatingMeasures\",className:\"text-left\",width:300,isTooltip:!0},{title:\"备注\",dataIndex:\"memo\",className:\"text-left\",width:300,isTooltip:!0}],t.modal,t.form,t}var V=(y(O,e.Component),m(O,[{key:\"componentDidMount\",value:function(){this.getRuleItem(this.props.options)}},{key:\"componentWillReceiveProps\",value:function(e){e.options.id!=this.state.options.id&&(this.setState({options:e.options}),this.getRuleItem(e.options))}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"getDom\",value:function(t){return e.createElement(r.default,{name:t,value:this.state.rmItemRuleMatrix[t],onChange:this.onChange,autoComplete:\"off\"})}},{key:\"getRuleItem\",value:function(e){var t=this;(0,h.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e.id},success:function(a){(0,h.post)({url:\"rmItemRuleMatrix/queryRmItemRuleMatrixListByRmItemId\",data:{rmItemId:e.id},success:function(e){var n={};switch(e.forEach(function(e){n[e.rowIndentifier]=e.matrixRowValue}),t.setState({length:a.length,rmItemRuleMatrix:n}),a.length){case 0:case 1:break;case 2:var i=[{title:\"\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],o=[{label:a[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:a[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:a[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}];t.setState({columns1:i,dataSource1:o});break;case 3:i=[{title:a[2].name+\"(低)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}];var l=[{title:a[2].name+\"(中)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],s=[{title:a[2].name+\"(高)\",dataIndex:\"label\"},{title:a[0].name+\"(低)\",dataIndex:\"l\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(中)\",dataIndex:\"m\",render:function(e){return t.getDom(e)}},{title:a[0].name+\"(高)\",dataIndex:\"h\",render:function(e){return t.getDom(e)}}],r=(o=[{label:a[1].name+\"(低)\",l:\"LLL\",m:\"LLM\",h:\"LLH\"},{label:a[1].name+\"(中)\",l:\"LML\",m:\"LMM\",h:\"LMH\"},{label:a[1].name+\"(高)\",l:\"LHL\",m:\"LHM\",h:\"LHH\"}],[{label:a[1].name+\"(低)\",l:\"MLL\",m:\"MLM\",h:\"MLH\"},{label:a[1].name+\"(中)\",l:\"MML\",m:\"MMM\",h:\"MMH\"},{label:a[1].name+\"(高)\",l:\"MHL\",m:\"MHM\",h:\"MHH\"}]),u=[{label:a[1].name+\"(低)\",l:\"HLL\",m:\"HLM\",h:\"HLH\"},{label:a[1].name+\"(中)\",l:\"HML\",m:\"HMM\",h:\"HMH\"},{label:a[1].name+\"(高)\",l:\"HHL\",m:\"HHM\",h:\"HHH\"}];t.setState({columns1:i,columns2:l,columns3:s,dataSource1:o,dataSource2:r,dataSource3:u})}}})}})}},{key:\"render\",value:function(){var t={notCheck:!0,table:{dataList:this.state.dataSource1,loading:!1},columns:this.state.columns1,needPage:!1},a={notCheck:!0,table:{dataList:this.state.dataSource2,loading:!1},columns:this.state.columns2,needPage:!1},n={notCheck:!0,table:{dataList:this.state.dataSource3,loading:!1},columns:this.state.columns3,needPage:!1};return e.createElement(e.Fragment,null,2<=this.state.length&&this.state.length<=3&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"buttons\"},e.createElement(f.CommonBtns,{btns:this.state.btns})),e.createElement(\"form\",null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(f.CommonTable,{options:t})),3==this.state.length&&e.createElement(e.Fragment,null,e.createElement(\"div\",{className:\"mt15\"},e.createElement(f.CommonTable,{options:a})),e.createElement(\"div\",{className:\"mt15 mb30\"},e.createElement(f.CommonTable,{options:n}))))))}}]),O);function O(e){b(this,O);var t=v(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,e));return t.submit=function(e){var a=/^0$|^[1-9]\\d*$|^[1-9]\\d*.\\d{1,2}$|^0.\\d{1,2}$/,n=t.state.rmItemRuleMatrix;for(var i in n)if(n[i]&&!a.test(n[i]))return void l.default.warning(\"请输入数字，最多保留2位小数 如：1、1.0、0.88\");(0,h.post)({url:\"rmItemRuleMatrix/updateRmItemRuleMatrix\",data:{rmItemId:t.state.options.id,matrixValue:JSON.stringify(t.state.rmItemRuleMatrix)},btn:e,success:function(e){e.success?l.default.success(\"保存成功\"):l.default.errpr(\"保存失败\")}})},t.cancel=function(e){t.setState({rmItemRuleMatrix:{}}),e()},t.onChange=function(e){var a=t.state.rmItemRuleMatrix;a[e.target.name]=e.target.value,t.setState({rmItemRuleMatrix:a})},t.state={options:e.options,length:0,btns:[{name:\"保存\",icon:\"save\",onClick:t.submit},{name:\"取消\",icon:\"reload\",onClick:t.cancel}],rmItemRuleMatrix:[],columns1:[],columns2:[],columns3:[],dataSource1:[],dataSource2:[],dataSource3:[]},t}var N=(y(A,e.Component),m(A,[{key:\"componentDidMount\",value:function(){this.init()}},{key:\"componentWillUnmount\",value:function(){this.setState=function(e,t){}}},{key:\"init\",value:function(){var e=this;this.getRiskValue(\"root\",function(t){return e.setState({treeData:t})})}},{key:\"getRiskValue\",value:function(e,t){(0,h.post)({url:\"rmItem/loadRmItemTreeChildren\",data:{parentId:e},success:function(e){var a=e.map(function(e){return{title:e.name,key:e.id,isLeaf:\"N\"!=e.isLeaf,datas:e}});t&&\"function\"==typeof t&&t(a)}})}},{key:\"treeReplace\",value:function(e,t,a){var n=this;return e&&e.forEach(function(e){e.key==a?e.children=t:e.children&&(e.children=n.treeReplace(e.children,t,a))}),e}},{key:\"onSearch\",value:function(e){var t=this;if(e){var a=this;(0,h.post)({url:\"rmItem/searchRmImte\",data:{name:e},success:function(n){if(n){var i=t.state.treeData,o=0;!function t(){var l=n[o].id;a.getRiskValue(l,function(s){i=a.treeReplace(i,s,l),++o<n.length?t():a.setState({treeData:i,expandedKeys:n.map(function(e){return e.id}),searchValue:e})})}()}}})}else l.default.warning(this.state.tip)}},{key:\"getFormOptions\",value:function(){var e=\"edit\"==this.state.currentAction?this.state.nodeData:{};return[{type:\"Input\",label:\"节点名称\",name:\"name\",span:24,options:{initialValue:e.name,rules:[{required:!0,message:\"节点名称不能为空\"}]}},{type:\"Input\",label:\"节点编号\",name:\"code\",span:24,options:{initialValue:e.code,rules:[{required:!0,message:\"节点编号不能为空\"}]}},{type:\"InputExplain\",label:\"序号\",name:\"ordIdx\",span:24,explain:\"序号从1开始\",explainClassName:\"form-explain\",options:{initialValue:e.ordIdx,rules:[{required:!0,message:\"序号不能为空\"},{validator:function(e,t,a){/^$|^0$|^[1-9]+\\d*$/.test(t.value)||a(\"请输入正整数！\"),a()}}]}},{type:\"Select\",label:\"状态\",name:\"status\",span:24,list:[{key:\"E\",text:\"启用\"},{key:\"D\",text:\"禁用\"}],options:{initialValue:e.status,rules:[{required:!0,message:\"请选择状态\"}]},isHasAllSelect:!1},{type:\"Select\",label:\"是否叶子\",name:\"isLeaf\",span:24,list:[{key:\"Y\",text:\"是\"},{key:\"N\",text:\"否\"}],options:{initialValue:e.isLeaf,rules:[{required:!0,message:\"请选择叶子\"}]},isHasAllSelect:!1}]}},{key:\"render\",value:function(){var t=this,a={options:{title:\"添加节点\",okButtonProps:{loading:this.state.modalOkBtnLoading}},onRef:function(e){t.modal=e},ok:this.submit.bind(this)},n=this.getFormOptions(),i={options:this.state.contextMenuOptions,list:this.state.contextMenuList,onRef:function(e){t.contextMenu=e}};return e.createElement(e.Fragment,null,e.createElement(x,{placeholder:this.state.tip,onSearch:function(e){return t.onSearch(e)}}),e.createElement(\"div\",{className:\"search-tree\"},e.createElement(k,{loadData:this.onLoadData,onExpand:this.onExpand,onRightClick:this.onRightClick,expandedKeys:this.state.expandedKeys,autoExpandParent:this.state.autoExpandParent,onSelect:function(e,a){return t.props.getSelectedNodeData(a.node.props.dataRef.datas)}},this.renderTreeNodes(this.state.treeData))),e.createElement(f.ContextMenu,i),e.createElement(f.CommonModal,a,e.createElement(\"div\",{className:\"form-grid-5\"},e.createElement(f.CommonForm,{options:n,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}))))}}]),A);function A(t){b(this,A);var a=v(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,t));return a.onLoadData=function(e){return new Promise(function(t){e.props.children?t():a.getRiskValue(e.props.dataRef.key,function(n){e.props.dataRef.children=n,a.setState({treeData:[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(a.state.treeData))}),t()})})},a.onExpand=function(e,t){t.expanded,t.node,a.setState({expandedKeys:e})},a.renderTreeNodes=function(t){return t.map(function(t){var n=a.state.searchValue,i=t.title.indexOf(n),o=t.title.substr(0,i),l=t.title.substr(i+n.length),s=-1==i?t.title:e.createElement(e.Fragment,null,o,\" \",e.createElement(\"span\",{className:\"text-danger\"},n),\" \",l);return t.children?e.createElement(R,{title:s,key:t.key,isLeaf:t.isLeaf,dataRef:t},a.renderTreeNodes(t.children)):e.createElement(R,{title:s,key:t.key,isLeaf:t.isLeaf,dataRef:t})})},a.onRightClick=function(e){e.node.props.dataRef.datas,a.setState({contextMenuOptions:{pageX:e.event.pageX,pageY:e.event.pageY,datas:e.node.props.dataRef.datas}}),a.contextMenu.show()},a.onAddTreeNode=function(e){a.setState({nodeData:e,currentAction:\"add\"}),a.modal.show()},a.onEditTreeNode=function(e){a.setState({nodeData:e,currentAction:\"edit\"}),a.modal.show()},a.onDelTreeNode=function(e){a.setState({nodeData:e,currentAction:\"del\"});var t=a;L({title:\"确认删除选项吗？\",onOk:function(){(0,h.post)({url:\"rmItem/deleteRmItemRreeCode\",data:{id:e.id},success:function(e){l.default.success(\"节点删除成功\"),t.init()}})}})},a.submit=function(){a.setState({modalOkBtnLoading:!0}),a.form.validateFields(function(e,t){if(e)a.setState({modalOkBtnLoading:!1});else{for(var n in t)\"ordIdx\"==n&&(t[n]=t[n].value);var i,o;t=(0,p.handleInParams)(t),\"add\"==a.state.currentAction?(t.id=a.state.nodeData.id,i=\"rmItem/addRmItemTreeCode\",o=\"添加成功\"):\"edit\"==a.state.currentAction&&(t.parentId=a.state.nodeData.parentId,t.id=a.state.nodeData.id,i=\"rmItem/updateRmItemTreeCode\",o=\"修改成功\"),(0,h.post)({url:i,data:t,btn:function(){return a.setState({modalOkBtnLoading:!1})},success:function(e){l.default.success(o),a.modal.hide(),a.init()}})}})},a.state={treeData:[],tip:\"请输入节点名称\",expandedKeys:[],searchValue:\"\",autoExpandParent:!1,contextMenuOptions:{pageX:\"\",pageY:\"\",datas:null},contextMenuList:[{name:\"添加\",click:a.onAddTreeNode},{name:\"修改\",click:a.onEditTreeNode},{name:\"删除\",click:a.onDelTreeNode}],nodeData:{},currentAction:\"\",modalOkBtnLoading:!1},a.modal,a.contextMenu,a.form,a}t.default=n.default.create({name:\"TreeForm\"})((0,c.withRouter)(S))}).call(this,a(1))}}]);","extractedComments":[]}