{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{408:function(e,t,a){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var i=y(a(25)),n=y(a(244)),s=y(a(34));function o(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a(24),a(243),a(33);var r=a(57),l=y(a(5)),u=a(126),c=a(214),f=a(23),p=a(26),m=a(21),d=y(a(31)),h=y(a(208));function y(e){return e&&e.__esModule?e:{default:e}}var g=s.default.confirm,k=n.default.TabPane,b=(function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(v,e.Component),function(e,t,a){t&&o(e.prototype,t),a&&o(e,a)}(v,[{key:\"componentDidMount\",value:function(){var t=this;this.getData(),this.columns=(0,f.riskCAirportColumns)({detailUrl:this.detailUrl,onLook:function(e){t.setState({treeParams:{soflSeqNr:e.flightCode},fltNr:e.fltNr}),t.modal1.show(),t.getHisTotaleRiskValue({params:{soflSeqNr:e.flightCode}})}}),this.historyColumns=[{title:\"风险计算时间\",dataIndex:\"analysisTime\"},{title:\"起飞阶段风险值\",dataIndex:\"flyingRiskValue\"},{title:\"巡航阶段风险值\",dataIndex:\"cruiseRiskValue\"},{title:\"着陆阶段风险值\",dataIndex:\"landRiskValue\"},{title:\"风险明细\",key:\"action1\",render:function(a,i){return e.createElement(\"a\",{onClick:function(){return t.onLook2(i)}},\"查看\")}},{title:\"风险详情\",key:\"action2\",render:function(a,i){return e.createElement(r.Link,{to:\"\"+t.detailUrl+i.flightCode+\"/\"+i.batchNum,target:\"_blank\"},\"查看\")}}],this.state.isHistory||(this.timer=setInterval(function(){t.refresh()},3e4))}},{key:\"componentWillUnmount\",value:function(){this.state.isHistory||clearInterval(this.timer),this.setState=function(e,t){}}},{key:\"onLook2\",value:function(e){this.setState({treeParams:{soflSeqNr:e.flightCode,batchNum:e.batchNum}}),this.modal2.show()}},{key:\"refresh\",value:function(){var e=this;(0,m.post)({url:\"airLineRisk/queryRedisKeys\",success:function(t){\"1\"==t.success&&e.getList()}})}},{key:\"getData\",value:function(){var e=this,t=this.state.isHistory?\"airLineRisk/queryHisRiskFlightAll\":\"airLineRisk/queryRiskFlightAll\";(0,m.post)({url:t,success:function(t){e.setState({form:t}),e.getList()}})}},{key:\"calculate\",value:function(e){var t=this.state.selectedRows;if(0==t.length)return s.default.info({content:\"请选择需要计算的航班！!\"}),void e();var a=i.default.loading(\"后台正在计算，耐心等候\",0),n=t.map(function(e){return\"flitSoflSeqNrs=\"+e.soflSeqNr}),o=this;(0,m.post)({url:\"droolsEngine/math\",data:n.join(\"&\"),timeout:1200,btn:function(){e(),a&&\"function\"==typeof a&&a()},success:function(e){e.success?g({title:\"计算风险完毕！是否需要刷新页面？\",onOk:function(){o.getList({params:{filtSoflSeqNrs:t.map(function(e){return e.soflSeqNr})},pageNum:1})}}):i.default.error(\"网络出错，计算风险值失败！\")}})}},{key:\"warnList\",value:function(e){e();var t=\"/index/flightRisk/RiskWarnList\",a=(0,p.getCurrentMenu)(this.props,t);this.props.updateCurrentMenu({currentMenus:a}),(0,p.href)(this,t)}},{key:\"handleSearchParams\",value:function(e){var t=(0,p.handleInParams)(e);for(var a in t)\"date\"==a&&2==t[a].length&&(t.start=(0,l.default)(t[a][0]).format(\"YYYY-MM-DD\"),t.end=(0,l.default)(t[a][1]).format(\"YYYY-MM-DD\"),delete t[a]),\"latestEqpCds\"==a&&!Array.isArray(t[a])&&t[a].value&&(t[a]=t[a].value);return t}},{key:\"getFormOptions\",value:function(){var e=this,t=this.state.isHistory,a=this.state.form.branchInfoList.filter(function(e){return\"CKG\"!=e.branchCd}).map(function(e,t){return{key:e.branchCd,text:e.branchCd+e.chnDescShort}}),i=this.state.form.performanceTypeList.map(function(e){return{label:e.performanceType,value:e.performanceType}}),n=t?(0,l.default)().subtract(7,\"days\"):(0,l.default)(),s={date:[n,n],comp:t?this.state.form.userBelongsToCompany:\"\",condition:\"conditionBranchCode\",latestEqpCds:i.map(function(e){return e.value}),flightStatus:\"\",riskValue:\"\",sorder:\"total_value\"};return[{type:\"RangePicker\",label:\"航班日期\",name:\"date\",span:8,options:{initialValue:s.date}},{type:\"Input\",label:\"出发机场\",name:\"latestDepArpChineseName\",span:6,placeholder:\"出发机场，如：广州\",options:{initialValue:s.latestDepArpChineseName}},{type:\"Input\",label:\"航班号\",name:\"fltNr\",span:6,length:3,placeholder:\"航班号，如：3027\",options:{initialValue:s.fltNr}},{type:\"Select\",label:\"阶段\",name:\"flightStatus\",span:4,length:3,list:[{key:\"flying\",text:\"起飞阶段\"},{key:\"cruise\",text:\"巡航阶段\"},{key:\"landed\",text:\"着陆阶段\"}],options:{initialValue:s.flightStatus}},{type:\"Select\",label:\"公司\",name:\"comp\",span:function(){return e.form&&\"\"==e.form.getFieldValue(\"comp\")?8:5},list:a,options:{initialValue:s.comp}},{type:\"Select\",name:\"condition\",span:3,list:[{key:\"conditionTailNr\",text:\"按飞机\"},{key:\"conditionBranchCode\",text:\"按航班\"},{key:\"crew\",text:\"按机组\"}],options:{initialValue:s.condition},isHasAllSelect:!1,hide:function(){return!(!e.form||\"\"!=e.form.getFieldValue(\"comp\"))}},{type:\"Input\",label:\"到达机场\",name:\"latestArvArpChineseName\",span:6,placeholder:\"到达机场，如：南京\",options:{initialValue:s.latestArvArpChineseName}},{type:\"Input\",label:\"机尾号\",name:\"latestTailNr\",span:6,length:3,placeholder:\"机尾号，如：B6378\",options:{initialValue:s.latestTailNr}},{type:\"Select\",label:\"排序\",name:\"order\",span:4,length:3,list:[{key:\"total_value\",text:\"按风险值\"},{key:\"latest_dep_dt\",text:\"按滑出时间\"},{key:\"latest_arv_dt\",text:\"按滑入时间\"},{key:\"update_time\",text:\"按更新时间\"}],options:{initialValue:s.sorder}},{type:\"CheckboxCustom\",label:\"机型组\",name:\"latestEqpCds\",span:20,list:i,options:{initialValue:s.latestEqpCds}},{type:\"Select\",label:\"风险值\",name:\"riskValue\",span:4,length:3,list:[{key:\"H\",text:\"高\"},{key:\"M\",text:\"中\"},{key:\"L\",text:\"低\"}],options:{initialValue:s.riskValue}}]}},{key:\"render\",value:function(){var t=this,a=this.getFormOptions(),i=this.state,s=i.table,o=i.historyTable,r=i.selectedRowKeys,l={table:s,columns:this.columns,rowSelection:{selectedRowKeys:r,onChange:function(e,a){t.onChecked(e,a)}},onChange:this.getList},u={notCheck:!0,table:o,columns:this.historyColumns,onChange:this.getHisTotaleRiskValue},c=[{name:\"查询\",type:\"primary\",icon:\"search\",onClick:this.submit.bind(this)},{name:\"重置\",icon:\"reload\",onClick:this.reset.bind(this)}];this.state.isHistory||c.push({name:\"计算\",icon:\"calculator\",type:\"primary\",onClick:this.calculate.bind(this)},{name:\"告警列表\",icon:\"unordered-list\",onClick:this.warnList.bind(this)});var p={options:{title:\"风险节点信息\",footer:null,width:\"60%\"},onRef:function(e){t.modal1=e}},m={options:{title:\"历史风险值展示\",footer:null,bodyStyle:{height:\"443px\",overflow:\"auto\"}},onRef:function(e){t.modal2=e}};return e.createElement(f.CardCommon,{className:\"flight-risk\"},e.createElement(f.CommonForm,{options:a,wrappedComponentRef:function(e){e&&e.props&&e.props.form&&(t.form=e.props.form)}}),e.createElement(\"div\",{className:\"buttons clearfix\"},e.createElement(f.CommonBtns,{btns:c}),e.createElement(\"div\",{className:\"fr\"},e.createElement(f.ChartsTip,{low:\"1.0-4.0\",middle:\"4.1-7.0\",height:\"7.1-10.0\"}),e.createElement(\"div\",{className:\"text-danger text-right\"},\"*以北京时间显示\"))),e.createElement(f.CommonTable,{options:l,onChecked:this.onChecked}),e.createElement(f.CommonModal,p,e.createElement(n.default,{className:\"flight-risk-tab\",defaultActiveKey:\"1\",size:\"small\"},e.createElement(k,{tab:\"当前风险\",key:\"1\"},e.createElement(h.default,{treeParams:this.state.treeParams,isHistory:this.state.isHistory,hasAction:!this.state.isHistory})),e.createElement(k,{tab:\"历史风险\",key:\"2\"},e.createElement(f.CommonTable,{options:u}),e.createElement(f.CommonModal,m,e.createElement(h.default,{treeParams:this.state.treeParams,isHistory:this.state.isHistory}))))))}}]),v);function v(e){!function(e,t){if(!(e instanceof v))throw new TypeError(\"Cannot call a class as a function\")}(this);var t=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,e));return t.onChecked=function(e,a){t.setState({selectedRowKeys:e,selectedRows:a})},t.getList=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.state.table;a.setPage(e);var i=a.getParmaData();if(!(i.fltNr||i.latestDepArpChineseName&&i.latestArvArpChineseName)){var n=(0,l.default)(i.start,\"YYYY-MM-DD\");if(2880<=(0,l.default)(i.end,\"YYYY-MM-DD\").diff(n,\"minute\"))return void s.default.info({content:\"未指定航班或航线，只能查询1天范围数据！\"})}var o=t.state.isHistory?\"airLineRisk/queryHisRiskFlightByParam\":\"airLineRisk/queryAirLineRiskByParam\";(0,m.post)({url:o,data:i,success:function(e){if(e&&e.pages){var i=e.pages;a.setPage({dataList:i.list,total:i.total,pageNum:i.pageNum,pageSize:i.pageSize}),t.setState({table:a,selectedRowKeys:[],selectedRows:[]})}}})},t.getHisTotaleRiskValue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.state.historyTable;a.setPage(e);var i=a.getParmaData(),n=t.state.isHistory?\"airLineRisk/queryTotalRiskValueForHis\":\"airLineRisk/queryHisTotaleRiskValue\";(0,m.post)({url:n,data:i,success:function(e){var i=e.rmRiskpages;a.setPage({dataList:i.list,total:i.total,pageNum:i.pageNum,pageSize:i.pageSize}),t.setState({historyTable:a})}})},t.submit=function(e){e&&\"function\"==typeof e&&e(),event.preventDefault(),t.form.validateFields(function(e,a){e||(a=t.handleSearchParams(a),t.getList({params:a,pageNum:1}))})},t.reset=function(e){e&&\"function\"==typeof e&&e(),t.form.resetFields(),t.submit()},t.state={isHistory:-1!=e.match.path.indexOf(\"History\"),table:new d.default,selectedRowKeys:[],selectedRows:[],treeParams:{},form:{performanceTypeList:[],branchInfoList:[],userBelongsToCompany:\"\"},historyTable:new d.default({pageSize:5}),fltNr:\"\"},t.columns,t.historyColumns,t.form,t.modal1,t.modal2,t.detailUrl=t.state.isHistory?\"/HistoryFlightRiskDetail/\":\"/FlightRiskDetail/\",t.timer,t}t.default=(0,u.connect)(function(e){return{permission:e.permission,currentMenu:e.currentMenu}},function(e){return{updateCurrentMenu:function(t){return e((0,c.updateCurrentMenu)(t))}}})((0,r.withRouter)(b))}).call(this,a(1))}}]);","extractedComments":[]}